<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="author"  content="JackeyGao">
    <meta name="description" content="JackeyGao, 一个程序员的技术分享和对生活的理解.">
    <meta name="keywords"  content="JackeyGao, JackeyGao的日记本, Python, Django, Vue.js, chinese-poetry">
    <title>JG</title>
    <meta name="google-site-verification" content="xTBu05X0P9OJkoWvQWGdZimRp6nD6uqesWwTJ6v-BoA" />
    <meta name="google-site-verification" content="7Obwo8u7tT_NKgyJiirEB1qRpINEnh9BtyBa1WtiVjU" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#286272">
    <link rel="shortcut icon" href="/static/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/static/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="/static/global.css">
    <link rel="stylesheet" href="/static/mobile.css">
    

  
      <link rel="prev" href="/r/page/4/"></link>
  


    <link rel="next" href="/r/page/6/"></link>

<style>
#pagination a, #pagination span {
    padding: 2px 8px;
    letter-spacing: 0px;
}

#pagination a:hover {
    background: #f3f3f4;;
}
</style>

  </head>

  <body>
    <div id="canvasWrapper">
      <div id="canvas">
        <div id="toTop" onclick="topFunction();">⇪</div>

        <div id="mobileNav" class="hidden">
          <div id="avatarWrapper">
            <img class="avatar" src="/static/images/avatar.png">
          </div>
          <div id="menuNav"></div>
        </div>
        <div id="headerWrapper">
            <header>
                <div id="topNavMobile">
                    <nav id="mobileMenuLink" onclick="ToggleMenu()" class="main-nav clear">☰</nav>
                  </div>
                <div id="logo">
                  <a href='/'><img class="logo image" src="/static/images/logo.png"></a>
                </div>
                <div id="topNav">
                  <nav id="mainNavigation">
                    <ul>
                      <li>
                        <a href="/">文章</a>
                      </li>
                      <li>
                        <a href="/r/about.html">关于</a>
                      </li>
                      <li>
                        <a href="/r/links.html">链接</a>
                      </li>
                      <li>
                        <a href="#">ღ</a>
                      </li>
                    </ul>
                  </nav>
                  <nav id="secondaryNavigation">
                    <ul>
                      
                      <li>
                        <a href="/r/sets.html#('Django小技巧', [{'filename': 'django-tips-01-redirect', 'title': 'Django小技巧01: redirect', 'date': datetime.datetime(2018, 10, 25, 11, 52, 23), 'cover': '/uploads/images/redirect.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirect.jpeg"></div><figcaption class="img-title">#redirect</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/05/django-tip-1-redirect.html">simpleisbetterthancomplex.com</a></p></blockquote><figure id="code25a757919c24727ebc648c46d1e1f696" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code25a757919c24727ebc648c46d1e1f696"><\\>Python</a></figcaption></figure>\n<p><code>redirect</code>函数会返回一个<code>HttpResponseRedirect</code>类，比起<code>HttpResponseRedirect</code>类我更喜欢使用更简洁的<code>redirect</code>. 它会使我的代码保持一致。</p>\n\n<p>推荐使用 redirect 的理由是， 您可以指定不同类型的参数(model, url, endpoint)，指定 endpoint 的时候还可以直接指定URL， 不用再用<code>django.urlresolvers.reverse</code>来解析一遍了， 简洁了作用域环境.</p>\n\n<p>下面我们来看看实例:</p>\n\n<ul>\n<li>一个模型实例, 这将自动调用模型的<code>get_absolute_url()</code>方法;</li>\n</ul>\n<figure id="codecf708bfb57d25b749f50996f5f648fda" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n<span class="kn">from</span> <span class="nn">simple_blog.models</span> <span class="kn">import</span> <span class="n">Post</span>\n\n<span class="k">def</span> <span class="nf">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>\n    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(post.get_absolute_url())</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codecf708bfb57d25b749f50996f5f648fda"><\\>Python</a></figcaption></figure>\n<ul>\n<li>反解析endpoint URL 名称(接受视图 endpoint 参数)</li>\n</ul>\n<figure id="codedd0af40d500a795437fc3f30b90cbd91" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n<span class="kn">from</span> <span class="nn">simple_blog.models</span> <span class="kn">import</span> <span class="n">Post</span>\n\n<span class="k">def</span> <span class="nf">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;post_details&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(reverse(&#39;post_details&#39;, args=(post_id, )))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedd0af40d500a795437fc3f30b90cbd91"><\\>Python</a></figcaption></figure>\n<ul>\n<li>原始URL (aboluste 或者 relative)</li>\n</ul>\n<figure id="codec2de11ef9bc14a0d688315581e6df555" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n\n<span class="k">def</span> <span class="nf">relative_url_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/posts/archive/&#39;</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(&#39;/posts/archive/&#39;)</span>\n\n<span class="k">def</span> <span class="nf">absolute_url_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;https://simpleblog.com/posts/archive/&#39;</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(&#39;https://simpleblog.com/posts/archive/&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec2de11ef9bc14a0d688315581e6df555"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于redirect的文档. <a href="https://docs.djangoproject.com/en/dev/topics/http/shortcuts/#redirect">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-02-humanize', 'title': 'Django小技巧02: humanize', 'date': datetime.datetime(2018, 10, 25, 11, 53, 23), 'cover': '/uploads/images/humanize.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/humanize.jpeg"></div><figcaption class="img-title">#humanize</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/09/django-tip-2-humanize.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 附带一组模板过滤器， 可为您的数据添加<q>人性化</q>选项。它用于将数字或者日期转化为人类友好可读的格式.</p>\n\n<p>就我个人来说， 我使用模板过滤器<code>naturaltime</code>非常频繁。 比如我在<code>2018-10-25 11:33:24</code>定了个外卖， 在等待外卖的过程中， 订单页面的时间显示为<code>21 minutes ago</code>(考虑到目前是<code>2018-10-25 11:54:46</code>) 更好友好一点， 我能清楚的知道我等待了多长时间。 而不是<code>2018-10-25 11:54:46</code>这样的时间， 让我再计算一遍.</p>\n\n<p>使用方法也非常简单:</p>\n\n<p>在 <code>settings.py</code> <code>INSTALLED_APPS</code> 加入<code>django.contrib.humanize</code>.</p>\n<figure id="codebae0a5e28be1bcb26ae8f2b82857e837" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.humanize&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebae0a5e28be1bcb26ae8f2b82857e837"><\\>Python</a></figcaption></figure>\n<p>然后在 template 中, 载入此 APP 下的标签。</p>\n<figure id="codeb3ab2359611e8d8b4393c0b0e46930eb" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb3ab2359611e8d8b4393c0b0e46930eb"><\\>Django</a></figcaption></figure>\n<p>使用过滤器也非常简单， 比如使用<code>naturaltime</code>过滤器.</p>\n<figure id="code09e9f258313476e978beed20620653cc" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n\n<span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>\n\n<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;ul&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">notification</span> <span class="k">in</span> <span class="nv">notifications</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li&gt;</span>\n<span class="x">        </span><span class="cp">{{</span> <span class="nv">notification</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">        &lt;small&gt;</span><span class="cp">{{</span> <span class="nv">notification.date</span><span class="o">|</span><span class="nf">naturaltime</span> <span class="cp">}}</span><span class="x">&lt;/small&gt;</span>\n<span class="x">      &lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li&gt;You have no unread notification.&lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/ul&gt;</span>\n<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code09e9f258313476e978beed20620653cc"><\\>Django</a></figcaption></figure>\n<ul>\n<li>功能表</li>\n</ul>\n<div class="code table-wrapper"><table><thead>\n<tr>\n<th style="text-align: center">过滤器</th>\n<th style="text-align: center">作用</th>\n<th style="text-align: left">举例</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td style="text-align: center">apnumber</td>\n<td style="text-align: center">英文数字</td>\n<td style="text-align: left"><code>1</code> =&gt; <code>one</code></td>\n</tr>\n<tr>\n<td style="text-align: center">intcomma</td>\n<td style="text-align: center">三位逗号数字</td>\n<td style="text-align: left"><code>4500000</code> =&gt; <code>4,500,000</code></td>\n</tr>\n<tr>\n<td style="text-align: center">intword</td>\n<td style="text-align: center">文本数字</td>\n<td style="text-align: left"><code>4500000</code> =&gt; <code>4.5 million</code></td>\n</tr>\n<tr>\n<td style="text-align: center">naturalday</td>\n<td style="text-align: center">友好的日期</td>\n<td style="text-align: left"><code>2018-10-24</code> =&gt; <code>yesterday</code></td>\n</tr>\n<tr>\n<td style="text-align: center">naturaltime</td>\n<td style="text-align: center">友好的时间</td>\n<td style="text-align: left"><code>2018-10-25 12:00:01</code> =&gt; <code>a minute ago.</code></td>\n</tr>\n<tr>\n<td style="text-align: center">ordinal</td>\n<td style="text-align: center">序数字符串</td>\n<td style="text-align: left"><code>3</code> =&gt; <code>3rd</code></td>\n</tr>\n</tbody>\n</table></div><blockquote class="blockquote-normal">\n                <p>阅读更多关于humanize的文档. <a href="https://docs.djangoproject.com/en/dev/ref/contrib/humanize/">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-03-optimize-database-queries', 'title': 'Django小技巧03: 优化数据库查询', 'date': datetime.datetime(2018, 10, 25, 11, 54, 23), 'cover': '/uploads/images/odq.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/odq.jpeg"></div><figcaption class="img-title">#Fast</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/16/django-tip-3-optimize-database-queries.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本文介绍一个非常简单的技巧， 能够帮助你在使用 <code>Django ORM</code> 时优化数据库查询.</p>\n\n<p>需要注意的是， Django QuerySets 是惰性查询的， 如果使用得当非常适用。</p>\n\n<p>例如， 我们有一个叫做Invoice模型，并执行以下代码:</p>\n<figure id="code5b1c774ebc55875ab643bdc890b6d0f7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">unpaid_invoices</span> <span class="o">=</span> <span class="n">invoices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;UNPAID&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5b1c774ebc55875ab643bdc890b6d0f7"><\\>Python</a></figcaption></figure>\n<p>此时， <code>Django ORM</code> 还没有触及到数据库，也就是说没有执行操作。当我们调用这个 queryset(unpaid_invoices) 才会真正的执行到数据库查询。通常情况下， 当我们去遍历这个 Queryset 就会发生这种情况， 即 queryset 开始执行。如下面代码所示:</p>\n<figure id="codee5c83e1f94d1aa174de542c5921ef402" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;table&gt;</span>\n<span class="x">  &lt;tbody&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">invoice</span> <span class="k">in</span> <span class="nv">unpaid_invoices</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;tr&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.id</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.description</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">    &lt;/tr&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/tbody&gt;</span>\n<span class="x">&lt;/table&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee5c83e1f94d1aa174de542c5921ef402"><\\>Django</a></figcaption></figure>\n<p>上面的代码， 看起来没有什么问题。只会执行一个数据库查询。 但是当您的模型有关系数据字段时， 比如<code>ForeignKey</code>, <code>OneToOneField</code> 或 <code>ManyToManyField</code>. 上面的查询就会发生变化了。 </p>\n\n<p>假设<code>Invoice</code>模型有一个vendor字段是个<code>ForeignKey</code>:</p>\n<figure id="code5f22b6b8f3f940bb1329cea8990eac8c" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Invoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>\n    <span class="n">vendor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Vendor</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5f22b6b8f3f940bb1329cea8990eac8c"><\\>Python</a></figcaption></figure>\n<p>现在和上面的模板中一样去迭代这个 queyset， 但这次显示了供应商名称，<code>Django ORM</code>将对<code>unpaid_invoices</code>数据集每一条记录执行一次额外的查询.</p>\n<figure id="code2bff10485b1c6586c66946d5cd2524c4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;table&gt;</span>\n<span class="x">  &lt;tbody&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">invoice</span> <span class="k">in</span> <span class="nv">unpaid_invoices</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;tr&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.id</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.description</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.vendor.name</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">    &lt;/tr&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/tbody&gt;</span>\n<span class="x">&lt;/table&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2bff10485b1c6586c66946d5cd2524c4"><\\>Django</a></figcaption></figure>\n<p>如果<code>unpaid_invoices</code>数据集有100条记录， 那么将会有101条查询生成。检索invoices所有对象的一条查询， 和每个invoice供应商的一次查询， 共计101条。</p>\n\n<p>当然， 可以使用<code>select_related</code>方法， 来减轻这种不期望的影响，以便在单次数据查询中，检索所有必要的信息。</p>\n\n<p>所以，不要像上面那样过滤未付款的发票，可以这样做:</p>\n<figure id="codefb9cc33eb24bc9c53e996a09f9c98a85" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">unpaid_invoices</span> <span class="o">=</span> <span class="n">invoices</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;vendor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;UNPAID&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefb9cc33eb24bc9c53e996a09f9c98a85"><\\>Python</a></figcaption></figure>\n<p>这样， <code>Django ORM</code> 将会在同一查询中为每个发票检索供应商数据.因此这种情况不需要额外的查询，这样可以为您的应用程序出色的性能提升。</p>\n\n<p>推荐一个可以跟踪数据库查询的调试工具<a href="https://django-debug-toolbar.readthedocs.io/">Django Debug Toolbar</a></p>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Django QuerySet API的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#select-related">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-04-automatic-datetime-fields', 'title': 'Django小技巧04: 自动日期时间字段', 'date': datetime.datetime(2018, 10, 25, 11, 55, 23), 'cover': '/uploads/images/time.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/time.jpeg"></div><figcaption class="img-title">#Time</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/23/django-tip-4-automatic-datetime-fields.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 的<code>DateTimeField</code>和<code>DateField</code>有两个非常有用的参数，用于自动管理时间。如果你需要跟踪保存纪录的创建时间和更改时间，则无须手动执行，只需要加上<code>auto_now</code>和<code>auto_now_add</code>参数并设置为<code>True</code>即可。 如下面例子所示:</p>\n<figure id="codefe2f5182d438f10dc7383cdaaf668634" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Invoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>\n    <span class="n">vendor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Vendor</span><span class="p">)</span>\n    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefe2f5182d438f10dc7383cdaaf668634"><\\>Python</a></figcaption></figure>\n<ul>\n<li><code>auto_now_add</code>在创建的时候设置字段为<code>timezone.now()</code></li>\n<li><code>auto_now</code> 在每次调用<code>save</code>方法都会更新字段</li>\n</ul>\n\n<p>需要注意的是， 两个参数都将使用<code>timezone.now()</code>更新字段值，这意味着纪录创建的时候两个字段都将会填充。</p>\n\n<p>这是一个非常简单的技巧， 让你的代码变得非常清晰。</p>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Automatic DateTime Fields的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#datefield">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-05-how-to-merge-querysets', 'title': 'Django小技巧05: 合并QuerySets', 'date': datetime.datetime(2018, 10, 25, 11, 56, 23), 'cover': '/uploads/images/merge-queryset.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/merge-queryset.jpg"></div><figcaption class="img-title">#train tracks</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/06/20/django-tip-5-how-to-merge-querysets.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>当你想要让两个或者多个 queryset 合并为一个 queryset 的时候， 并且希望使用 list， 而且想要保留对象的<code>filter</code>, <code>count</code>, <code>distinct</code>等 queryset 方法。</p>\n\n<p>查看以下模型：</p>\n<figure id="codef549e386e84a7eefbd653f7205906f8a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Story</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;stories&#39;</span><span class="p">)</span>\n    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;stories&#39;</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Medium</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">stories</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Story</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef549e386e84a7eefbd653f7205906f8a"><\\>Python</a></figcaption></figure>\n<p>假设你想显示特定的 Medium 中发布的故事以及属于特定作者的所有故事。那么一般情况下， 你用以下方法获取了两个 queryset。</p>\n<figure id="code5e8e3bcfcd762d1e483ee5a5736200ff" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">medium</span> <span class="o">=</span> <span class="n">Medium</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Django Blog&#39;</span><span class="p">)</span>\n<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;vitor&#39;</span><span class="p">)</span>\n\n<span class="n">django_stories</span> <span class="o">=</span> <span class="n">medium</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">vitor_stories</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category__name</span><span class="o">=</span><span class="s1">&#39;django&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5e8e3bcfcd762d1e483ee5a5736200ff"><\\>Python</a></figcaption></figure>\n<p>此时我们有两个查询集(QuerySets) ,我们可以通过<code>|</code> 运算符来合并这两个查询集。</p>\n<figure id="code306c7f20b0aa06e96d66182d98a48c7b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">stories</span> <span class="o">=</span> <span class="n">django_stories</span> <span class="o">|</span> <span class="n">vitor_stories</span>  <span class="c1"># merge querysets</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code306c7f20b0aa06e96d66182d98a48c7b"><\\>Python</a></figcaption></figure>\n<p>此时你依然可以使用 queryset 的一些操作方法.</p>\n<figure id="code4f19f057b33b770f8953b6613d67e9a8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">recent_stories</span> <span class="o">=</span> <span class="n">stories</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-date&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4f19f057b33b770f8953b6613d67e9a8"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> <strong>注意:</strong> 合并运算符仅适用于同一类型的 queryset， 并且数据为切片前数据集.</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-06-get-or-create', 'title': 'Django小技巧06: get_or_create', 'date': datetime.datetime(2018, 10, 26, 11, 8, 23), 'cover': '/uploads/images/get-or-create.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/get-or-create.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/14/django-tip-6-get-or-create.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p><code>get_or_create</code> 是查找对象的一种便捷方法， 其最大的功能点是在目标对象不存在的时候， 可以根据参数创建对象。</p>\n\n<p>它实际上返回一个<code>(object, created)</code>元祖，第一个元素是您要检索 get 的模型的实例，第二个元素是个是否创建的布尔值，用户判断实例是否是创建的。</p>\n\n<p>如果实例已经存在数据库中， 并且通过参数可以找到， 那么 created 为 False， 反之则会创建， created 为 True。</p>\n\n<p>定义个名为<code>AppSettings</code>的模型， 你可以在此存储配置：</p>\n<figure id="codeef3a02e2caa60bbe119d67002c5429a4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DEFAULT_LANG&#39;</span><span class="p">)</span>\n<span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEFAULT_LANG&#39;</span><span class="p">)</span>\n<span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeef3a02e2caa60bbe119d67002c5429a4"><\\>Python</a></figcaption></figure>\n<p>如上面代码所示， 如果这是我第一次运行这段代码保存名为<code>DEFAULT_LANG</code>的配置，<code>get_or_create</code>将创建一个实例并在数据库中保留。 如果这是我第二次或者第三次调用此段代码， 它只会更新现有实例, 而原有的实例ID和name不会改变.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-07-get-crrent-url-in-template', 'title': 'Django小技巧07: 在模板中获取当前URL', 'date': datetime.datetime(2018, 10, 26, 11, 55, 23), 'cover': '/uploads/images/get-url-in-template.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/get-url-in-template.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/20/django-tip-7-how-to-get-the-current-url-within-a-django-template.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>确保项目配置里的<code>context_processors</code>包含<code>django.template.context_processors.request</code>.</p>\n\n<p>从 Django 1.9 开始， 默认是已经配置的。</p>\n<figure id="codebe7a2442b608652a955be3ea9cbb3db4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="p">{</span>\n        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>\n        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>\n        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>\n            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>\n                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>\n            <span class="p">],</span>\n        <span class="p">},</span>\n    <span class="p">},</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebe7a2442b608652a955be3ea9cbb3db4"><\\>Python</a></figcaption></figure>\n<p>获取当前位置:</p>\n<figure id="code63fd9931fa4bcb8a1cf7bd21ff7c5e1e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.path</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code63fd9931fa4bcb8a1cf7bd21ff7c5e1e"><\\>Django</a></figcaption></figure>\n<p>获取带有querystring的URL:</p>\n<figure id="code7bd9705e26612bf26a14f9e047d0a252" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.get_full_path</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7bd9705e26612bf26a14f9e047d0a252"><\\>Django</a></figcaption></figure>\n<p>获取完全的绝对路径:</p>\n<figure id="coded40896e7dc33ea09e130a8c818398b4b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.build_absolute_uri</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded40896e7dc33ea09e130a8c818398b4b"><\\>Django</a></figcaption></figure><h2 id="示例表">示例表</h2>\n<p>假设， 我们的URL是: <code>https://jackeygao.io/search/?keyword=django</code></p>\n<div class="code table-wrapper"><table><thead>\n<tr>\n<th>Method</th>\n<th style="text-align: left">Output</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td>request.path</td>\n<td style="text-align: left">/search/</td>\n</tr>\n<tr>\n<td><code>request.get_full_path</code></td>\n<td style="text-align: left">search/?keyword=django</td>\n</tr>\n<tr>\n<td><code>request.build_absolute_uri</code></td>\n<td style="text-align: left">https://jackeygao.io/search/?keyword=django</td>\n</tr>\n</tbody>\n</table></div><h2 id="Django 1.7 或者更早的版本">Django 1.7 或者更早的版本</h2><h3 id="settings.py">settings.py</h3><figcaption id="code048b4b5ed7b72481d1ae1c9d998d4a9c" class="code-wrapper">\n<div class="highlight"><pre>from django.conf.global_settings import TEMPLATE_CONTEXT_PROCESSORS as TCP\n\nTEMPLATE_CONTEXT_PROCESSORS = TCP + (\n    \'django.core.context_processors.request\',\n)</pre><figcaption><a href="#code048b4b5ed7b72481d1ae1c9d998d4a9c" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Automatic DateTime Fields的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#datefield">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-08-blank-or-null', 'title': 'Django小技巧08: Blank or Null', 'date': datetime.datetime(2018, 10, 26, 12, 12, 51), 'cover': '/uploads/images/blank-or-null.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/blank-or-null.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/25/django-tip-8-blank-or-null.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django Model API 中提供了<code>blank</code>和<code>null</code>两个参数， 非常容易混淆。当我第一次使用 Django 的时候， 总是不能恰当的使用这两个参数。</p>\n\n<p>看起来两者都做了几乎相同的事情， 但是这两者还是有区别的：</p>\n\n<ul>\n<li><strong>null</strong>: 数据库相关； 定义数据库字段的值是否接受空值。</li>\n<li><strong>blank</strong>: 验证相关， 当调用<code>form.is_valid()</code>时， 将会判断值是否为空.</li>\n</ul>\n\n<p>虽然两者的是有区别的， 但一个拥有<code>null=True</code>和<code>blank=False</code>的字段是完全没有问题的。 在数据库级别上， 该字段可以为 NULL， 但在应用程序级别上， 它是必填字段(前提你通过 Django 标准的 Form 进行判断)。</p>\n\n<p>大多数开发人员都对基于字符串的字段(<code>CharField</code>和<code>TextField</code>)定义<code>null=True</code>, 这其实是没有必要的, 应该避免这样做，因为 Django约定使用空字符串设置空值， 而非<strong>Null</strong>.</p>\n\n<p>所以， 如果你想设置一个基于字符的字段可以为空，那么你应该这样做:</p>\n<figure id="code61eab99acda25e6f31dc2df010946917" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>  <span class="c1"># 强制填写</span>\n    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 可选填写 (不要设置null=True)</span>\n    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 可选填写 (这里你应该设置null=True)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code61eab99acda25e6f31dc2df010946917"><\\>Python</a></figcaption></figure><h2 id="默认值">默认值</h2>\n<ul>\n<li><strong>null</strong>: False</li>\n<li><strong>blank</strong>: False</li>\n</ul>\n<h2 id="NullBooleanField">NullBooleanField</h2>\n<p>当您需要为<code>BooleanField</code>字段设置允许为空时， 您应该使用<code>NullBooleanField</code>代替，<strong>而非通过参数</strong>.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-09-password-change-form', 'title': 'Django小技巧09: 创建修改密码视图', 'date': datetime.datetime(2018, 10, 26, 12, 50, 51), 'cover': '/uploads/images/password-change-form.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/password-change-form.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/04/django-tip-9-password-change-form.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇讲述如何使用内置的<code>PasswordChangeForm</code>快速创建更改密码视图.</p>\n\n<p>就此而言， 使用函数式视图更容易实现。 因为<code>PasswordChangeForm</code>不从<code>ModelForm</code>继承。并且其构造函数使用<code>user</code>参数.</p>\n\n<p>以下实例，用于更改经过认证过后的用户密码的功能代码:</p>\n\n<ul>\n<li><strong>views.py</strong></li>\n</ul>\n<figure id="code25bc48d4a538ae8f94b1c2440b315c94" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">update_session_auth_hash</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">PasswordChangeForm</span>\n<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>\n\n<span class="k">def</span> <span class="nf">change_password</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>\n        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>\n            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c1"># Important!</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was successfully updated!&#39;</span><span class="p">)</span>\n            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;change_password&#39;</span><span class="p">)</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>\n    <span class="k">else</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;accounts/change_password.html&#39;</span><span class="p">,</span> <span class="p">{</span>\n        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span>\n    <span class="p">})</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code25bc48d4a538ae8f94b1c2440b315c94"><\\>Python</a></figcaption></figure>\n<p><code>message.success()</code>和<code>message.error</code>是可选的， 但最好让用户知道应用程序中他们应该知道的状态。</p>\n\n<p>需要注意一点是, 保存表单后要调用<code>update_session_auth_hash()</code>， 否则身份验证会话将会失效，用户必须重新登录.</p>\n\n<ul>\n<li><strong>urls.py</strong></li>\n</ul>\n<figure id="code714484618712b760aa4c9e262133cd83" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">myproject.accounts</span> <span class="kn">import</span> <span class="n">views</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^password/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">change_password</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;change_password&#39;</span><span class="p">),</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code714484618712b760aa4c9e262133cd83"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>change_password.html</strong></li>\n</ul>\n<figure id="codee1c0986524153db939a2b5677975ad72" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  </span><span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">  &lt;button type=&quot;submit&quot;&gt;Save changes&lt;/button&gt;</span>\n<span class="x">&lt;/form&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee1c0986524153db939a2b5677975ad72"><\\>Django</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-10-custom-login-policy', 'title': 'Django小技巧10: 自定义认证策略', 'date': datetime.datetime(2018, 10, 26, 13, 30, 12), 'cover': '/uploads/images/authentication-form-custom-login-policy.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/authentication-form-custom-login-policy.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/12/django-tip-10-authentication-form-custom-login-policy.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 内置了一套功能极全的认证系统，而且可以很容易的进行自定义， 本章的内容就是自定义认证策略。</p>\n\n<p>对于内置的login视图，Django 使用<code>django.contrib.auth.forms.AuthenticationForm</code>来处理身份验证过程。 这个认证检查了基本的<code>username</code>, <code>password</code>和<code>is_active</code>标识.</p>\n\n<p>Django 可以通过<code>AuthenticationForm</code>的<code>confirm_login_allowed(user)</code>方法， 轻松添加自定义认证.</p>\n\n<p>假设你想通过双重的电子邮件认证， 只有用户点击确认邮件后才可以登录，那么你可以这样做:</p>\n\n<ul>\n<li><strong>forms.py</strong></li>\n</ul>\n<figure id="codea8a5b1d2736a095025c8c8e446f8e53b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">AuthenticationForm</span>\n\n<span class="k">class</span> <span class="nc">CustomAuthenticationForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>\n        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_validated</span><span class="p">:</span>\n            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;There was a problem with your login.&#39;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;invalid_login&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea8a5b1d2736a095025c8c8e446f8e53b"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>urls.py</strong></li>\n</ul>\n<figure id="codedac339a4c5be35a3f1d59fd6073e0a39" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>\n\n<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomAuthenticationForm</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;core/login.html&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;authentication_form&#39;</span><span class="p">:</span> <span class="n">CustomAuthenticationForm</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^logout/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>\n    <span class="o">...</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedac339a4c5be35a3f1d59fd6073e0a39"><\\>Python</a></figcaption></figure>\n<p>很简单， 只需覆盖<code>confirm_login_allowed</code>方法,并在 urlconf 替换新的表单<code>CustomAuthenticationForm</code>即可。你可以在<code>confirm_login_allowed</code>添加任何的代码策略， 需要注意的是， 如果认证失败仅能抛出<code>ValidationError</code>才可以正常工作.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-11-custom-manager', 'title': 'Django小技巧11: 自定义链式Queryset Manager', 'date': datetime.datetime(2018, 10, 26, 17, 12, 42), 'cover': '/uploads/images/custom-manager.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/custom-manager.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/16/django-tip-11-custom-manager-with-chainable-querysets.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>在 Django Model 中，Manager是与数据库交互的接口。默认情况下Manager可通过<code>Model.objects</code>属性使用。默认情况下， 每个 Model 的默认 Manager 是<code>django.db.models.Manager</code>。扩展和重写默认Manager非常简单.</p>\n<figure id="code202c034a0897d72f5116a053fcf980de" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">DocumentManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentManager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code202c034a0897d72f5116a053fcf980de"><\\>Python</a></figcaption></figure>\n<p>设置后， 你可以通过<code>pdfs</code>方法快速的过滤属于 PDF 的文档.</p>\n<figure id="code08b1fcf03fd8a884d7f4f90e935199a7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code08b1fcf03fd8a884d7f4f90e935199a7"><\\>Python</a></figcaption></figure>\n<p>当然，返回的结果是链式的， 依然拥有 queryset 的一些操作方法(<code>order_by</code> 或 <code>filter</code>等..).</p>\n<figure id="codeed6ae93b64deb35305d7733fce26ae6e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeed6ae93b64deb35305d7733fce26ae6e"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> 但是， 如果你试图在使用自定义的一些方法， 链式将会中止:</p></blockquote><figure id="code8cd3185b05949ffa7f55ef6c34e9247b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>\n\n<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;QuerySet&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;smaller_than&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8cd3185b05949ffa7f55ef6c34e9247b"><\\>Python</a></figcaption></figure>\n<p>要使上述代码能够工作， 你必须创建自定义的<code>get_queryset</code>方法.</p>\n<figure id="code3335dce14d0ea7248dd183689d9bf6ca" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentQuerySet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">DocumentManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="n">DocumentQuerySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>  <span class="c1"># Important!</span>\n\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentManager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3335dce14d0ea7248dd183689d9bf6ca"><\\>Python</a></figcaption></figure>\n<p>现在可以像任何的 QuerySet 方法一样使用他。 并且是链式的！</p>\n<figure id="coded051032ba84e912a3403d438209fa49a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Article&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded051032ba84e912a3403d438209fa49a"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>Manager 除了自定义 QuerySet 还可以做其他的工作， 如果你只在 Manager 中自定义 QuerySet ，推荐扩展下<code>models.QuerySet</code>, 并在模型中定义<code>objects = DocumentQuerySet.as_manager()</code>.</p></blockquote><figure id="code786ba53993d96d3d20382e53704da7c6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentQuerySet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentQuerySet</span><span class="o">.</span><span class="n">as_manager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code786ba53993d96d3d20382e53704da7c6"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>自定义的 Manager 代码， 你可以写在<strong>models.py</strong>， 但随着代码库的增长， 我更加推荐你将定义的<code>QuerySets</code> 和<code>Managers</code>保存名为<strong>managers.py</strong>文件中.</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-12-disabling-migrations', 'title': 'Django小技巧12: 禁用单元测试的Migrations', 'date': datetime.datetime(2018, 10, 29, 18, 12, 42), 'cover': '/uploads/images/disabling-migrations.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/disabling-migrations.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/19/django-tip-12-disabling-migrations-to-speed-up-unit-tests.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Migrations 无疑是 Django 的一大特色功能，当它在单元测试的时候， 却会加长整个单元测试的时间。特别是你的migrations history特别的大.本篇是加快单元测试的小技巧:</p>\n\n<p>为单元测试单独创建一个 settings</p>\n\n<p><strong>tests_settings.py</strong></p>\n<figure id="code0adc599f6d3dc2489d48cc1e39d555a9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="c1"># Custom settings goes here</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code0adc599f6d3dc2489d48cc1e39d555a9"><\\>Python</a></figcaption></figure>\n<p>然后在执行测试的时候，这样做:</p>\n<figure id="code58f1241bfd92b1e441f19395adff20fc" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py <span class="nb">test</span> --settings<span class="o">=</span>myproject.tests_settings --verbosity<span class="o">=</span><span class="m">1</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code58f1241bfd92b1e441f19395adff20fc"><\\>Shell</a></figcaption></figure><h2 id="Django &gt;= 1.9">Django &gt;= 1.9</h2>\n<p>使用<code>MIGRATION_MODULES</code>设置项, 用于定义migration模块的自定义名称， 如果为<code>None</code>则是忽略此模块.</p>\n<figure id="code7e73192c58b22cd2717a4f94e008d70b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">MIGRATION_MODULES</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;contenttypes&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;sessions&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n\n    <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;profiles&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;snippets&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;scaffold_templates&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7e73192c58b22cd2717a4f94e008d70b"><\\>Python</a></figcaption></figure><h2 id="Django &lt; 1.9">Django &lt; 1.9</h2>\n<p>如果是1.9之前的版本，可以用下面的方法。实际上， 我现在依然在使用它， 因为这种方法不需要指定各个模块.</p>\n<figure id="code1ff0b4c2b437f759ad69d25ea6ce05ff" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="k">class</span> <span class="nc">DisableMigrations</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>\n    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">True</span>\n\n    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>\n        <span class="k">return</span> <span class="s1">&#39;notmigrations&#39;</span>\n\n<span class="n">MIGRATION_MODULES</span> <span class="o">=</span> <span class="n">DisableMigrations</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1ff0b4c2b437f759ad69d25ea6ce05ff"><\\>Python</a></figcaption></figure><h2 id="更旧的版本 (使用: South)">更旧的版本 (使用: South)</h2><figcaption id="code9180f3e4e28e5d645ec42c5247308748" class="code-wrapper">\n<div class="highlight"><pre>SOUTH_TESTS_MIGRATE = False</pre><figcaption><a href="#code9180f3e4e28e5d645ec42c5247308748" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n\n<p>这个可以写在生产的<strong>settings.py</strong>中.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-13-f-expression', 'title': 'Django小技巧13: 使用F()表达式', 'date': datetime.datetime(2018, 10, 29, 18, 49, 8), 'cover': '/uploads/images/f-expression.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/f-expression.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/23/django-tip-13-f-expressions.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>在 Django QuerySets API 中， F() 用于直接在数据库中引用模型的值。假设你有一个带有<code>price</code>的 Product 模型， 你希望为所有的Product的价格上涨20%.</p>\n\n<p>一个可以实现在解决方案:</p>\n<figure id="code5573cc06b169b74e7936dd558a910e08" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">*=</span> <span class="mf">1.2</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5573cc06b169b74e7936dd558a910e08"><\\>Python</a></figcaption></figure>\n<p>相反， 你可以在单个查询中更新price.</p>\n<figure id="code63597999fb1d67c0067a87c6e0d7f0bd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code63597999fb1d67c0067a87c6e0d7f0bd"><\\>Python</a></figcaption></figure>\n<p>你也可以对单个对象执行这个操作:</p>\n<figure id="code64a105d1ba092a246e77e322f60fef46" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">5009</span><span class="p">)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code64a105d1ba092a246e77e322f60fef46"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> 要注意， 保存模型后， <code>F()</code>对象依然存在.</p></blockquote><figure id="code4460c4a073983395a449d616720b9e2b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">price</span>                   <span class="c1"># price = Decimal(&#39;10.00&#39;)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>                  <span class="c1"># price = Decimal(&#39;11.00&#39;)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;What the F()&#39;</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>                  <span class="c1"># price = Decimal(&#39;12.00&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4460c4a073983395a449d616720b9e2b"><\\>Python</a></figcaption></figure>\n<p>所以， 在更新这样的字段后, <code>product.price</code>实际上保存的是<code>django.db.models.expressions.CombinedExpression</code>实例， 而不是实际结果。</p>\n\n<p>如果要立即访问结果:</p>\n<figure id="code9f5fab2bf78d86742c841802773a996a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n<span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>            <span class="c1"># &lt;CombinedExpression: F(price) + Value(1)&gt;</span>\n<span class="n">product</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>\n<span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>            <span class="c1"># Decimal(&#39;13.00&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9f5fab2bf78d86742c841802773a996a"><\\>Python</a></figcaption></figure>\n<p>你可以使用<code>F()</code>实现annotate功能:</p>\n<figure id="code3a604492533106f4fcc167e991de753b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">ExpressionWrapper</span><span class="p">,</span> <span class="n">DecimalField</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>\n    <span class="n">value_in_stock</span><span class="o">=</span><span class="n">ExpressionWrapper</span><span class="p">(</span>\n        <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">),</span> <span class="n">output_field</span><span class="o">=</span><span class="n">DecimalField</span><span class="p">()</span>\n    <span class="p">)</span>\n<span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3a604492533106f4fcc167e991de753b"><\\>Python</a></figcaption></figure>\n<p>由于price是DecimalField, 而stock是IntegerField，我们需要将表达式包装在<code>ExpressionWrapper</code>中.</p>\n\n<p>也可以用来过滤数据:</p>\n<figure id="code6df60b5277b1d118cf94afc6d03b7ccc" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">stock__gte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;ordered&#39;</span><span class="p">))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code6df60b5277b1d118cf94afc6d03b7ccc"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-14-messages-framework', 'title': 'Django小技巧14: messages 框架', 'date': datetime.datetime(2018, 10, 30, 14, 4, 39), 'cover': '/uploads/images/messages-framework.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/messages-framework.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/09/06/django-tip-14-messages-framework.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>让用户知道应用程序发生了什么， 是个极好的用户体验。让应用程序和用户之间能够有个很好的『交流』是个不错的选择。</p>\n\n<p>设想一下下面场景:</p>\n\n<ul>\n<li>用户: 点击保存按钮</li>\n<li>应用程序： 什么都没有发生</li>\n<li>所以是否保存了数据？ 用户并不知道</li>\n<li>这时一些急性子就疯狂的点击，点击，点击...</li>\n</ul>\n\n<p>所以， 要让用户不要慌...</p>\n<h2 id="配置">配置</h2>\n<p>默认情况下，Django 项目内置了messages框架, 如果你没有更改这些配置， 只需要跳到下一节。 如果有改动， 按照下面这样设置：</p>\n\n<ul>\n<li><strong>INSTALLED_APPS</strong>\n\n<ul>\n<li>django.contrib.messages</li>\n</ul></li>\n<li><strong>MIDDLEWARE</strong> 或者 <strong>MIDDLEWARE_CLASSES</strong>(老版本)\n\n<ul>\n<li>django.contrib.sessions.middleware.SessionMiddleware</li>\n<li>django.contrib.messages.middleware.MessageMiddleware</li>\n</ul></li>\n<li><strong>TEMPLATES</strong>\n\n<ul>\n<li><strong>context_processors</strong>\n\n<ul>\n<li>django.contrib.messages.context_processors.messages</li>\n</ul></li>\n</ul></li>\n</ul>\n<h2 id="消息级别和标签">消息级别和标签</h2><div class="code table-wrapper"><table><thead>\n<tr>\n<th>Constant</th>\n<th>Level</th>\n<th>Tag</th>\n<th>Purpose</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td>DEBUG</td>\n<td>10</td>\n<td>debug</td>\n<td>开发相关的消息</td>\n</tr>\n<tr>\n<td>INFO</td>\n<td>20</td>\n<td>info</td>\n<td>用户级别消息</td>\n</tr>\n<tr>\n<td>SUCCESS</td>\n<td>25</td>\n<td>success</td>\n<td>一个操作的成功消息</td>\n</tr>\n<tr>\n<td>WARNING</td>\n<td>30</td>\n<td>warning</td>\n<td>失败但非迫在眉睫的消息</td>\n</tr>\n<tr>\n<td>ERROR</td>\n<td>40</td>\n<td>errror</td>\n<td>操作未成功或发生错误</td>\n</tr>\n</tbody>\n</table></div>\n<p>默认情况下， Django 只会显示 <code>level &gt;= 20</code> (INFO)的消息， 如果显示<code>DEBUG</code>消息， 可以在设置中:</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code82ceca17dc39c220d82bb389700c2bb1" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.messages</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">message_constants</span>\n<span class="n">MESSAGE_LEVEL</span> <span class="o">=</span> <span class="n">message_constants</span><span class="o">.</span><span class="n">DEBUG</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code82ceca17dc39c220d82bb389700c2bb1"><\\>Python</a></figcaption></figure>\n<p>为了避免遇到导入循环， 可以直接设置 level.</p>\n<figure id="code9bbecf29cf7d2aaff7016ea69651badf" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MESSAGE_LEVEL</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># DEBUG</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9bbecf29cf7d2aaff7016ea69651badf"><\\>Python</a></figcaption></figure><h2 id="使用">使用</h2>\n<p>在视图里面必要的地方添加， 触发消息的逻辑， 在模板里面添加显示的代码， 就可以使用消息啦</p>\n\n<p><strong>views.py</strong></p>\n<figure id="codea9ab66f1843969f0e44dd8b5636bb138" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>\n\n<span class="nd">@login_required</span>\n<span class="k">def</span> <span class="nf">password</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>\n        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>\n            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">)</span>  <span class="c1"># &lt;-</span>\n            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;settings:password&#39;</span><span class="p">)</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>  <span class="c1"># &lt;-</span>\n    <span class="k">else</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;profiles/change_password.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea9ab66f1843969f0e44dd8b5636bb138"><\\>Python</a></figcaption></figure>\n<p><strong>然后template中</strong></p>\n<figure id="code6879b6d3cdf45d8ea207b24aa192efb2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;ul class=&quot;messages&quot;&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li class=&quot;</span><span class="cp">{{</span> <span class="nv">message.tags</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/ul&gt;</span>\n<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code6879b6d3cdf45d8ea207b24aa192efb2"><\\>Django</a></figcaption></figure>\n<p>如果添加成功了， 则输出的 html 应该是这样呢, 可以看到实际上标签应该和你的用户美化messsage的 css 对应。</p>\n<figure id="codec0ecdbc7d8523e44087bd44f935df5a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;</span>\n  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;success&quot;</span><span class="p">&gt;</span>Your password was updated successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>\n<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec0ecdbc7d8523e44087bd44f935df5a2"><\\>Html</a></figcaption></figure>\n<p>你可以对 message， 添加额外的标签:</p>\n<figure id="code5da3be0572355d1c235232e0fde365fd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">,</span> <span class="n">extra_tags</span><span class="o">=</span><span class="s1">&#39;alert&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5da3be0572355d1c235232e0fde365fd"><\\>Python</a></figcaption></figure>\n<p>输出html 为:</p>\n<figure id="code4177b0f9fa7fd7d56a23fa5c3bee5eed" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;</span>\n  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;success alert&quot;</span><span class="p">&gt;</span>Your password was updated successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>\n<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4177b0f9fa7fd7d56a23fa5c3bee5eed"><\\>Html</a></figcaption></figure>\n<p>内置方法介绍:</p>\n<figure id="code3b33a07db96511a7224ed7fc3d57d908" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">messages</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Total records updated {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Improve your profile today!&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;An unexpected error occured.&#39;</span><span class="p">)</span>\n\n<span class="c1"># Or...</span>\n\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s1">&#39;Total records updated {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;Improve your profile today!&#39;</span><span class="p">)</span>\n\n<span class="c1"># Useful to define custom levels:</span>\n<span class="n">CRITICAL</span> <span class="o">=</span> <span class="mi">50</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">CRITICAL</span><span class="p">,</span> <span class="s1">&#39;A very serious error ocurred.&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3b33a07db96511a7224ed7fc3d57d908"><\\>Python</a></figcaption></figure><h2 id="和Bootstrap结合代码片段">和Bootstrap结合代码片段</h2>\n<ul>\n<li><strong>messages.html</strong></li>\n</ul>\n<figure id="codeffcca6416fa8771b633ae3b759ebd177" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;div class=&quot;alert </span><span class="cp">{{</span> <span class="nv">message.tags</span> <span class="cp">}}</span><span class="x"> alert-dismissible&quot; role=&quot;alert&quot;&gt;</span>\n<span class="x">    &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;</span>\n<span class="x">      &lt;span aria-hidden=&quot;true&quot;&gt;&amp;times;&lt;/span&gt;</span>\n<span class="x">    &lt;/button&gt;</span>\n<span class="x">    </span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">  &lt;/div&gt;</span>\n<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeffcca6416fa8771b633ae3b759ebd177"><\\>Django</a></figcaption></figure>\n<ul>\n<li><strong>settings.py</strong></li>\n</ul>\n\n<p>Bootstrap 中定义了如<code>alert-info</code>或者<code>alert-success</code>等<code>alert-*</code>的组件css. 所以我们需要更改下默认的 tags.</p>\n<figure id="code1b4a4d26120fc3fd46faab698b068993" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.messages</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">messages</span>\n\n<span class="n">MESSAGE_TAGS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span> <span class="s1">&#39;alert-info&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span> <span class="s1">&#39;alert-info&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b4a4d26120fc3fd46faab698b068993"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>base.html</strong></li>\n</ul>\n\n<p>然后把<code>messages.html</code>添加到需要显示的地方:</p>\n<figure id="code4f6f0812a255b5114a13b211b5032801" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;!doctype html&gt;</span>\n<span class="x">&lt;html&gt;</span>\n<span class="x">  &lt;head&gt;</span>\n<span class="x">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>\n<span class="x">    &lt;title&gt;Simple is Better Than Complex&lt;/title&gt;</span>\n<span class="x">  &lt;/head&gt;</span>\n<span class="x">  &lt;body&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/header.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;main&gt;</span>\n<span class="x">      &lt;div class=&quot;container&quot;&gt;</span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/messages.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;/div&gt;</span>\n<span class="x">    &lt;/main&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/footer.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/body&gt;</span>\n<span class="x">&lt;/html&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4f6f0812a255b5114a13b211b5032801"><\\>Django</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于messages框架的文档. <a href="https://docs.djangoproject.com/en/dev/ref/contrib/messages/">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-15-cbv-mixins', 'title': 'Django小技巧15: 使用基于类视图的Mixins', 'date': datetime.datetime(2018, 11, 5, 11, 4, 39), 'cover': '/uploads/images/cbv-mixins.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/cbv-mixins.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/09/27/django-tip-15-cbv-mixins.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>今天讲述三点关于 Mixins 使用的一些规范:</p>\n\n<ul>\n<li>Django 提供的View 保持在继承的最右边.</li>\n<li>Mixins 在基本视图的左侧</li>\n<li>Mixins 应该继承Python的内置对象类型(object).</li>\n</ul>\n\n<p>下面举例说明规则</p>\n<figure id="coded13bc63bee5404dd7145986172c37355" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FormMessageMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>\n    <span class="nd">@property</span>\n    <span class="k">def</span> <span class="nf">form_valid_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">NotImplemented</span>\n\n    <span class="n">form_invalid_message</span> <span class="o">=</span> <span class="s1">&#39;Please correct the errors below.&#39;</span>\n\n    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>\n        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_valid_message</span><span class="p">)</span>\n        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">form_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>\n        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_invalid_message</span><span class="p">)</span>\n        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_invalid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>\n\n\n<span class="k">class</span> <span class="nc">DocumentCreateView</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully created!&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded13bc63bee5404dd7145986172c37355"><\\>Python</a></figcaption></figure>\n<p>依类似的方式， 你可以在UpdateView中， 重用相同的FormMessageMixin, 并覆盖默认的<code>form_invalid_message</code>方法.</p>\n<figure id="codedd571e5e9b125ea1b348c8b3d5fc45d2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentUpdateView</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully updated!&#39;</span>\n    <span class="n">form_invalid_message</span> <span class="o">=</span> <span class="s1">&#39;There are some errors in the form below.&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedd571e5e9b125ea1b348c8b3d5fc45d2"><\\>Python</a></figcaption></figure>\n<p>Django 1.9开始， 内置的LoginRequiredMixin和UserPassesTestMixin. 如果你要在视图中使用它们， 它们始终位于最左侧:</p>\n<figure id="code252b6de19c55d651cbb41244e54fbe31" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentUpdateView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully updated!&#39;</span>\n</pre></div>\n<span class="title-label">#Mixins在左,View在后</span><figcaption><a class="lang-label" href="#code252b6de19c55d651cbb41244e54fbe31"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-16-db-access-optimizations', 'title': 'Django小技巧16: 数据库访问优化', 'date': datetime.datetime(2018, 11, 5, 13, 4, 39), 'cover': '/uploads/images/db-access-optimizations.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/db-access-optimizations.jpeg"></div><figcaption class="img-title">#错综复杂</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/05/django-tip-16-simple-database-access-optimizations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇分享数据库访问优化相关， 读完这些并不是让你立即去优化代码， 更多的时候对于现有代码的优化， 需要借助<a href="https://github.com/jazzband/django-debug-toolbar">Django Debug Toolbar</a>来分析后， 再去相应的优化代码， 但今天要说的是一些简单的技巧， 用于你在编写代码的时候就所有规避不好用法， 使用推荐的用法.</p>\n<h2 id="访问外键值">访问外键值</h2>\n<p>如果你只需外键的ID</p>\n<figure id="code8e6cd4975654e8f20f7f308f67cfd2ef" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">.</span><span class="n">author_id</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code8e6cd4975654e8f20f7f308f67cfd2ef"><\\>Python</a></figcaption></figure><figure id="code7d4ed7b7f4f8ea443f5f7794fa55474a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">id</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code7d4ed7b7f4f8ea443f5f7794fa55474a"><\\>Python</a></figcaption></figure>\n<p>如果你的博文中有一个 author 的外键，Django 会自动将主键存储在属性author_id中, 而在author属性则是一个惰性的数据库引用。如果你如果使用author来访问 ID, 数据则会多出一个额外的查询，就会产生开销。</p>\n<h2 id="批量插入Many to Many字段">批量插入Many to Many字段</h2><figure id="codee8f4076885b2f9818ae1640bcbca912e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">administrators</span><span class="p">,</span> <span class="n">managers</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codee8f4076885b2f9818ae1640bcbca912e"><\\>Python</a></figcaption></figure><figure id="codeb24b1236a15abb2adf7fc7ce82951448" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">administrators</span><span class="p">)</span>\n<span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">managers</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codeb24b1236a15abb2adf7fc7ce82951448"><\\>Python</a></figcaption></figure><h2 id="Count QuerySets">Count QuerySets</h2>\n<p>如果你只需获取 QuerySet count</p>\n<figure id="codee3482258de8d3e56ba0305332cf8a413" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">users</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>\n\n<span class="c1"># Or in template...</span>\n<span class="p">{{</span> <span class="n">users</span><span class="o">.</span><span class="n">count</span> <span class="p">}}</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codee3482258de8d3e56ba0305332cf8a413"><\\>Python</a></figcaption></figure><figure id="codeefd30a7f0c073b4f8355dd23429b58c8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>\n\n<span class="c1"># Or in template...</span>\n<span class="p">{{</span> <span class="n">users</span><span class="o">|</span><span class="n">length</span> <span class="p">}}</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codeefd30a7f0c073b4f8355dd23429b58c8"><\\>Python</a></figcaption></figure><h2 id="Empty QuerySets">Empty QuerySets</h2>\n<p>如果你只想知道 QuerySets 是否为空.</p>\n<figure id="codef36ee94920ac1bcf8c9717669497b04b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">if</span> <span class="n">groups</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>\n    <span class="c1"># Do something...</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codef36ee94920ac1bcf8c9717669497b04b"><\\>Python</a></figcaption></figure><figure id="code025c6ee7931a2a3a1bd5e2d72d992b25" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">if</span> <span class="n">groups</span><span class="p">:</span>\n    <span class="c1"># Do something...</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code025c6ee7931a2a3a1bd5e2d72d992b25"><\\>Python</a></figcaption></figure><h2 id="减少不必要的查询次数">减少不必要的查询次数</h2>\n<p>就是之前讲过的 select_related </p>\n<figure id="codef7d274d07ac62b82b7410f7f283b67ac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># Select the Review and the Author in a single query</span>\n<span class="n">name</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codef7d274d07ac62b82b7410f7f283b67ac"><\\>Python</a></figcaption></figure><figure id="codee723ef0c5ad7062a507a5ce4b7f59e60" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># Select the Review</span>\n<span class="n">name</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span>  <span class="c1"># Additional query to select the Author</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codee723ef0c5ad7062a507a5ce4b7f59e60"><\\>Python</a></figcaption></figure><h2 id="只检索需要的字段">只检索需要的字段</h2>\n<p>假设模型<strong>Invoice</strong>有50个字段，你想要创建一个表格只显示摘要信息，包含<strong>number</strong>、<strong>date</strong>和<strong>value</strong>.</p>\n<figure id="code8bbc1e1881b3f4b71ce79ab07d7bc3c7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>\n<span class="c1"># If you don&#39;t need the model instance, go for:</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>  <span class="c1"># Returns a dict</span>\n\n<span class="c1"># If you still need to access some instance methods, go for:</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>  <span class="c1"># Returns a queryset</span>\n\n<span class="c1"># invoices.html</span>\n<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">invoices</span> <span class="o">%</span><span class="p">}</span>\n    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">date</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">value</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>\n<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code8bbc1e1881b3f4b71ce79ab07d7bc3c7"><\\>Python</a></figcaption></figure><figure id="codece7f2473c0e21c14d240e8145b5c4c0f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n\n<span class="c1"># invoices.html</span>\n<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">invoices</span> <span class="o">%</span><span class="p">}</span>\n    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">date</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">value</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>\n<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codece7f2473c0e21c14d240e8145b5c4c0f"><\\>Python</a></figcaption></figure><h2 id="批量更新">批量更新</h2>\n<p>使用 <code>F()</code> 批量更新.</p>\n<figure id="code63597999fb1d67c0067a87c6e0d7f0bd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code63597999fb1d67c0067a87c6e0d7f0bd"><\\>Python</a></figcaption></figure><figure id="code5573cc06b169b74e7936dd558a910e08" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">*=</span> <span class="mf">1.2</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code5573cc06b169b74e7936dd558a910e08"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-17-latest-and-earliest', 'title': 'Django小技巧17: QuerySets的latest和earliest方法', 'date': datetime.datetime(2018, 11, 5, 14, 58, 39), 'cover': '/uploads/images/earliest-latest.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/earliest-latest.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/06/django-tip-17-earliest-and-latest.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>就像QuerySets的first和last方法一样, Django 还提供了<code>earliest</code>和<code>latest</code>方法. 用于获取最早和最新的数据，增强代码的可读性.</p>\n\n<p>最好在模型的Meta类中先定义<code>get_latest_by</code>属性</p>\n<figure id="codec749248a1d9ed6c7810d5f84c5c38594" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>\n    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>\n    <span class="n">publication_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">change_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>\n        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s1">&#39;publication_date&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec749248a1d9ed6c7810d5f84c5c38594"><\\>Python</a></figcaption></figure>\n<p>然后使用起来非常简单</p>\n<figure id="code9bf117d97b29dd98dfe25db70e7a2070" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">latest_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>\n<span class="n">earliest_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9bf117d97b29dd98dfe25db70e7a2070"><\\>Python</a></figcaption></figure>\n<p>如果没有指定<code>get_latest_by</code>字段， 也可以通过参数来指定</p>\n<figure id="code50721c77d960dc91006c00600c7c3e35" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">latest_change</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s1">&#39;change_date&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code50721c77d960dc91006c00600c7c3e35"><\\>Python</a></figcaption></figure>\n<p>如果以上两种方式都没有提供<code>get_latest_by</code>参数, 将会触发<code>DoesNotExist</code>错误. 它于 first 和 last 不同， 因为first和 last 在没有匹配到结果的情况下将会返回 None.</p>\n\n<p>另外一个需要注意的点是， 和日期作为排序参数的时候， 可能会遇到日期为空的情况， 这时候工作的结果和我们想象的不一致。 所以我们可以过滤下日期为 Null 的结果，再做<code>earliest</code>和<code>latest</code>检索.</p>\n<figure id="coded5e1b3cecd4932507bf8b9fcffc0b6e6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">change_date__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s1">&#39;change_date&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded5e1b3cecd4932507bf8b9fcffc0b6e6"><\\>Python</a></figcaption></figure>\n<p>这两种方法， 通常与<code>DateField</code>、<code>DateTimeField</code>或<code>IntegerField</code>一起使用。应该避免和其他字段一起使用， 因为语义上是错误的。这两种方法主要是提供代码的方便性和可读性， 如果和非时间字段一起使用，会带来新的混淆.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-18-translations', 'title': 'Django小技巧18: ugettext和ugettext_lazy的区别', 'date': datetime.datetime(2018, 11, 5, 15, 20, 39), 'cover': '/uploads/images/translations.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/translations.jpg"></div><figcaption class="img-title">#redirect</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/17/django-tip-18-translations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django API 提供了几个有用的模块来帮助你翻译你的应用程序. 它们都在<code>django.utils.translation</code>中使用，大多数情况下， 我们会使用到ugettext()和ugettext_lazy().</p>\n\n<p>「u」前缀代表「unicode」, 因为大多数情况下，我们经常使用 Unicode,  所以使用ugettext()代替gettext(), 使用ugettext_lazy()代替gettext_lazy().</p>\n\n<p>顾名思义, <q>lazy</q>该函数是对翻译字符串的引用， 而不是实际翻译的文本. 因此在访问值的时候会进行转换， 而不是调用的时候.</p>\n\n<p>注意这个特性，Django 启动的时候一些特定的代码只执行一次， 比如在<strong>models</strong>, <strong>forms</strong>和<strong>model forms</strong>.</p>\n\n<p>那么， 我们假设在模型定义的时候使用ugettext(), 而不是ugettext_lazy()会怎么样?</p>\n\n<ul>\n<li>1. Django 启动, 默认语言是英文.</li>\n<li>2. Django 选择了英文版的field labels</li>\n<li>3. 用户将网站语言改为简体中文.</li>\n<li>4. <strong>field labels</strong>依然是英文显示. </li>\n</ul>\n<blockquote class="blockquote-warning">\n                <p> 因为models的字段定义仅仅被执行一次，并且在执行定义代码的时候语言不是简体中文(一般是英文).</p></blockquote>\n<p>要避免这种行为，要必须正确的使用ugettext()和ugettext_lazy()</p>\n\n<p>下面总结了， 在合适的地方使用合适的函数:</p>\n\n<ul>\n<li><strong>ugettext_lazy():</strong>\n\n<ul>\n<li>models.py (fields, verbose_name, help_text, methods short_description);</li>\n<li>forms.py (labels, help_text, empty_label);</li>\n<li>apps.py (verbose_name).</li>\n</ul></li>\n<li><strong>ugettext():</strong>\n\n<ul>\n<li>views.py</li>\n<li>其他类似于在请求过程中调用的代码</li>\n</ul></li>\n</ul>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-19-protecting-sensitive-information', 'title': 'Django小技巧19: 保护敏感信息', 'date': datetime.datetime(2018, 11, 5, 16, 11, 9), 'cover': '/uploads/images/protecting-sensitive-information.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/protecting-sensitive-information.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/17/django-tip-18-translations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>互联网是一片荒地， 在互联网上部署 Web 服务的时候， 安全是首要考虑的。Django 在提供可靠和安全的API方面做的非常出色.但是前提是你要正确的使用它们。</p>\n\n<p><strong>永远不应该在部署 WEB 服务的时候开启 DEBUG=True</strong></p>\n\n<p>DEBUG = True 一个很大的功能是发生异常的时候从你的环境中转储大量元数据， 并且暴露在页面中。包括整个 settings.py 的配置.</p>\n\n<p>即使你永远不会使用DEBUG = True, 在 settings.py 中命名配置时也需要格外的小心， 确保你的所有敏感配置的字段都包含下面关键字之一：</p>\n\n<ul>\n<li>API</li>\n<li>KEY</li>\n<li>PASS</li>\n<li>SECRET</li>\n<li>SIGNATURE</li>\n<li>TOKEN</li>\n</ul>\n\n<p>这样 Django 就不好转储哪些包含敏感信息的配置变量.</p>\n<figure id="code7218d2243a0e7aa8c4f14fd8343bbd6c" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">S3_BUCKET_KEY</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>\n</pre></div>\n<span class="title-label">#good#Do</span><figcaption><a class="lang-label" href="#code7218d2243a0e7aa8c4f14fd8343bbd6c"><\\>Python</a></figcaption></figure><figure id="code3d25411c82516fa0ca229bcfeb1b1c7e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">S3_BUCKET</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>\n<span class="n">JENKINS_MIMA</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>  <span class="c1"># 使用中文命名 jenkins_token</span>\n</pre></div>\n<span class="title-label">#error#Don\'t</span><figcaption><a class="lang-label" href="#code3d25411c82516fa0ca229bcfeb1b1c7e"><\\>Python</a></figcaption></figure>\n<p>即便你关闭的 DEBUG， 如果 Django 配置了电子邮件发送错误报告，也会有可能在公网环境中泄露错误报告从而泄露 settings 配置, 特别是没有加密的电子邮件传输协议。</p>\n<blockquote class="blockquote-normal">\n                <p><strong>特别注意的一点：</strong> 永远不要把敏感信息提交到公共代码仓库！换句话说，就说不要把敏感信息添加到 settings.py 中， 最好的方式是使用环境变量或者python-decouple. 后续会写一篇将配置上下线分离的文章</p></blockquote>\n<p>说到过滤错误报告，你应该使用两个过滤器:</p>\n<h3 id="sensitive_variables">sensitive_variables</h3>\n<p>可以定义一组局部敏感变量， 这些变量不好显示在错误报告中，从而达到保护它们的作用。</p>\n<figure id="codea67fa14180a5a75e25bcff8effb2f612" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.decorators.debug</span> <span class="kn">import</span> <span class="n">sensitive_variables</span>\n\n<span class="nd">@sensitive_variables</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pw&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)</span>\n<span class="k">def</span> <span class="nf">process_info</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>\n    <span class="n">pw</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">pass_word</span>\n    <span class="n">cc</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">credit_card_number</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea67fa14180a5a75e25bcff8effb2f612"><\\>Python</a></figcaption></figure>\n<p>或者 ，如果想保护函数里的所有变量</p>\n<figure id="code754a32b2f2b8d50bd1654207a1b4b7a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="nd">@sensitive_variables</span><span class="p">()</span>\n<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code754a32b2f2b8d50bd1654207a1b4b7a2"><\\>Python</a></figcaption></figure>\n<p>PS: 使用多个装饰器的时候， 确保<code>@sensitive_variables()</code>装饰器在第一个位置.</p>\n<h3 id="sensitive_post_parameters">sensitive_post_parameters</h3>\n<p>与前面的例子类似， 但这个处理 post 参数.</p>\n<figure id="code27975ba50f17ef046a496d1b3f7b04c2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.decorators.debug</span> <span class="kn">import</span> <span class="n">sensitive_post_parameters</span>\n\n<span class="nd">@sensitive_post_parameters</span><span class="p">(</span><span class="s1">&#39;pass_word&#39;</span><span class="p">,</span> <span class="s1">&#39;credit_card_number&#39;</span><span class="p">)</span>\n<span class="k">def</span> <span class="nf">record_user_profile</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="n">UserProfile</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>\n        <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>\n        <span class="n">password</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;pass_word&#39;</span><span class="p">],</span>\n        <span class="n">credit_card</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;credit_card_number&#39;</span><span class="p">],</span>\n        <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>\n    <span class="p">)</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code27975ba50f17ef046a496d1b3f7b04c2"><\\>Python</a></figcaption></figure>\n<p>隐藏 post 所有参数</p>\n<figure id="code51c3ceefad72cc80611d94b6807b7df4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="nd">@sensitive_post_parameters</span><span class="p">()</span>\n<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code51c3ceefad72cc80611d94b6807b7df4"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于过滤敏感信息的文档. <a href="https://docs.djangoproject.com/en/dev/howto/error-reporting/#filtering-sensitive-information">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-20-multiple-settings-modules', 'title': 'Django小技巧20: 使用多个settings模块', 'date': datetime.datetime(2018, 11, 9, 13, 22, 43), 'cover': '/uploads/images/multiple-settings-modules.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/multiple-settings-modules.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2017/07/03/django-tip-20-working-with-multiple-settings-modules.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>通常来说， 为了保持项目的配置简单，我们会避免使用多个配置文件。但理想很丰满， 现实是随着项目越来越大， <strong>settings.py</strong>可能也会变得相当复杂. 在那种情况下， 你必须使用大量的<code>if</code>语句，类似于: if not DEBUG: # do something... .为了将<strong>development</strong>配置和<strong>production</strong>严格的分离，你可以将<strong>settings</strong>模块分解成多个文件. 这样对我们的配置可能更加清楚.</p>\n<h2 id="默认的基本结构">默认的基本结构</h2>\n<p>一个全新的 Django 项目结构默认情况下如下所示</p>\n<figure id="code05d6da835f01e2946d0d5c5246cdee1f" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings.py\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#code05d6da835f01e2946d0d5c5246cdee1f"><\\>Text</a></figcaption></figure>\n<p>我们在mysite目录中创建一个叫做<strong>settings</strong>的目录, 然后将原有的<strong>settings.py</strong>移动到 settings 目录中， 并更改名字为<strong>base.py</strong>. 如果使用 Python 2.x 增加<code>__init__.py</code>`文件.</p>\n<figure id="code7489c7e8112bf8f35f7929fda9850b83" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings/         &lt;--\n |    |    |-- __init__.py  &lt;--\n |    |    +-- base.py      &lt;--\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#code7489c7e8112bf8f35f7929fda9850b83"><\\>Text</a></figcaption></figure>\n<p>顾名思义, base.py 将提供适用于所有环境(development, production, staging, 等)配置.</p>\n\n<p>然后为每个环境创建一个<strong>settings</strong>模块. 常见的用例有</p>\n\n<ul>\n<li>ci.py</li>\n<li>development.py</li>\n<li>production.py</li>\n<li>staging.py</li>\n</ul>\n\n<p>然后文件结构应该和下面类似:</p>\n<figure id="codea58cd6e90561f3fb378d37613974d2aa" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings/\n |    |    |-- __init__.py\n |    |    |-- base.py\n |    |    |-- ci.py\n |    |    |-- development.py\n |    |    |-- production.py\n |    |    +-- staging.py\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#codea58cd6e90561f3fb378d37613974d2aa"><\\>Text</a></figcaption></figure><h2 id="配置新的settings.py">配置新的settings.py</h2>\n<p>依下面的base.py为例:</p>\n\n<p><strong>settings/base.py</strong></p>\n<figure id="code8ddcbdeeb3ebd19fb94b9824184fb07d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decouple</span> <span class="kn">import</span> <span class="n">config</span>\n\n<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">)</span>\n\n<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;mysite.core&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;mysite.blog&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;mysite.urls&#39;</span>\n\n<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;mysite.wsgi.application&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8ddcbdeeb3ebd19fb94b9824184fb07d"><\\>Python</a></figcaption></figure>\n<p>为了保证实例简单， 我删除其他无效的代码</p>\n\n<p>然后创建<strong>development.py</strong>配置文件， 我可以直接通过 base 来扩展.</p>\n\n<p><strong>settings/development.py</strong></p>\n<figure id="codedb0d77d2f6025f8cf72854858e5cd410" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>\n\n<span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">[</span>\n    <span class="s1">&#39;debug_toolbar&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">MIDDLEWARE</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span><span class="p">,</span> <span class="p">]</span>\n\n<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.console.EmailBackend&#39;</span>\n\n<span class="n">DEBUG_TOOLBAR_CONFIG</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;JQUERY_URL&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedb0d77d2f6025f8cf72854858e5cd410"><\\>Python</a></figcaption></figure>\n<p>然后， 你可以这样定义<strong>production.py</strong>模块</p>\n<figure id="code79b41b1c7330ced34e6ee07192fbc19f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>\n\n<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mysite.com&#39;</span><span class="p">,</span> <span class="p">]</span>\n\n<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>\n        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">,</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.smtp.EmailBackend&#39;</span>\n<span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s1">&#39;smtp.mailgun.org&#39;</span>\n<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="mi">587</span>\n<span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;EMAIL_HOST_USER&#39;</span><span class="p">)</span>\n<span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;EMAIL_HOST_PASSWORD&#39;</span><span class="p">)</span>\n<span class="n">EMAIL_USE_TLS</span> <span class="o">=</span> <span class="bp">True</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code79b41b1c7330ced34e6ee07192fbc19f"><\\>Python</a></figcaption></figure>\n<p><strong>注意:</strong> 应该避免使用<code>import *</code>导入，<code>*</code>导入可能会在命名空间作用域中导入一些不必要的东西. 在某些情况下可能会产生冲突, 造成奇怪的问题. 另外一个问题是即使使用多个配置文件， 你依然要注意敏感数据的问题. 强烈推荐使用**Python-Decouple ** 这样的库来保护配置, 或者通过环境变量的形式使用密码或密钥配置.</p>\n<h2 id="如何使用多个配置文件">如何使用多个配置文件</h2>\n<p>因为我们代码库中已经没有<code>settings.py</code>文件， 所以不能直接使用<code>python manage.py runserver</code>.相反你必须在命令参数中指定settings模块.</p>\n<figure id="code019acd3f289fed2c351c1f923190bc66" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py runserver --settings<span class="o">=</span>mysite.settings.development\n</pre></div>\n<figcaption><a class="lang-label" href="#code019acd3f289fed2c351c1f923190bc66"><\\>Shell</a></figcaption></figure>\n<p>Or</p>\n<figure id="coded35439998717738e08dea07e08535828" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py migrate --settings<span class="o">=</span>mysite.settings.production\n</pre></div>\n<figcaption><a class="lang-label" href="#coded35439998717738e08dea07e08535828"><\\>Shell</a></figcaption></figure>\n<p>由于我们在开发中经常使用 manage.py, 因此你可以在<strong>manage.py</strong>中， 硬编码写死配置模块.</p>\n\n<p><strong>manage.py</strong></p>\n<figure id="code16cd95e6e570a1c255d807f715218ef7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>\n<span class="kn">import</span> <span class="nn">os</span>\n<span class="kn">import</span> <span class="nn">sys</span>\n\n<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>\n    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings.development&quot;</span><span class="p">)</span>  <span class="c1"># &lt;-- Change here!</span>\n    <span class="k">try</span><span class="p">:</span>\n        <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>\n    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>\n        <span class="c1"># The above import may fail for some other reason. Ensure that the</span>\n        <span class="c1"># issue is really that Django is missing to avoid masking other</span>\n        <span class="c1"># exceptions on Python 2.</span>\n        <span class="k">try</span><span class="p">:</span>\n            <span class="kn">import</span> <span class="nn">django</span>\n        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>\n            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>\n                <span class="s2">&quot;Couldn&#39;t import Django. Are you sure it&#39;s installed and &quot;</span>\n                <span class="s2">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span>\n                <span class="s2">&quot;forget to activate a virtual environment?&quot;</span>\n            <span class="p">)</span>\n        <span class="k">raise</span>\n    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code16cd95e6e570a1c255d807f715218ef7"><\\>Python</a></figcaption></figure>\n<p>所以， 我们只改动了一行</p>\n<figure id="codeb74f15a9d060eb3cacada3a2e7542bc0" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb74f15a9d060eb3cacada3a2e7542bc0"><\\>Python</a></figcaption></figure>\n<p>改为</p>\n<figure id="codebeac03ec6755114da45849580257cb14" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings.development&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebeac03ec6755114da45849580257cb14"><\\>Python</a></figcaption></figure><h2 id="也许可以更稳妥">也许可以更稳妥</h2>\n<p>现在我们有了多个配置模块， 这样你可以将<strong>AUTH<em>PASSWORD</em>VALIDATORS</strong>配置从<strong>base.py</strong>中移动到<strong>production.py</strong>中. 这样, 你可以在开发环境中使用简单密码(如: <q>123</q>). 但在生产环境中必须要通过密码验证才能使用.</p>\n\n<p>在你测试环境中的配置文件中(settings/ci.py or settings/tests.py), 覆盖以下配置, 以便加快你的测试用例速度:</p>\n<figure id="code78c5878fbb122d1bc74ba943cb0d9e3d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span>\n<span class="p">}</span>\n\n<span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">(</span>\n    <span class="s1">&#39;django.contrib.auth.hashers.MD5PasswordHasher&#39;</span><span class="p">,</span>\n<span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code78c5878fbb122d1bc74ba943cb0d9e3d"><\\>Python</a></figcaption></figure><h2 id="结论">结论</h2>\n<p>多个配置文件虽然提供了便利， 但你还是需要小心使用. 任何情况下都要考虑安全. 如果有疑问， 通过下面评论讨论.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-21-redirects', 'title': 'Django小技巧21: 使用重定向', 'date': datetime.datetime(2018, 11, 9, 15, 14, 28), 'cover': '/uploads/images/redirects.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2017/08/11/django-tip-21-redirects-app.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 附带了一组可以轻松安装的可选模块, 其中一个模块就是重定向的模块, 它在您想要更新某些现有URL而不损害您的网站SEO或在任何情况下避免404错误的情况下特别有用。</p>\n\n<p>比如我现有的 URL 是</p>\n<figure id="code46cf1fbb18978888fa191ed6539b7f9b" class="code-wrapper"><div class="highlight"><pre><span></span>/tips/2017/08/11/django-tip-21.html\n</pre></div>\n<figcaption><a class="lang-label" href="#code46cf1fbb18978888fa191ed6539b7f9b"><\\>Url</a></figcaption></figure>\n<p>在某一次更新之后 URL 有变动变成了:</p>\n<figure id="codec7a547998b0bed9b90653c100ec5a705" class="code-wrapper"><div class="highlight"><pre><span></span>/tips/redirects-app/\n</pre></div>\n<figcaption><a class="lang-label" href="#codec7a547998b0bed9b90653c100ec5a705"><\\>Url</a></figcaption></figure>\n<p>而且我原有 URL， 已经被搜索引擎收录. 我不想在用户通过搜索引擎点过来是404页面。 这时候就需要做重定向到新的地址</p>\n\n<p>redirects 模块是通过在数据库中创建一张表, 包含两个字段(old_path和new_path)来实现的.每当你的项目出现404错误的时候，redirects 组件将会拦截404响应， 并检索特定的 table 进行匹配, 如果在特定的 table 中匹配到old_path ,将会重定向到所绑定的new_path. 不会返回404, 而返回一个301响应(Moved Permanently).</p>\n\n<p>OK, 让我看看redirects在实践中如何执行</p>\n<h2 id="安装">安装</h2>\n<p>Django redirects 组件需要安装<strong>sites</strong>框架. 通过<strong>settings.py</strong>的<strong>INSTALLED_APPS</strong>来添加到项目中。</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code1b5dff6e40aaf2f7920710e1fefa7a73" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.sites&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.redirects&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b5dff6e40aaf2f7920710e1fefa7a73"><\\>Python</a></figcaption></figure>\n<p>设置<code>SITE_ID</code>让<strong>sites</strong>框架能够工作.</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code712d5bdfab183e580ab067f0e51feec8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code712d5bdfab183e580ab067f0e51feec8"><\\>Python</a></figcaption></figure>\n<p>现在将redirects的中间件添加到<strong>MIDDLEWARE</strong></p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code46e923b4835da1853076562364cd23c5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.redirects.middleware.RedirectFallbackMiddleware&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code46e923b4835da1853076562364cd23c5"><\\>Python</a></figcaption></figure>\n<p>通过<strong>migrate</strong>创建所需要的表：</p>\n<figure id="codecd3823dcb5cd6a0b316e48cfda8c2d95" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py migrate\n</pre></div>\n<figcaption><a class="lang-label" href="#codecd3823dcb5cd6a0b316e48cfda8c2d95"><\\>Shell</a></figcaption></figure><h2 id="使用">使用</h2>\n<p>最简单的方式通过 Django Admin 来对这个表添加记录. 如果你没有 Django Admin, 并且此操作是一次性的事情, 你可以通过redirects的 Python API 或者创建一个<strong>fixture</strong>. 如果你不使用Django Admin 但这个不是一次性的事情， 需要后面维护更新这个表， 那么你需要创建一个自己的视图管理页面.</p>\n<h3 id="通过DjangoAdmin管理redirects">通过DjangoAdmin管理redirects</h3>\n<p>默认情况下， 安装后会自动加到 Django Admin 界面</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects-admin.png"></div><figcaption class="img-title">#Django Admin 管理 redirects</figcaption></figure></p>\n\n<p>只需添加对应的路径， redirects组件将会自动完成这个重定向工作</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects-admin-create.png"></div><figcaption class="img-title">#redirects table</figcaption></figure></p>\n\n<p>你可以通过浏览器来访问旧的路径， 看看他是否能够正常的重定向. 另一种方法是检测响应的body, 可以通过<code>curl</code>来完成:</p>\n<figure id="code193a726836828e503dbb0c3e410f5816" class="code-wrapper"><div class="highlight"><pre><span></span>curl --head <span class="m">127</span>.0.0.1:8000/tips/2017/08/11/django-tip-21.html\n\nHTTP/1.0 <span class="m">301</span> Moved Permanently\nDate: Fri, <span class="m">11</span> Aug <span class="m">2017</span> <span class="m">15</span>:42:27 GMT\nServer: WSGIServer/0.2 CPython/3.6.1\nContent-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8\nLocation: /tips/redirects-app/\nX-Frame-Options: SAMEORIGIN\nContent-Length: <span class="m">0</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code193a726836828e503dbb0c3e410f5816"><\\>Shell</a></figcaption></figure><h3 id="通过Python API管理redirects">通过Python API管理redirects</h3>\n<p>你可以通过 Django ORM 来对 redirects 的 Model 进行操作管理. 它位于<a href="https://github.com/django/django/blob/master/django/contrib/redirects/models.py">django/contrib/redirects/models.py</a>.</p>\n\n<p>以下是创建redirects 条目的示例代码:</p>\n<figure id="code1b4ce31f86b1f1817e98d3835f4ea18d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.redirects.models</span> <span class="kn">import</span> <span class="n">Redirect</span>\n<span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>\n<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>\n\n<span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">SITE_ID</span><span class="p">)</span>\n\n<span class="n">Redirect</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">old_path</span><span class="o">=</span><span class="s1">&#39;/index.html&#39;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>\n<span class="n">Redirect</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">old_path</span><span class="o">=</span><span class="s1">&#39;/tips/2017/08/11/django-tip-21.html&#39;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="s1">&#39;/tips/redirects-app/&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b4ce31f86b1f1817e98d3835f4ea18d"><\\>Python</a></figcaption></figure><h3 id="通过Fixtures导入redirects">通过Fixtures导入redirects</h3>\n<p>关于Fixtures, 是 Django 提供的一个功能， 可以到这里<a href="https://code.djangoproject.com/wiki/Fixtures">查看文档了解更多</a>.</p>\n\n<p>首先按照以下示例的模板创建 JSON 文件</p>\n\n<p><strong>redirects-fixture.json</strong></p>\n<figure id="codee752ff4322bd3c92360c50e4cb26fbb4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">[</span>\n   <span class="p">{</span>\n      <span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;redirects.redirect&quot;</span><span class="p">,</span>\n      <span class="nt">&quot;fields&quot;</span><span class="p">:{</span>\n         <span class="nt">&quot;site&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>\n         <span class="nt">&quot;old_path&quot;</span><span class="p">:</span><span class="s2">&quot;/tips/2017/08/11/django-tip-21.html&quot;</span><span class="p">,</span>\n         <span class="nt">&quot;new_path&quot;</span><span class="p">:</span><span class="s2">&quot;/tips/redirects-app/&quot;</span>\n      <span class="p">}</span>\n   <span class="p">},</span>\n   <span class="p">{</span>\n      <span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;redirects.redirect&quot;</span><span class="p">,</span>\n      <span class="nt">&quot;fields&quot;</span><span class="p">:{</span>\n         <span class="nt">&quot;site&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>\n         <span class="nt">&quot;old_path&quot;</span><span class="p">:</span><span class="s2">&quot;/index.html&quot;</span><span class="p">,</span>\n         <span class="nt">&quot;new_path&quot;</span><span class="p">:</span><span class="s2">&quot;/&quot;</span>\n      <span class="p">}</span>\n   <span class="p">}</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee752ff4322bd3c92360c50e4cb26fbb4"><\\>Json</a></figcaption></figure>\n<p>然后通过命令将其加载到数据库</p>\n<figure id="code9237c41bfbc81e877d03026a7d76bf40" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py loaddata redirects-fixtures.json\nInstalled <span class="m">2</span> object<span class="o">(</span>s<span class="o">)</span> from <span class="m">1</span> fixture<span class="o">(</span>s<span class="o">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9237c41bfbc81e877d03026a7d76bf40"><\\>Shell</a></figcaption></figure>\n<p>就是这样~</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-22-designing-better-models', 'title': 'Django小技巧22: 设计一个好的模型', 'date': datetime.datetime(2018, 11, 9, 16, 14, 28), 'cover': '/uploads/images/designing-better-models.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/designing-better-models.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2018/02/10/django-tip-22-designing-better-models.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇将分享一些技巧，用户改进 Model 的设计。其中有很多与命名约定有关， 这可以大大的提高代码的可读性。</p>\n\n<p><a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a>规范， 广泛用于 Python 领域, 因此我建议你在项目中使用它.</p>\n\n<p>除了 PEP8 ， 我更喜欢<a href="https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/">Django编程风格</a>.</p>\n\n<p>本篇目录:</p>\n\n<ul>\n<li><a href="#naming-your-models">命名你的Model</a></li>\n<li><a href="#model-style-ordering">Model定义顺序</a></li>\n<li><a href="#reverse-relationships">反向关系</a></li>\n<li><a href="#blank-and-null-fields">Blank 和 Null</a></li>\n</ul>\n\n<h2 id="naming-your-models">命名 Model</h2>\n\n<p>模型定义使用<strong>CapWords</strong>约定(没有下划线). 例如: <code>User</code>, <code>Permission</code>, <code>ContentType</code>.</p>\n\n<p>模型的属性使用 <a href="https://en.wikipedia.org/wiki/Snake_case"><strong>snake_case</strong></a>. 例如: <code>first_name</code>, <code>last_name</code>.</p>\n\n<p>如:</p>\n<figure id="code82af3882f60e194c81048eee8607db92" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">vat_identification_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code82af3882f60e194c81048eee8607db92"><\\>Python</a></figcaption></figure>\n<p><strong>始终使用单数明明你的模型</strong>, 用<strong>Company</strong>代替<strong>Companies</strong>. 模型的定义是对单个对象的表示， 而不是公司的集合.</p>\n\n<p>这通常会导致混淆，因为我们倾向于通过数据库思考。模型最终被翻译成table.该表使用其复数形式命名的.</p>\n\n<p>在 DJango 中，我们可以通过<code>Company.objects</code>来访问集合. 我可以通过定义<strong>models.Manager</strong>重命名<strong>objects</strong>属性.</p>\n<figure id="codeb1b6413da0603116cd3d2c9ad80d389d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="c1"># ...</span>\n    <span class="n">companies</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb1b6413da0603116cd3d2c9ad80d389d"><\\>Python</a></figcaption></figure>\n<p>而后， 可以通过下面语句来使用 Django ORM QuerySet 查询.</p>\n<figure id="codec5a363fa95df8b0368ad9bc12d55371b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Company</span><span class="o">.</span><span class="n">companies</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec5a363fa95df8b0368ad9bc12d55371b"><\\>Python</a></figcaption></figure>\n<p>这样看起来代码就很有可读性了</p>\n\n<h2 id="model-style-ordering">Model 定义顺序</h2>\n\n<p>Django Coding Style 建议内部类，方法和属性的顺序为：</p>\n\n<ul>\n<li>如果字段有<code>choices</code>参数, 则每个选项定义为元祖中元祖.并使用全大写的名称作为值属性。</li>\n<li>所有数据库fields</li>\n<li>Custom manager attributes</li>\n<li>class Meta</li>\n<li>def __str__()</li>\n<li>def save()</li>\n<li>def get_absolute_url()</li>\n<li>其他自定义方法</li>\n</ul>\n\n<p>如:</p>\n<figure id="code4a09ea34c784bf9d4ab3a91009142347" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="c1"># CHOICES</span>\n    <span class="n">PUBLIC_LIMITED_COMPANY</span> <span class="o">=</span> <span class="s1">&#39;PLC&#39;</span>\n    <span class="n">PRIVATE_COMPANY_LIMITED</span> <span class="o">=</span> <span class="s1">&#39;LTD&#39;</span>\n    <span class="n">LIMITED_LIABILITY_PARTNERSHIP</span> <span class="o">=</span> <span class="s1">&#39;LLP&#39;</span>\n    <span class="n">COMPANY_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>\n        <span class="p">(</span><span class="n">PUBLIC_LIMITED_COMPANY</span><span class="p">,</span> <span class="s1">&#39;Public limited company&#39;</span><span class="p">),</span>\n        <span class="p">(</span><span class="n">PRIVATE_COMPANY_LIMITED</span><span class="p">,</span> <span class="s1">&#39;Private company limited by shares&#39;</span><span class="p">),</span>\n        <span class="p">(</span><span class="n">LIMITED_LIABILITY_PARTNERSHIP</span><span class="p">,</span> <span class="s1">&#39;Limited liability partnership&#39;</span><span class="p">),</span>\n    <span class="p">)</span>\n\n    <span class="c1"># DATABASE FIELDS</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">vat_identification_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;VAT&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>\n    <span class="n">company_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">COMPANY_TYPE_CHOICES</span><span class="p">)</span>\n\n    <span class="c1"># MANAGERS</span>\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>\n    <span class="n">limited_companies</span> <span class="o">=</span> <span class="n">LimitedCompanyManager</span><span class="p">()</span>\n\n    <span class="c1"># META CLASS</span>\n    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>\n        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>\n        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;companies&#39;</span>\n\n    <span class="c1"># TO STRING METHOD</span>\n    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>\n\n    <span class="c1"># SAVE METHOD</span>\n    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>\n        <span class="n">do_something</span><span class="p">()</span>\n        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Call the &quot;real&quot; save() method.</span>\n        <span class="n">do_something_else</span><span class="p">()</span>\n\n    <span class="c1"># ABSOLUTE URL METHOD</span>\n    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;company_details&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>\n\n    <span class="c1"># OTHER METHODS</span>\n    <span class="k">def</span> <span class="nf">process_invoices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="n">do_something</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4a09ea34c784bf9d4ab3a91009142347"><\\>Python</a></figcaption></figure>\n<h2 id="reverse-relationships">反向关系</h2>\n<h3 id="related_name">related_name</h3>\n<p>ForeignKey 的 related_name 可以为反向关系定义一个有意义的名称</p>\n\n<p>经验法则: 如果你不确定<code>related_name</code>是什么， 请使用包含所定义ForeignKey的模型的复数形式.</p>\n<figure id="code8c340dbb880156ed3bbff4a74e97befe" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">:</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>\n    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">company</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;employees&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8c340dbb880156ed3bbff4a74e97befe"><\\>Python</a></figcaption></figure>\n<p>上面代码意味着， Company 有一个<code>employees</code>特殊属性, 该属性将返回一个 QuerySet，其中包含与此公司相关的所有员工实例</p>\n<figure id="code3a789939eb0a5e524a81923ced225077" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">google</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n<span class="n">google</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3a789939eb0a5e524a81923ced225077"><\\>Python</a></figcaption></figure>\n<p>你也可以通过反向关系， 来更新Company的employees字段.</p>\n<figure id="coded8ac79af0749ec7ff9ae3332b0d1a56a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">vitor</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n<span class="n">google</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n<span class="n">google</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vitor</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded8ac79af0749ec7ff9ae3332b0d1a56a"><\\>Python</a></figcaption></figure><h3 id="related_query_name">related_query_name</h3>\n<p>这种关系也是用于查询过滤器， 比如我们要查询雇佣名为「Vitor」的所有公司:</p>\n<figure id="codee6b69be1e82e866e689987d3c6e912e6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">companies</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">employee__first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee6b69be1e82e866e689987d3c6e912e6"><\\>Python</a></figcaption></figure>\n<p>如果你想自定义此关系的查询名称可以这样</p>\n<figure id="code89c6bd9493f5bc683c7cb8e15c7a9a0e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>\n    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">company</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>\n        <span class="n">Company</span><span class="p">,</span>\n        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>\n        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;employees&#39;</span><span class="p">,</span>\n        <span class="n">related_query_name</span><span class="o">=</span><span class="s1">&#39;person&#39;</span>\n    <span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code89c6bd9493f5bc683c7cb8e15c7a9a0e"><\\>Python</a></figcaption></figure>\n<p>然后这样查询</p>\n<figure id="code09b030a9819fe4b2e2f822e98a5f2a65" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">companies</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">person__first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code09b030a9819fe4b2e2f822e98a5f2a65"><\\>Python</a></figcaption></figure>\n<p>代码要保持一致， <strong>related_name</strong>是复数, <strong>related_query_name</strong>是单数.</p>\n\n<h2 id="blank-and-null-fields">Blank 和 Null</h2>\n\n<p>我在另一篇文章有讲过两者的区别 <a href="/words/django-tips-08-blank-or-null.html">Blank or Null</a>，在这里我会总结一下.</p>\n\n<ul>\n<li><strong>null</strong>: 数据库相关； 定义数据库字段的值是否接受空值。</li>\n<li><strong>blank</strong>: 验证相关， 当调用<code>form.is_valid()</code>时， 将会判断值是否为空.</li>\n</ul>\n\n<p>虽然两者的是有区别的， 但一个拥有<code>null=True</code>和<code>blank=False</code>的字段是完全没有问题的。 在数据库级别上， 该字段可以为 NULL， 但在应用程序级别上， 它是必填字段(前提你通过 Django 标准的 Form 进行判断)。</p>\n\n<p>大多数开发人员都对基于字符串的字段(<code>CharField</code>和<code>TextField</code>)定义<code>null=True</code>, 这其实是没有必要的, 应该避免这样做，因为 Django约定使用空字符串设置空值， 而非<strong>Null</strong>.</p>\n\n<p>所以， 如果你想设置一个基于字符的字段可以为空，那么你应该这样做:</p>\n<figure id="code61eab99acda25e6f31dc2df010946917" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>  <span class="c1"># 强制填写</span>\n    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 可选填写 (不要设置null=True)</span>\n    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 可选填写 (这里你应该设置null=True)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code61eab99acda25e6f31dc2df010946917"><\\>Python</a></figcaption></figure><h2 id="进阶">进阶</h2>\n<p>模型定义是应用程序重要的一部分， 请务必使用合适的字段类型. 这里是 <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#field-types">Django 支持的所有字段类型</a>.</p>\n\n<p>如果你对代码风格规范感兴趣， 可以读一读<a href="https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/">Django Coding Style</a>. 当然也可以看一看<a href="http://flake8.pycqa.org/en/latest/">Flake8</a>.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('Django小技巧', [{'filename': 'django-tips-01-redirect', 'title': 'Django小技巧01: redirect', 'date': datetime.datetime(2018, 10, 25, 11, 52, 23), 'cover': '/uploads/images/redirect.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirect.jpeg"></div><figcaption class="img-title">#redirect</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/05/django-tip-1-redirect.html">simpleisbetterthancomplex.com</a></p></blockquote><figure id="code25a757919c24727ebc648c46d1e1f696" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code25a757919c24727ebc648c46d1e1f696"><\\>Python</a></figcaption></figure>\n<p><code>redirect</code>函数会返回一个<code>HttpResponseRedirect</code>类，比起<code>HttpResponseRedirect</code>类我更喜欢使用更简洁的<code>redirect</code>. 它会使我的代码保持一致。</p>\n\n<p>推荐使用 redirect 的理由是， 您可以指定不同类型的参数(model, url, endpoint)，指定 endpoint 的时候还可以直接指定URL， 不用再用<code>django.urlresolvers.reverse</code>来解析一遍了， 简洁了作用域环境.</p>\n\n<p>下面我们来看看实例:</p>\n\n<ul>\n<li>一个模型实例, 这将自动调用模型的<code>get_absolute_url()</code>方法;</li>\n</ul>\n<figure id="codecf708bfb57d25b749f50996f5f648fda" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n<span class="kn">from</span> <span class="nn">simple_blog.models</span> <span class="kn">import</span> <span class="n">Post</span>\n\n<span class="k">def</span> <span class="nf">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>\n    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(post.get_absolute_url())</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codecf708bfb57d25b749f50996f5f648fda"><\\>Python</a></figcaption></figure>\n<ul>\n<li>反解析endpoint URL 名称(接受视图 endpoint 参数)</li>\n</ul>\n<figure id="codedd0af40d500a795437fc3f30b90cbd91" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n<span class="kn">from</span> <span class="nn">simple_blog.models</span> <span class="kn">import</span> <span class="n">Post</span>\n\n<span class="k">def</span> <span class="nf">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;post_details&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(reverse(&#39;post_details&#39;, args=(post_id, )))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedd0af40d500a795437fc3f30b90cbd91"><\\>Python</a></figcaption></figure>\n<ul>\n<li>原始URL (aboluste 或者 relative)</li>\n</ul>\n<figure id="codec2de11ef9bc14a0d688315581e6df555" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">redirect</span>\n\n<span class="k">def</span> <span class="nf">relative_url_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/posts/archive/&#39;</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(&#39;/posts/archive/&#39;)</span>\n\n<span class="k">def</span> <span class="nf">absolute_url_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;https://simpleblog.com/posts/archive/&#39;</span><span class="p">)</span>\n    <span class="c1"># equivalent to: return HttpResponseRedirect(&#39;https://simpleblog.com/posts/archive/&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec2de11ef9bc14a0d688315581e6df555"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于redirect的文档. <a href="https://docs.djangoproject.com/en/dev/topics/http/shortcuts/#redirect">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-02-humanize', 'title': 'Django小技巧02: humanize', 'date': datetime.datetime(2018, 10, 25, 11, 53, 23), 'cover': '/uploads/images/humanize.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/humanize.jpeg"></div><figcaption class="img-title">#humanize</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/09/django-tip-2-humanize.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 附带一组模板过滤器， 可为您的数据添加<q>人性化</q>选项。它用于将数字或者日期转化为人类友好可读的格式.</p>\n\n<p>就我个人来说， 我使用模板过滤器<code>naturaltime</code>非常频繁。 比如我在<code>2018-10-25 11:33:24</code>定了个外卖， 在等待外卖的过程中， 订单页面的时间显示为<code>21 minutes ago</code>(考虑到目前是<code>2018-10-25 11:54:46</code>) 更好友好一点， 我能清楚的知道我等待了多长时间。 而不是<code>2018-10-25 11:54:46</code>这样的时间， 让我再计算一遍.</p>\n\n<p>使用方法也非常简单:</p>\n\n<p>在 <code>settings.py</code> <code>INSTALLED_APPS</code> 加入<code>django.contrib.humanize</code>.</p>\n<figure id="codebae0a5e28be1bcb26ae8f2b82857e837" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.humanize&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebae0a5e28be1bcb26ae8f2b82857e837"><\\>Python</a></figcaption></figure>\n<p>然后在 template 中, 载入此 APP 下的标签。</p>\n<figure id="codeb3ab2359611e8d8b4393c0b0e46930eb" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb3ab2359611e8d8b4393c0b0e46930eb"><\\>Django</a></figcaption></figure>\n<p>使用过滤器也非常简单， 比如使用<code>naturaltime</code>过滤器.</p>\n<figure id="code09e9f258313476e978beed20620653cc" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n\n<span class="cp">{%</span> <span class="k">load</span> <span class="nv">humanize</span> <span class="cp">%}</span><span class="x"></span>\n\n<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;ul&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">notification</span> <span class="k">in</span> <span class="nv">notifications</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li&gt;</span>\n<span class="x">        </span><span class="cp">{{</span> <span class="nv">notification</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">        &lt;small&gt;</span><span class="cp">{{</span> <span class="nv">notification.date</span><span class="o">|</span><span class="nf">naturaltime</span> <span class="cp">}}</span><span class="x">&lt;/small&gt;</span>\n<span class="x">      &lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li&gt;You have no unread notification.&lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/ul&gt;</span>\n<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code09e9f258313476e978beed20620653cc"><\\>Django</a></figcaption></figure>\n<ul>\n<li>功能表</li>\n</ul>\n<div class="code table-wrapper"><table><thead>\n<tr>\n<th style="text-align: center">过滤器</th>\n<th style="text-align: center">作用</th>\n<th style="text-align: left">举例</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td style="text-align: center">apnumber</td>\n<td style="text-align: center">英文数字</td>\n<td style="text-align: left"><code>1</code> =&gt; <code>one</code></td>\n</tr>\n<tr>\n<td style="text-align: center">intcomma</td>\n<td style="text-align: center">三位逗号数字</td>\n<td style="text-align: left"><code>4500000</code> =&gt; <code>4,500,000</code></td>\n</tr>\n<tr>\n<td style="text-align: center">intword</td>\n<td style="text-align: center">文本数字</td>\n<td style="text-align: left"><code>4500000</code> =&gt; <code>4.5 million</code></td>\n</tr>\n<tr>\n<td style="text-align: center">naturalday</td>\n<td style="text-align: center">友好的日期</td>\n<td style="text-align: left"><code>2018-10-24</code> =&gt; <code>yesterday</code></td>\n</tr>\n<tr>\n<td style="text-align: center">naturaltime</td>\n<td style="text-align: center">友好的时间</td>\n<td style="text-align: left"><code>2018-10-25 12:00:01</code> =&gt; <code>a minute ago.</code></td>\n</tr>\n<tr>\n<td style="text-align: center">ordinal</td>\n<td style="text-align: center">序数字符串</td>\n<td style="text-align: left"><code>3</code> =&gt; <code>3rd</code></td>\n</tr>\n</tbody>\n</table></div><blockquote class="blockquote-normal">\n                <p>阅读更多关于humanize的文档. <a href="https://docs.djangoproject.com/en/dev/ref/contrib/humanize/">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-03-optimize-database-queries', 'title': 'Django小技巧03: 优化数据库查询', 'date': datetime.datetime(2018, 10, 25, 11, 54, 23), 'cover': '/uploads/images/odq.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/odq.jpeg"></div><figcaption class="img-title">#Fast</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/16/django-tip-3-optimize-database-queries.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本文介绍一个非常简单的技巧， 能够帮助你在使用 <code>Django ORM</code> 时优化数据库查询.</p>\n\n<p>需要注意的是， Django QuerySets 是惰性查询的， 如果使用得当非常适用。</p>\n\n<p>例如， 我们有一个叫做Invoice模型，并执行以下代码:</p>\n<figure id="code5b1c774ebc55875ab643bdc890b6d0f7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">unpaid_invoices</span> <span class="o">=</span> <span class="n">invoices</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;UNPAID&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5b1c774ebc55875ab643bdc890b6d0f7"><\\>Python</a></figcaption></figure>\n<p>此时， <code>Django ORM</code> 还没有触及到数据库，也就是说没有执行操作。当我们调用这个 queryset(unpaid_invoices) 才会真正的执行到数据库查询。通常情况下， 当我们去遍历这个 Queryset 就会发生这种情况， 即 queryset 开始执行。如下面代码所示:</p>\n<figure id="codee5c83e1f94d1aa174de542c5921ef402" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;table&gt;</span>\n<span class="x">  &lt;tbody&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">invoice</span> <span class="k">in</span> <span class="nv">unpaid_invoices</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;tr&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.id</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.description</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">    &lt;/tr&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/tbody&gt;</span>\n<span class="x">&lt;/table&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee5c83e1f94d1aa174de542c5921ef402"><\\>Django</a></figcaption></figure>\n<p>上面的代码， 看起来没有什么问题。只会执行一个数据库查询。 但是当您的模型有关系数据字段时， 比如<code>ForeignKey</code>, <code>OneToOneField</code> 或 <code>ManyToManyField</code>. 上面的查询就会发生变化了。 </p>\n\n<p>假设<code>Invoice</code>模型有一个vendor字段是个<code>ForeignKey</code>:</p>\n<figure id="code5f22b6b8f3f940bb1329cea8990eac8c" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Invoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>\n    <span class="n">vendor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Vendor</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5f22b6b8f3f940bb1329cea8990eac8c"><\\>Python</a></figcaption></figure>\n<p>现在和上面的模板中一样去迭代这个 queyset， 但这次显示了供应商名称，<code>Django ORM</code>将对<code>unpaid_invoices</code>数据集每一条记录执行一次额外的查询.</p>\n<figure id="code2bff10485b1c6586c66946d5cd2524c4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;table&gt;</span>\n<span class="x">  &lt;tbody&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">invoice</span> <span class="k">in</span> <span class="nv">unpaid_invoices</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;tr&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.id</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.description</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">      &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">invoice.vendor.name</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>\n<span class="x">    &lt;/tr&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/tbody&gt;</span>\n<span class="x">&lt;/table&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2bff10485b1c6586c66946d5cd2524c4"><\\>Django</a></figcaption></figure>\n<p>如果<code>unpaid_invoices</code>数据集有100条记录， 那么将会有101条查询生成。检索invoices所有对象的一条查询， 和每个invoice供应商的一次查询， 共计101条。</p>\n\n<p>当然， 可以使用<code>select_related</code>方法， 来减轻这种不期望的影响，以便在单次数据查询中，检索所有必要的信息。</p>\n\n<p>所以，不要像上面那样过滤未付款的发票，可以这样做:</p>\n<figure id="codefb9cc33eb24bc9c53e996a09f9c98a85" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">unpaid_invoices</span> <span class="o">=</span> <span class="n">invoices</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;vendor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;UNPAID&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefb9cc33eb24bc9c53e996a09f9c98a85"><\\>Python</a></figcaption></figure>\n<p>这样， <code>Django ORM</code> 将会在同一查询中为每个发票检索供应商数据.因此这种情况不需要额外的查询，这样可以为您的应用程序出色的性能提升。</p>\n\n<p>推荐一个可以跟踪数据库查询的调试工具<a href="https://django-debug-toolbar.readthedocs.io/">Django Debug Toolbar</a></p>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Django QuerySet API的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/querysets/#select-related">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-04-automatic-datetime-fields', 'title': 'Django小技巧04: 自动日期时间字段', 'date': datetime.datetime(2018, 10, 25, 11, 55, 23), 'cover': '/uploads/images/time.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/time.jpeg"></div><figcaption class="img-title">#Time</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/05/23/django-tip-4-automatic-datetime-fields.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 的<code>DateTimeField</code>和<code>DateField</code>有两个非常有用的参数，用于自动管理时间。如果你需要跟踪保存纪录的创建时间和更改时间，则无须手动执行，只需要加上<code>auto_now</code>和<code>auto_now_add</code>参数并设置为<code>True</code>即可。 如下面例子所示:</p>\n<figure id="codefe2f5182d438f10dc7383cdaaf668634" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Invoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>\n    <span class="n">vendor</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Vendor</span><span class="p">)</span>\n    <span class="n">created_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefe2f5182d438f10dc7383cdaaf668634"><\\>Python</a></figcaption></figure>\n<ul>\n<li><code>auto_now_add</code>在创建的时候设置字段为<code>timezone.now()</code></li>\n<li><code>auto_now</code> 在每次调用<code>save</code>方法都会更新字段</li>\n</ul>\n\n<p>需要注意的是， 两个参数都将使用<code>timezone.now()</code>更新字段值，这意味着纪录创建的时候两个字段都将会填充。</p>\n\n<p>这是一个非常简单的技巧， 让你的代码变得非常清晰。</p>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Automatic DateTime Fields的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#datefield">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-05-how-to-merge-querysets', 'title': 'Django小技巧05: 合并QuerySets', 'date': datetime.datetime(2018, 10, 25, 11, 56, 23), 'cover': '/uploads/images/merge-queryset.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/merge-queryset.jpg"></div><figcaption class="img-title">#train tracks</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/06/20/django-tip-5-how-to-merge-querysets.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>当你想要让两个或者多个 queryset 合并为一个 queryset 的时候， 并且希望使用 list， 而且想要保留对象的<code>filter</code>, <code>count</code>, <code>distinct</code>等 queryset 方法。</p>\n\n<p>查看以下模型：</p>\n<figure id="codef549e386e84a7eefbd653f7205906f8a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Story</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>\n    <span class="n">content</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;stories&#39;</span><span class="p">)</span>\n    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;stories&#39;</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Medium</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">stories</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Story</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef549e386e84a7eefbd653f7205906f8a"><\\>Python</a></figcaption></figure>\n<p>假设你想显示特定的 Medium 中发布的故事以及属于特定作者的所有故事。那么一般情况下， 你用以下方法获取了两个 queryset。</p>\n<figure id="code5e8e3bcfcd762d1e483ee5a5736200ff" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">medium</span> <span class="o">=</span> <span class="n">Medium</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Django Blog&#39;</span><span class="p">)</span>\n<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;vitor&#39;</span><span class="p">)</span>\n\n<span class="n">django_stories</span> <span class="o">=</span> <span class="n">medium</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">vitor_stories</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">stories</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category__name</span><span class="o">=</span><span class="s1">&#39;django&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5e8e3bcfcd762d1e483ee5a5736200ff"><\\>Python</a></figcaption></figure>\n<p>此时我们有两个查询集(QuerySets) ,我们可以通过<code>|</code> 运算符来合并这两个查询集。</p>\n<figure id="code306c7f20b0aa06e96d66182d98a48c7b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">stories</span> <span class="o">=</span> <span class="n">django_stories</span> <span class="o">|</span> <span class="n">vitor_stories</span>  <span class="c1"># merge querysets</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code306c7f20b0aa06e96d66182d98a48c7b"><\\>Python</a></figcaption></figure>\n<p>此时你依然可以使用 queryset 的一些操作方法.</p>\n<figure id="code4f19f057b33b770f8953b6613d67e9a8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">recent_stories</span> <span class="o">=</span> <span class="n">stories</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-date&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4f19f057b33b770f8953b6613d67e9a8"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> <strong>注意:</strong> 合并运算符仅适用于同一类型的 queryset， 并且数据为切片前数据集.</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-06-get-or-create', 'title': 'Django小技巧06: get_or_create', 'date': datetime.datetime(2018, 10, 26, 11, 8, 23), 'cover': '/uploads/images/get-or-create.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/get-or-create.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/14/django-tip-6-get-or-create.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p><code>get_or_create</code> 是查找对象的一种便捷方法， 其最大的功能点是在目标对象不存在的时候， 可以根据参数创建对象。</p>\n\n<p>它实际上返回一个<code>(object, created)</code>元祖，第一个元素是您要检索 get 的模型的实例，第二个元素是个是否创建的布尔值，用户判断实例是否是创建的。</p>\n\n<p>如果实例已经存在数据库中， 并且通过参数可以找到， 那么 created 为 False， 反之则会创建， created 为 True。</p>\n\n<p>定义个名为<code>AppSettings</code>的模型， 你可以在此存储配置：</p>\n<figure id="codeef3a02e2caa60bbe119d67002c5429a4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">AppSettings</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;DEFAULT_LANG&#39;</span><span class="p">)</span>\n<span class="n">obj</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEFAULT_LANG&#39;</span><span class="p">)</span>\n<span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeef3a02e2caa60bbe119d67002c5429a4"><\\>Python</a></figcaption></figure>\n<p>如上面代码所示， 如果这是我第一次运行这段代码保存名为<code>DEFAULT_LANG</code>的配置，<code>get_or_create</code>将创建一个实例并在数据库中保留。 如果这是我第二次或者第三次调用此段代码， 它只会更新现有实例, 而原有的实例ID和name不会改变.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-07-get-crrent-url-in-template', 'title': 'Django小技巧07: 在模板中获取当前URL', 'date': datetime.datetime(2018, 10, 26, 11, 55, 23), 'cover': '/uploads/images/get-url-in-template.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/get-url-in-template.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/20/django-tip-7-how-to-get-the-current-url-within-a-django-template.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>确保项目配置里的<code>context_processors</code>包含<code>django.template.context_processors.request</code>.</p>\n\n<p>从 Django 1.9 开始， 默认是已经配置的。</p>\n<figure id="codebe7a2442b608652a955be3ea9cbb3db4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="p">{</span>\n        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[],</span>\n        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>\n        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>\n            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>\n                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>\n                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>\n            <span class="p">],</span>\n        <span class="p">},</span>\n    <span class="p">},</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebe7a2442b608652a955be3ea9cbb3db4"><\\>Python</a></figcaption></figure>\n<p>获取当前位置:</p>\n<figure id="code63fd9931fa4bcb8a1cf7bd21ff7c5e1e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.path</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code63fd9931fa4bcb8a1cf7bd21ff7c5e1e"><\\>Django</a></figcaption></figure>\n<p>获取带有querystring的URL:</p>\n<figure id="code7bd9705e26612bf26a14f9e047d0a252" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.get_full_path</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7bd9705e26612bf26a14f9e047d0a252"><\\>Django</a></figcaption></figure>\n<p>获取完全的绝对路径:</p>\n<figure id="coded40896e7dc33ea09e130a8c818398b4b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">request.build_absolute_uri</span> <span class="cp">}}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded40896e7dc33ea09e130a8c818398b4b"><\\>Django</a></figcaption></figure><h2 id="示例表">示例表</h2>\n<p>假设， 我们的URL是: <code>https://jackeygao.io/search/?keyword=django</code></p>\n<div class="code table-wrapper"><table><thead>\n<tr>\n<th>Method</th>\n<th style="text-align: left">Output</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td>request.path</td>\n<td style="text-align: left">/search/</td>\n</tr>\n<tr>\n<td><code>request.get_full_path</code></td>\n<td style="text-align: left">search/?keyword=django</td>\n</tr>\n<tr>\n<td><code>request.build_absolute_uri</code></td>\n<td style="text-align: left">https://jackeygao.io/search/?keyword=django</td>\n</tr>\n</tbody>\n</table></div><h2 id="Django 1.7 或者更早的版本">Django 1.7 或者更早的版本</h2><h3 id="settings.py">settings.py</h3><figcaption id="code048b4b5ed7b72481d1ae1c9d998d4a9c" class="code-wrapper">\n<div class="highlight"><pre>from django.conf.global_settings import TEMPLATE_CONTEXT_PROCESSORS as TCP\n\nTEMPLATE_CONTEXT_PROCESSORS = TCP + (\n    \'django.core.context_processors.request\',\n)</pre><figcaption><a href="#code048b4b5ed7b72481d1ae1c9d998d4a9c" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<blockquote class="blockquote-normal">\n                <p>阅读更多关于Automatic DateTime Fields的文档. <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#datefield">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-08-blank-or-null', 'title': 'Django小技巧08: Blank or Null', 'date': datetime.datetime(2018, 10, 26, 12, 12, 51), 'cover': '/uploads/images/blank-or-null.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/blank-or-null.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/07/25/django-tip-8-blank-or-null.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django Model API 中提供了<code>blank</code>和<code>null</code>两个参数， 非常容易混淆。当我第一次使用 Django 的时候， 总是不能恰当的使用这两个参数。</p>\n\n<p>看起来两者都做了几乎相同的事情， 但是这两者还是有区别的：</p>\n\n<ul>\n<li><strong>null</strong>: 数据库相关； 定义数据库字段的值是否接受空值。</li>\n<li><strong>blank</strong>: 验证相关， 当调用<code>form.is_valid()</code>时， 将会判断值是否为空.</li>\n</ul>\n\n<p>虽然两者的是有区别的， 但一个拥有<code>null=True</code>和<code>blank=False</code>的字段是完全没有问题的。 在数据库级别上， 该字段可以为 NULL， 但在应用程序级别上， 它是必填字段(前提你通过 Django 标准的 Form 进行判断)。</p>\n\n<p>大多数开发人员都对基于字符串的字段(<code>CharField</code>和<code>TextField</code>)定义<code>null=True</code>, 这其实是没有必要的, 应该避免这样做，因为 Django约定使用空字符串设置空值， 而非<strong>Null</strong>.</p>\n\n<p>所以， 如果你想设置一个基于字符的字段可以为空，那么你应该这样做:</p>\n<figure id="code61eab99acda25e6f31dc2df010946917" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>  <span class="c1"># 强制填写</span>\n    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 可选填写 (不要设置null=True)</span>\n    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 可选填写 (这里你应该设置null=True)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code61eab99acda25e6f31dc2df010946917"><\\>Python</a></figcaption></figure><h2 id="默认值">默认值</h2>\n<ul>\n<li><strong>null</strong>: False</li>\n<li><strong>blank</strong>: False</li>\n</ul>\n<h2 id="NullBooleanField">NullBooleanField</h2>\n<p>当您需要为<code>BooleanField</code>字段设置允许为空时， 您应该使用<code>NullBooleanField</code>代替，<strong>而非通过参数</strong>.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-09-password-change-form', 'title': 'Django小技巧09: 创建修改密码视图', 'date': datetime.datetime(2018, 10, 26, 12, 50, 51), 'cover': '/uploads/images/password-change-form.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/password-change-form.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/04/django-tip-9-password-change-form.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇讲述如何使用内置的<code>PasswordChangeForm</code>快速创建更改密码视图.</p>\n\n<p>就此而言， 使用函数式视图更容易实现。 因为<code>PasswordChangeForm</code>不从<code>ModelForm</code>继承。并且其构造函数使用<code>user</code>参数.</p>\n\n<p>以下实例，用于更改经过认证过后的用户密码的功能代码:</p>\n\n<ul>\n<li><strong>views.py</strong></li>\n</ul>\n<figure id="code25bc48d4a538ae8f94b1c2440b315c94" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">update_session_auth_hash</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">PasswordChangeForm</span>\n<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>\n\n<span class="k">def</span> <span class="nf">change_password</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>\n        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>\n            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>  <span class="c1"># Important!</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was successfully updated!&#39;</span><span class="p">)</span>\n            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;change_password&#39;</span><span class="p">)</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>\n    <span class="k">else</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;accounts/change_password.html&#39;</span><span class="p">,</span> <span class="p">{</span>\n        <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span>\n    <span class="p">})</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code25bc48d4a538ae8f94b1c2440b315c94"><\\>Python</a></figcaption></figure>\n<p><code>message.success()</code>和<code>message.error</code>是可选的， 但最好让用户知道应用程序中他们应该知道的状态。</p>\n\n<p>需要注意一点是, 保存表单后要调用<code>update_session_auth_hash()</code>， 否则身份验证会话将会失效，用户必须重新登录.</p>\n\n<ul>\n<li><strong>urls.py</strong></li>\n</ul>\n<figure id="code714484618712b760aa4c9e262133cd83" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">myproject.accounts</span> <span class="kn">import</span> <span class="n">views</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^password/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">change_password</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;change_password&#39;</span><span class="p">),</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code714484618712b760aa4c9e262133cd83"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>change_password.html</strong></li>\n</ul>\n<figure id="codee1c0986524153db939a2b5677975ad72" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;form method=&quot;post&quot;&gt;</span>\n<span class="x">  </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  </span><span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">  &lt;button type=&quot;submit&quot;&gt;Save changes&lt;/button&gt;</span>\n<span class="x">&lt;/form&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee1c0986524153db939a2b5677975ad72"><\\>Django</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-10-custom-login-policy', 'title': 'Django小技巧10: 自定义认证策略', 'date': datetime.datetime(2018, 10, 26, 13, 30, 12), 'cover': '/uploads/images/authentication-form-custom-login-policy.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/authentication-form-custom-login-policy.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/12/django-tip-10-authentication-form-custom-login-policy.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 内置了一套功能极全的认证系统，而且可以很容易的进行自定义， 本章的内容就是自定义认证策略。</p>\n\n<p>对于内置的login视图，Django 使用<code>django.contrib.auth.forms.AuthenticationForm</code>来处理身份验证过程。 这个认证检查了基本的<code>username</code>, <code>password</code>和<code>is_active</code>标识.</p>\n\n<p>Django 可以通过<code>AuthenticationForm</code>的<code>confirm_login_allowed(user)</code>方法， 轻松添加自定义认证.</p>\n\n<p>假设你想通过双重的电子邮件认证， 只有用户点击确认邮件后才可以登录，那么你可以这样做:</p>\n\n<ul>\n<li><strong>forms.py</strong></li>\n</ul>\n<figure id="codea8a5b1d2736a095025c8c8e446f8e53b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">AuthenticationForm</span>\n\n<span class="k">class</span> <span class="nc">CustomAuthenticationForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>\n        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_validated</span><span class="p">:</span>\n            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;There was a problem with your login.&#39;</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;invalid_login&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea8a5b1d2736a095025c8c8e446f8e53b"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>urls.py</strong></li>\n</ul>\n<figure id="codedac339a4c5be35a3f1d59fd6073e0a39" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>\n\n<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomAuthenticationForm</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^login/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;core/login.html&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;authentication_form&#39;</span><span class="p">:</span> <span class="n">CustomAuthenticationForm</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^logout/$&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>\n    <span class="o">...</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedac339a4c5be35a3f1d59fd6073e0a39"><\\>Python</a></figcaption></figure>\n<p>很简单， 只需覆盖<code>confirm_login_allowed</code>方法,并在 urlconf 替换新的表单<code>CustomAuthenticationForm</code>即可。你可以在<code>confirm_login_allowed</code>添加任何的代码策略， 需要注意的是， 如果认证失败仅能抛出<code>ValidationError</code>才可以正常工作.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-11-custom-manager', 'title': 'Django小技巧11: 自定义链式Queryset Manager', 'date': datetime.datetime(2018, 10, 26, 17, 12, 42), 'cover': '/uploads/images/custom-manager.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/custom-manager.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/16/django-tip-11-custom-manager-with-chainable-querysets.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>在 Django Model 中，Manager是与数据库交互的接口。默认情况下Manager可通过<code>Model.objects</code>属性使用。默认情况下， 每个 Model 的默认 Manager 是<code>django.db.models.Manager</code>。扩展和重写默认Manager非常简单.</p>\n<figure id="code202c034a0897d72f5116a053fcf980de" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">DocumentManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentManager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code202c034a0897d72f5116a053fcf980de"><\\>Python</a></figcaption></figure>\n<p>设置后， 你可以通过<code>pdfs</code>方法快速的过滤属于 PDF 的文档.</p>\n<figure id="code08b1fcf03fd8a884d7f4f90e935199a7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code08b1fcf03fd8a884d7f4f90e935199a7"><\\>Python</a></figcaption></figure>\n<p>当然，返回的结果是链式的， 依然拥有 queryset 的一些操作方法(<code>order_by</code> 或 <code>filter</code>等..).</p>\n<figure id="codeed6ae93b64deb35305d7733fce26ae6e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeed6ae93b64deb35305d7733fce26ae6e"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> 但是， 如果你试图在使用自定义的一些方法， 链式将会中止:</p></blockquote><figure id="code8cd3185b05949ffa7f55ef6c34e9247b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>\n\n<span class="ne">AttributeError</span><span class="p">:</span> <span class="s1">&#39;QuerySet&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s1">&#39;smaller_than&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8cd3185b05949ffa7f55ef6c34e9247b"><\\>Python</a></figcaption></figure>\n<p>要使上述代码能够工作， 你必须创建自定义的<code>get_queryset</code>方法.</p>\n<figure id="code3335dce14d0ea7248dd183689d9bf6ca" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentQuerySet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">DocumentManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="n">DocumentQuerySet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_db</span><span class="p">)</span>  <span class="c1"># Important!</span>\n\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentManager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3335dce14d0ea7248dd183689d9bf6ca"><\\>Python</a></figcaption></figure>\n<p>现在可以像任何的 QuerySet 方法一样使用他。 并且是链式的！</p>\n<figure id="coded051032ba84e912a3403d438209fa49a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">pdfs</span><span class="p">()</span><span class="o">.</span><span class="n">smaller_than</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Article&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded051032ba84e912a3403d438209fa49a"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>Manager 除了自定义 QuerySet 还可以做其他的工作， 如果你只在 Manager 中自定义 QuerySet ，推荐扩展下<code>models.QuerySet</code>, 并在模型中定义<code>objects = DocumentQuerySet.as_manager()</code>.</p></blockquote><figure id="code786ba53993d96d3d20382e53704da7c6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentQuerySet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">QuerySet</span><span class="p">):</span>\n    <span class="k">def</span> <span class="nf">pdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">smaller_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">size__lt</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Document</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>\n    <span class="n">file_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">DocumentQuerySet</span><span class="o">.</span><span class="n">as_manager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code786ba53993d96d3d20382e53704da7c6"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>自定义的 Manager 代码， 你可以写在<strong>models.py</strong>， 但随着代码库的增长， 我更加推荐你将定义的<code>QuerySets</code> 和<code>Managers</code>保存名为<strong>managers.py</strong>文件中.</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-12-disabling-migrations', 'title': 'Django小技巧12: 禁用单元测试的Migrations', 'date': datetime.datetime(2018, 10, 29, 18, 12, 42), 'cover': '/uploads/images/disabling-migrations.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/disabling-migrations.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/19/django-tip-12-disabling-migrations-to-speed-up-unit-tests.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Migrations 无疑是 Django 的一大特色功能，当它在单元测试的时候， 却会加长整个单元测试的时间。特别是你的migrations history特别的大.本篇是加快单元测试的小技巧:</p>\n\n<p>为单元测试单独创建一个 settings</p>\n\n<p><strong>tests_settings.py</strong></p>\n<figure id="code0adc599f6d3dc2489d48cc1e39d555a9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="c1"># Custom settings goes here</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code0adc599f6d3dc2489d48cc1e39d555a9"><\\>Python</a></figcaption></figure>\n<p>然后在执行测试的时候，这样做:</p>\n<figure id="code58f1241bfd92b1e441f19395adff20fc" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py <span class="nb">test</span> --settings<span class="o">=</span>myproject.tests_settings --verbosity<span class="o">=</span><span class="m">1</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code58f1241bfd92b1e441f19395adff20fc"><\\>Shell</a></figcaption></figure><h2 id="Django &gt;= 1.9">Django &gt;= 1.9</h2>\n<p>使用<code>MIGRATION_MODULES</code>设置项, 用于定义migration模块的自定义名称， 如果为<code>None</code>则是忽略此模块.</p>\n<figure id="code7e73192c58b22cd2717a4f94e008d70b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">MIGRATION_MODULES</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;contenttypes&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;sessions&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n\n    <span class="s1">&#39;core&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;profiles&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;snippets&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n    <span class="s1">&#39;scaffold_templates&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7e73192c58b22cd2717a4f94e008d70b"><\\>Python</a></figcaption></figure><h2 id="Django &lt; 1.9">Django &lt; 1.9</h2>\n<p>如果是1.9之前的版本，可以用下面的方法。实际上， 我现在依然在使用它， 因为这种方法不需要指定各个模块.</p>\n<figure id="code1ff0b4c2b437f759ad69d25ea6ce05ff" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">settings</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="k">class</span> <span class="nc">DisableMigrations</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>\n    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">True</span>\n\n    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>\n        <span class="k">return</span> <span class="s1">&#39;notmigrations&#39;</span>\n\n<span class="n">MIGRATION_MODULES</span> <span class="o">=</span> <span class="n">DisableMigrations</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1ff0b4c2b437f759ad69d25ea6ce05ff"><\\>Python</a></figcaption></figure><h2 id="更旧的版本 (使用: South)">更旧的版本 (使用: South)</h2><figcaption id="code9180f3e4e28e5d645ec42c5247308748" class="code-wrapper">\n<div class="highlight"><pre>SOUTH_TESTS_MIGRATE = False</pre><figcaption><a href="#code9180f3e4e28e5d645ec42c5247308748" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n\n<p>这个可以写在生产的<strong>settings.py</strong>中.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-13-f-expression', 'title': 'Django小技巧13: 使用F()表达式', 'date': datetime.datetime(2018, 10, 29, 18, 49, 8), 'cover': '/uploads/images/f-expression.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/f-expression.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/08/23/django-tip-13-f-expressions.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>在 Django QuerySets API 中， F() 用于直接在数据库中引用模型的值。假设你有一个带有<code>price</code>的 Product 模型， 你希望为所有的Product的价格上涨20%.</p>\n\n<p>一个可以实现在解决方案:</p>\n<figure id="code5573cc06b169b74e7936dd558a910e08" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">*=</span> <span class="mf">1.2</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5573cc06b169b74e7936dd558a910e08"><\\>Python</a></figcaption></figure>\n<p>相反， 你可以在单个查询中更新price.</p>\n<figure id="code63597999fb1d67c0067a87c6e0d7f0bd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code63597999fb1d67c0067a87c6e0d7f0bd"><\\>Python</a></figcaption></figure>\n<p>你也可以对单个对象执行这个操作:</p>\n<figure id="code64a105d1ba092a246e77e322f60fef46" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">5009</span><span class="p">)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code64a105d1ba092a246e77e322f60fef46"><\\>Python</a></figcaption></figure><blockquote class="blockquote-warning">\n                <p> 要注意， 保存模型后， <code>F()</code>对象依然存在.</p></blockquote><figure id="code4460c4a073983395a449d616720b9e2b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">price</span>                   <span class="c1"># price = Decimal(&#39;10.00&#39;)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>                  <span class="c1"># price = Decimal(&#39;11.00&#39;)</span>\n<span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;What the F()&#39;</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>                  <span class="c1"># price = Decimal(&#39;12.00&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4460c4a073983395a449d616720b9e2b"><\\>Python</a></figcaption></figure>\n<p>所以， 在更新这样的字段后, <code>product.price</code>实际上保存的是<code>django.db.models.expressions.CombinedExpression</code>实例， 而不是实际结果。</p>\n\n<p>如果要立即访问结果:</p>\n<figure id="code9f5fab2bf78d86742c841802773a996a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>\n<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n<span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>            <span class="c1"># &lt;CombinedExpression: F(price) + Value(1)&gt;</span>\n<span class="n">product</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>\n<span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>            <span class="c1"># Decimal(&#39;13.00&#39;)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9f5fab2bf78d86742c841802773a996a"><\\>Python</a></figcaption></figure>\n<p>你可以使用<code>F()</code>实现annotate功能:</p>\n<figure id="code3a604492533106f4fcc167e991de753b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">ExpressionWrapper</span><span class="p">,</span> <span class="n">DecimalField</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>\n    <span class="n">value_in_stock</span><span class="o">=</span><span class="n">ExpressionWrapper</span><span class="p">(</span>\n        <span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;stock&#39;</span><span class="p">),</span> <span class="n">output_field</span><span class="o">=</span><span class="n">DecimalField</span><span class="p">()</span>\n    <span class="p">)</span>\n<span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3a604492533106f4fcc167e991de753b"><\\>Python</a></figcaption></figure>\n<p>由于price是DecimalField, 而stock是IntegerField，我们需要将表达式包装在<code>ExpressionWrapper</code>中.</p>\n\n<p>也可以用来过滤数据:</p>\n<figure id="code6df60b5277b1d118cf94afc6d03b7ccc" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">stock__gte</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;ordered&#39;</span><span class="p">))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code6df60b5277b1d118cf94afc6d03b7ccc"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-14-messages-framework', 'title': 'Django小技巧14: messages 框架', 'date': datetime.datetime(2018, 10, 30, 14, 4, 39), 'cover': '/uploads/images/messages-framework.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/messages-framework.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/09/06/django-tip-14-messages-framework.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>让用户知道应用程序发生了什么， 是个极好的用户体验。让应用程序和用户之间能够有个很好的『交流』是个不错的选择。</p>\n\n<p>设想一下下面场景:</p>\n\n<ul>\n<li>用户: 点击保存按钮</li>\n<li>应用程序： 什么都没有发生</li>\n<li>所以是否保存了数据？ 用户并不知道</li>\n<li>这时一些急性子就疯狂的点击，点击，点击...</li>\n</ul>\n\n<p>所以， 要让用户不要慌...</p>\n<h2 id="配置">配置</h2>\n<p>默认情况下，Django 项目内置了messages框架, 如果你没有更改这些配置， 只需要跳到下一节。 如果有改动， 按照下面这样设置：</p>\n\n<ul>\n<li><strong>INSTALLED_APPS</strong>\n\n<ul>\n<li>django.contrib.messages</li>\n</ul></li>\n<li><strong>MIDDLEWARE</strong> 或者 <strong>MIDDLEWARE_CLASSES</strong>(老版本)\n\n<ul>\n<li>django.contrib.sessions.middleware.SessionMiddleware</li>\n<li>django.contrib.messages.middleware.MessageMiddleware</li>\n</ul></li>\n<li><strong>TEMPLATES</strong>\n\n<ul>\n<li><strong>context_processors</strong>\n\n<ul>\n<li>django.contrib.messages.context_processors.messages</li>\n</ul></li>\n</ul></li>\n</ul>\n<h2 id="消息级别和标签">消息级别和标签</h2><div class="code table-wrapper"><table><thead>\n<tr>\n<th>Constant</th>\n<th>Level</th>\n<th>Tag</th>\n<th>Purpose</th>\n</tr>\n</thead>\n\n<tbody>\n<tr>\n<td>DEBUG</td>\n<td>10</td>\n<td>debug</td>\n<td>开发相关的消息</td>\n</tr>\n<tr>\n<td>INFO</td>\n<td>20</td>\n<td>info</td>\n<td>用户级别消息</td>\n</tr>\n<tr>\n<td>SUCCESS</td>\n<td>25</td>\n<td>success</td>\n<td>一个操作的成功消息</td>\n</tr>\n<tr>\n<td>WARNING</td>\n<td>30</td>\n<td>warning</td>\n<td>失败但非迫在眉睫的消息</td>\n</tr>\n<tr>\n<td>ERROR</td>\n<td>40</td>\n<td>errror</td>\n<td>操作未成功或发生错误</td>\n</tr>\n</tbody>\n</table></div>\n<p>默认情况下， Django 只会显示 <code>level &gt;= 20</code> (INFO)的消息， 如果显示<code>DEBUG</code>消息， 可以在设置中:</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code82ceca17dc39c220d82bb389700c2bb1" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.messages</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">message_constants</span>\n<span class="n">MESSAGE_LEVEL</span> <span class="o">=</span> <span class="n">message_constants</span><span class="o">.</span><span class="n">DEBUG</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code82ceca17dc39c220d82bb389700c2bb1"><\\>Python</a></figcaption></figure>\n<p>为了避免遇到导入循环， 可以直接设置 level.</p>\n<figure id="code9bbecf29cf7d2aaff7016ea69651badf" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MESSAGE_LEVEL</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># DEBUG</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9bbecf29cf7d2aaff7016ea69651badf"><\\>Python</a></figcaption></figure><h2 id="使用">使用</h2>\n<p>在视图里面必要的地方添加， 触发消息的逻辑， 在模板里面添加显示的代码， 就可以使用消息啦</p>\n\n<p><strong>views.py</strong></p>\n<figure id="codea9ab66f1843969f0e44dd8b5636bb138" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">messages</span>\n\n<span class="nd">@login_required</span>\n<span class="k">def</span> <span class="nf">password</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>\n        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>\n            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">)</span>  <span class="c1"># &lt;-</span>\n            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;settings:password&#39;</span><span class="p">)</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">messages</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>  <span class="c1"># &lt;-</span>\n    <span class="k">else</span><span class="p">:</span>\n        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>\n    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;profiles/change_password.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea9ab66f1843969f0e44dd8b5636bb138"><\\>Python</a></figcaption></figure>\n<p><strong>然后template中</strong></p>\n<figure id="code6879b6d3cdf45d8ea207b24aa192efb2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;ul class=&quot;messages&quot;&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;li class=&quot;</span><span class="cp">{{</span> <span class="nv">message.tags</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/ul&gt;</span>\n<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code6879b6d3cdf45d8ea207b24aa192efb2"><\\>Django</a></figcaption></figure>\n<p>如果添加成功了， 则输出的 html 应该是这样呢, 可以看到实际上标签应该和你的用户美化messsage的 css 对应。</p>\n<figure id="codec0ecdbc7d8523e44087bd44f935df5a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;</span>\n  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;success&quot;</span><span class="p">&gt;</span>Your password was updated successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>\n<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec0ecdbc7d8523e44087bd44f935df5a2"><\\>Html</a></figcaption></figure>\n<p>你可以对 message， 添加额外的标签:</p>\n<figure id="code5da3be0572355d1c235232e0fde365fd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">,</span> <span class="n">extra_tags</span><span class="o">=</span><span class="s1">&#39;alert&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code5da3be0572355d1c235232e0fde365fd"><\\>Python</a></figcaption></figure>\n<p>输出html 为:</p>\n<figure id="code4177b0f9fa7fd7d56a23fa5c3bee5eed" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;</span>\n  <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;success alert&quot;</span><span class="p">&gt;</span>Your password was updated successfully!<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>\n<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4177b0f9fa7fd7d56a23fa5c3bee5eed"><\\>Html</a></figcaption></figure>\n<p>内置方法介绍:</p>\n<figure id="code3b33a07db96511a7224ed7fc3d57d908" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">messages</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Total records updated {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Improve your profile today!&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Your password was updated successfully!&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Please correct the error below.&#39;</span><span class="p">)</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;An unexpected error occured.&#39;</span><span class="p">)</span>\n\n<span class="c1"># Or...</span>\n\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="s1">&#39;Total records updated {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;Improve your profile today!&#39;</span><span class="p">)</span>\n\n<span class="c1"># Useful to define custom levels:</span>\n<span class="n">CRITICAL</span> <span class="o">=</span> <span class="mi">50</span>\n<span class="n">messages</span><span class="o">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">CRITICAL</span><span class="p">,</span> <span class="s1">&#39;A very serious error ocurred.&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3b33a07db96511a7224ed7fc3d57d908"><\\>Python</a></figcaption></figure><h2 id="和Bootstrap结合代码片段">和Bootstrap结合代码片段</h2>\n<ul>\n<li><strong>messages.html</strong></li>\n</ul>\n<figure id="codeffcca6416fa8771b633ae3b759ebd177" class="code-wrapper"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;div class=&quot;alert </span><span class="cp">{{</span> <span class="nv">message.tags</span> <span class="cp">}}</span><span class="x"> alert-dismissible&quot; role=&quot;alert&quot;&gt;</span>\n<span class="x">    &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;</span>\n<span class="x">      &lt;span aria-hidden=&quot;true&quot;&gt;&amp;times;&lt;/span&gt;</span>\n<span class="x">    &lt;/button&gt;</span>\n<span class="x">    </span><span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span><span class="x"></span>\n<span class="x">  &lt;/div&gt;</span>\n<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeffcca6416fa8771b633ae3b759ebd177"><\\>Django</a></figcaption></figure>\n<ul>\n<li><strong>settings.py</strong></li>\n</ul>\n\n<p>Bootstrap 中定义了如<code>alert-info</code>或者<code>alert-success</code>等<code>alert-*</code>的组件css. 所以我们需要更改下默认的 tags.</p>\n<figure id="code1b4a4d26120fc3fd46faab698b068993" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.messages</span> <span class="kn">import</span> <span class="n">constants</span> <span class="k">as</span> <span class="n">messages</span>\n\n<span class="n">MESSAGE_TAGS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span> <span class="s1">&#39;alert-info&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span> <span class="s1">&#39;alert-info&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span> <span class="s1">&#39;alert-success&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">WARNING</span><span class="p">:</span> <span class="s1">&#39;alert-warning&#39;</span><span class="p">,</span>\n    <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="s1">&#39;alert-danger&#39;</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b4a4d26120fc3fd46faab698b068993"><\\>Python</a></figcaption></figure>\n<ul>\n<li><strong>base.html</strong></li>\n</ul>\n\n<p>然后把<code>messages.html</code>添加到需要显示的地方:</p>\n<figure id="code4f6f0812a255b5114a13b211b5032801" class="code-wrapper"><div class="highlight"><pre><span></span><span class="x">&lt;!doctype html&gt;</span>\n<span class="x">&lt;html&gt;</span>\n<span class="x">  &lt;head&gt;</span>\n<span class="x">    &lt;meta charset=&quot;utf-8&quot;&gt;</span>\n<span class="x">    &lt;title&gt;Simple is Better Than Complex&lt;/title&gt;</span>\n<span class="x">  &lt;/head&gt;</span>\n<span class="x">  &lt;body&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/header.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">    &lt;main&gt;</span>\n<span class="x">      &lt;div class=&quot;container&quot;&gt;</span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/messages.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">        </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">      &lt;/div&gt;</span>\n<span class="x">    &lt;/main&gt;</span>\n<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/footer.html&#39;</span> <span class="cp">%}</span><span class="x"></span>\n<span class="x">  &lt;/body&gt;</span>\n<span class="x">&lt;/html&gt;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4f6f0812a255b5114a13b211b5032801"><\\>Django</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于messages框架的文档. <a href="https://docs.djangoproject.com/en/dev/ref/contrib/messages/">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-15-cbv-mixins', 'title': 'Django小技巧15: 使用基于类视图的Mixins', 'date': datetime.datetime(2018, 11, 5, 11, 4, 39), 'cover': '/uploads/images/cbv-mixins.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/cbv-mixins.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/09/27/django-tip-15-cbv-mixins.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>今天讲述三点关于 Mixins 使用的一些规范:</p>\n\n<ul>\n<li>Django 提供的View 保持在继承的最右边.</li>\n<li>Mixins 在基本视图的左侧</li>\n<li>Mixins 应该继承Python的内置对象类型(object).</li>\n</ul>\n\n<p>下面举例说明规则</p>\n<figure id="coded13bc63bee5404dd7145986172c37355" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FormMessageMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>\n    <span class="nd">@property</span>\n    <span class="k">def</span> <span class="nf">form_valid_message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">NotImplemented</span>\n\n    <span class="n">form_invalid_message</span> <span class="o">=</span> <span class="s1">&#39;Please correct the errors below.&#39;</span>\n\n    <span class="k">def</span> <span class="nf">form_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>\n        <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_valid_message</span><span class="p">)</span>\n        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_valid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>\n\n    <span class="k">def</span> <span class="nf">form_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">):</span>\n        <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form_invalid_message</span><span class="p">)</span>\n        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">form_invalid</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>\n\n\n<span class="k">class</span> <span class="nc">DocumentCreateView</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully created!&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded13bc63bee5404dd7145986172c37355"><\\>Python</a></figcaption></figure>\n<p>依类似的方式， 你可以在UpdateView中， 重用相同的FormMessageMixin, 并覆盖默认的<code>form_invalid_message</code>方法.</p>\n<figure id="codedd571e5e9b125ea1b348c8b3d5fc45d2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentUpdateView</span><span class="p">(</span><span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully updated!&#39;</span>\n    <span class="n">form_invalid_message</span> <span class="o">=</span> <span class="s1">&#39;There are some errors in the form below.&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedd571e5e9b125ea1b348c8b3d5fc45d2"><\\>Python</a></figcaption></figure>\n<p>Django 1.9开始， 内置的LoginRequiredMixin和UserPassesTestMixin. 如果你要在视图中使用它们， 它们始终位于最左侧:</p>\n<figure id="code252b6de19c55d651cbb41244e54fbe31" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DocumentUpdateView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">FormMessageMixin</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">):</span>\n    <span class="n">model</span> <span class="o">=</span> <span class="n">Document</span>\n    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">)</span>\n    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;documents&#39;</span><span class="p">)</span>\n    <span class="n">form_valid_message</span> <span class="o">=</span> <span class="s1">&#39;The document was successfully updated!&#39;</span>\n</pre></div>\n<span class="title-label">#Mixins在左,View在后</span><figcaption><a class="lang-label" href="#code252b6de19c55d651cbb41244e54fbe31"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-16-db-access-optimizations', 'title': 'Django小技巧16: 数据库访问优化', 'date': datetime.datetime(2018, 11, 5, 13, 4, 39), 'cover': '/uploads/images/db-access-optimizations.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/db-access-optimizations.jpeg"></div><figcaption class="img-title">#错综复杂</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/05/django-tip-16-simple-database-access-optimizations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇分享数据库访问优化相关， 读完这些并不是让你立即去优化代码， 更多的时候对于现有代码的优化， 需要借助<a href="https://github.com/jazzband/django-debug-toolbar">Django Debug Toolbar</a>来分析后， 再去相应的优化代码， 但今天要说的是一些简单的技巧， 用于你在编写代码的时候就所有规避不好用法， 使用推荐的用法.</p>\n<h2 id="访问外键值">访问外键值</h2>\n<p>如果你只需外键的ID</p>\n<figure id="code8e6cd4975654e8f20f7f308f67cfd2ef" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">.</span><span class="n">author_id</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code8e6cd4975654e8f20f7f308f67cfd2ef"><\\>Python</a></figcaption></figure><figure id="code7d4ed7b7f4f8ea443f5f7794fa55474a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">post</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">id</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code7d4ed7b7f4f8ea443f5f7794fa55474a"><\\>Python</a></figcaption></figure>\n<p>如果你的博文中有一个 author 的外键，Django 会自动将主键存储在属性author_id中, 而在author属性则是一个惰性的数据库引用。如果你如果使用author来访问 ID, 数据则会多出一个额外的查询，就会产生开销。</p>\n<h2 id="批量插入Many to Many字段">批量插入Many to Many字段</h2><figure id="codee8f4076885b2f9818ae1640bcbca912e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">administrators</span><span class="p">,</span> <span class="n">managers</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codee8f4076885b2f9818ae1640bcbca912e"><\\>Python</a></figcaption></figure><figure id="codeb24b1236a15abb2adf7fc7ce82951448" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">administrators</span><span class="p">)</span>\n<span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">managers</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codeb24b1236a15abb2adf7fc7ce82951448"><\\>Python</a></figcaption></figure><h2 id="Count QuerySets">Count QuerySets</h2>\n<p>如果你只需获取 QuerySet count</p>\n<figure id="codee3482258de8d3e56ba0305332cf8a413" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="n">users</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>\n\n<span class="c1"># Or in template...</span>\n<span class="p">{{</span> <span class="n">users</span><span class="o">.</span><span class="n">count</span> <span class="p">}}</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codee3482258de8d3e56ba0305332cf8a413"><\\>Python</a></figcaption></figure><figure id="codeefd30a7f0c073b4f8355dd23429b58c8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>\n\n<span class="c1"># Or in template...</span>\n<span class="p">{{</span> <span class="n">users</span><span class="o">|</span><span class="n">length</span> <span class="p">}}</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codeefd30a7f0c073b4f8355dd23429b58c8"><\\>Python</a></figcaption></figure><h2 id="Empty QuerySets">Empty QuerySets</h2>\n<p>如果你只想知道 QuerySets 是否为空.</p>\n<figure id="codef36ee94920ac1bcf8c9717669497b04b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">if</span> <span class="n">groups</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>\n    <span class="c1"># Do something...</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codef36ee94920ac1bcf8c9717669497b04b"><\\>Python</a></figcaption></figure><figure id="code025c6ee7931a2a3a1bd5e2d72d992b25" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">if</span> <span class="n">groups</span><span class="p">:</span>\n    <span class="c1"># Do something...</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code025c6ee7931a2a3a1bd5e2d72d992b25"><\\>Python</a></figcaption></figure><h2 id="减少不必要的查询次数">减少不必要的查询次数</h2>\n<p>就是之前讲过的 select_related </p>\n<figure id="codef7d274d07ac62b82b7410f7f283b67ac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># Select the Review and the Author in a single query</span>\n<span class="n">name</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#codef7d274d07ac62b82b7410f7f283b67ac"><\\>Python</a></figcaption></figure><figure id="codee723ef0c5ad7062a507a5ce4b7f59e60" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">review</span> <span class="o">=</span> <span class="n">Review</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>  <span class="c1"># Select the Review</span>\n<span class="n">name</span> <span class="o">=</span> <span class="n">review</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">first_name</span>  <span class="c1"># Additional query to select the Author</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codee723ef0c5ad7062a507a5ce4b7f59e60"><\\>Python</a></figcaption></figure><h2 id="只检索需要的字段">只检索需要的字段</h2>\n<p>假设模型<strong>Invoice</strong>有50个字段，你想要创建一个表格只显示摘要信息，包含<strong>number</strong>、<strong>date</strong>和<strong>value</strong>.</p>\n<figure id="code8bbc1e1881b3f4b71ce79ab07d7bc3c7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>\n<span class="c1"># If you don&#39;t need the model instance, go for:</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>  <span class="c1"># Returns a dict</span>\n\n<span class="c1"># If you still need to access some instance methods, go for:</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>  <span class="c1"># Returns a queryset</span>\n\n<span class="c1"># invoices.html</span>\n<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">invoices</span> <span class="o">%</span><span class="p">}</span>\n    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">date</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">value</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>\n<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code8bbc1e1881b3f4b71ce79ab07d7bc3c7"><\\>Python</a></figcaption></figure><figure id="codece7f2473c0e21c14d240e8145b5c4c0f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>\n<span class="n">invoices</span> <span class="o">=</span> <span class="n">Invoice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n\n<span class="c1"># invoices.html</span>\n<span class="o">&lt;</span><span class="n">table</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">invoice</span> <span class="ow">in</span> <span class="n">invoices</span> <span class="o">%</span><span class="p">}</span>\n    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">number</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">date</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">invoice</span><span class="o">.</span><span class="n">value</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>\n    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n  <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>\n<span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#codece7f2473c0e21c14d240e8145b5c4c0f"><\\>Python</a></figcaption></figure><h2 id="批量更新">批量更新</h2>\n<p>使用 <code>F()</code> 批量更新.</p>\n<figure id="code63597999fb1d67c0067a87c6e0d7f0bd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>\n\n<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#Do</span><figcaption><a class="lang-label" href="#code63597999fb1d67c0067a87c6e0d7f0bd"><\\>Python</a></figcaption></figure><figure id="code5573cc06b169b74e7936dd558a910e08" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">products</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">price</span> <span class="o">*=</span> <span class="mf">1.2</span>\n    <span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>\n</pre></div>\n<span class="title-label">#Don\'t</span><figcaption><a class="lang-label" href="#code5573cc06b169b74e7936dd558a910e08"><\\>Python</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-17-latest-and-earliest', 'title': 'Django小技巧17: QuerySets的latest和earliest方法', 'date': datetime.datetime(2018, 11, 5, 14, 58, 39), 'cover': '/uploads/images/earliest-latest.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/earliest-latest.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/06/django-tip-17-earliest-and-latest.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>就像QuerySets的first和last方法一样, Django 还提供了<code>earliest</code>和<code>latest</code>方法. 用于获取最早和最新的数据，增强代码的可读性.</p>\n\n<p>最好在模型的Meta类中先定义<code>get_latest_by</code>属性</p>\n<figure id="codec749248a1d9ed6c7810d5f84c5c38594" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>\n    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>\n    <span class="n">publication_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n    <span class="n">change_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>\n\n    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>\n        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="s1">&#39;publication_date&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec749248a1d9ed6c7810d5f84c5c38594"><\\>Python</a></figcaption></figure>\n<p>然后使用起来非常简单</p>\n<figure id="code9bf117d97b29dd98dfe25db70e7a2070" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">latest_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">()</span>\n<span class="n">earliest_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">earliest</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9bf117d97b29dd98dfe25db70e7a2070"><\\>Python</a></figcaption></figure>\n<p>如果没有指定<code>get_latest_by</code>字段， 也可以通过参数来指定</p>\n<figure id="code50721c77d960dc91006c00600c7c3e35" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">latest_change</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s1">&#39;change_date&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code50721c77d960dc91006c00600c7c3e35"><\\>Python</a></figcaption></figure>\n<p>如果以上两种方式都没有提供<code>get_latest_by</code>参数, 将会触发<code>DoesNotExist</code>错误. 它于 first 和 last 不同， 因为first和 last 在没有匹配到结果的情况下将会返回 None.</p>\n\n<p>另外一个需要注意的点是， 和日期作为排序参数的时候， 可能会遇到日期为空的情况， 这时候工作的结果和我们想象的不一致。 所以我们可以过滤下日期为 Null 的结果，再做<code>earliest</code>和<code>latest</code>检索.</p>\n<figure id="coded5e1b3cecd4932507bf8b9fcffc0b6e6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">change_date__isnull</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s1">&#39;change_date&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded5e1b3cecd4932507bf8b9fcffc0b6e6"><\\>Python</a></figcaption></figure>\n<p>这两种方法， 通常与<code>DateField</code>、<code>DateTimeField</code>或<code>IntegerField</code>一起使用。应该避免和其他字段一起使用， 因为语义上是错误的。这两种方法主要是提供代码的方便性和可读性， 如果和非时间字段一起使用，会带来新的混淆.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-18-translations', 'title': 'Django小技巧18: ugettext和ugettext_lazy的区别', 'date': datetime.datetime(2018, 11, 5, 15, 20, 39), 'cover': '/uploads/images/translations.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/translations.jpg"></div><figcaption class="img-title">#redirect</figcaption></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/17/django-tip-18-translations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django API 提供了几个有用的模块来帮助你翻译你的应用程序. 它们都在<code>django.utils.translation</code>中使用，大多数情况下， 我们会使用到ugettext()和ugettext_lazy().</p>\n\n<p>「u」前缀代表「unicode」, 因为大多数情况下，我们经常使用 Unicode,  所以使用ugettext()代替gettext(), 使用ugettext_lazy()代替gettext_lazy().</p>\n\n<p>顾名思义, <q>lazy</q>该函数是对翻译字符串的引用， 而不是实际翻译的文本. 因此在访问值的时候会进行转换， 而不是调用的时候.</p>\n\n<p>注意这个特性，Django 启动的时候一些特定的代码只执行一次， 比如在<strong>models</strong>, <strong>forms</strong>和<strong>model forms</strong>.</p>\n\n<p>那么， 我们假设在模型定义的时候使用ugettext(), 而不是ugettext_lazy()会怎么样?</p>\n\n<ul>\n<li>1. Django 启动, 默认语言是英文.</li>\n<li>2. Django 选择了英文版的field labels</li>\n<li>3. 用户将网站语言改为简体中文.</li>\n<li>4. <strong>field labels</strong>依然是英文显示. </li>\n</ul>\n<blockquote class="blockquote-warning">\n                <p> 因为models的字段定义仅仅被执行一次，并且在执行定义代码的时候语言不是简体中文(一般是英文).</p></blockquote>\n<p>要避免这种行为，要必须正确的使用ugettext()和ugettext_lazy()</p>\n\n<p>下面总结了， 在合适的地方使用合适的函数:</p>\n\n<ul>\n<li><strong>ugettext_lazy():</strong>\n\n<ul>\n<li>models.py (fields, verbose_name, help_text, methods short_description);</li>\n<li>forms.py (labels, help_text, empty_label);</li>\n<li>apps.py (verbose_name).</li>\n</ul></li>\n<li><strong>ugettext():</strong>\n\n<ul>\n<li>views.py</li>\n<li>其他类似于在请求过程中调用的代码</li>\n</ul></li>\n</ul>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-19-protecting-sensitive-information', 'title': 'Django小技巧19: 保护敏感信息', 'date': datetime.datetime(2018, 11, 5, 16, 11, 9), 'cover': '/uploads/images/protecting-sensitive-information.jpg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/protecting-sensitive-information.jpg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2016/10/17/django-tip-18-translations.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>互联网是一片荒地， 在互联网上部署 Web 服务的时候， 安全是首要考虑的。Django 在提供可靠和安全的API方面做的非常出色.但是前提是你要正确的使用它们。</p>\n\n<p><strong>永远不应该在部署 WEB 服务的时候开启 DEBUG=True</strong></p>\n\n<p>DEBUG = True 一个很大的功能是发生异常的时候从你的环境中转储大量元数据， 并且暴露在页面中。包括整个 settings.py 的配置.</p>\n\n<p>即使你永远不会使用DEBUG = True, 在 settings.py 中命名配置时也需要格外的小心， 确保你的所有敏感配置的字段都包含下面关键字之一：</p>\n\n<ul>\n<li>API</li>\n<li>KEY</li>\n<li>PASS</li>\n<li>SECRET</li>\n<li>SIGNATURE</li>\n<li>TOKEN</li>\n</ul>\n\n<p>这样 Django 就不好转储哪些包含敏感信息的配置变量.</p>\n<figure id="code7218d2243a0e7aa8c4f14fd8343bbd6c" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">S3_BUCKET_KEY</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>\n</pre></div>\n<span class="title-label">#good#Do</span><figcaption><a class="lang-label" href="#code7218d2243a0e7aa8c4f14fd8343bbd6c"><\\>Python</a></figcaption></figure><figure id="code3d25411c82516fa0ca229bcfeb1b1c7e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">S3_BUCKET</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>\n<span class="n">JENKINS_MIMA</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxx&#39;</span>  <span class="c1"># 使用中文命名 jenkins_token</span>\n</pre></div>\n<span class="title-label">#error#Don\'t</span><figcaption><a class="lang-label" href="#code3d25411c82516fa0ca229bcfeb1b1c7e"><\\>Python</a></figcaption></figure>\n<p>即便你关闭的 DEBUG， 如果 Django 配置了电子邮件发送错误报告，也会有可能在公网环境中泄露错误报告从而泄露 settings 配置, 特别是没有加密的电子邮件传输协议。</p>\n<blockquote class="blockquote-normal">\n                <p><strong>特别注意的一点：</strong> 永远不要把敏感信息提交到公共代码仓库！换句话说，就说不要把敏感信息添加到 settings.py 中， 最好的方式是使用环境变量或者python-decouple. 后续会写一篇将配置上下线分离的文章</p></blockquote>\n<p>说到过滤错误报告，你应该使用两个过滤器:</p>\n<h3 id="sensitive_variables">sensitive_variables</h3>\n<p>可以定义一组局部敏感变量， 这些变量不好显示在错误报告中，从而达到保护它们的作用。</p>\n<figure id="codea67fa14180a5a75e25bcff8effb2f612" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.decorators.debug</span> <span class="kn">import</span> <span class="n">sensitive_variables</span>\n\n<span class="nd">@sensitive_variables</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;pw&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)</span>\n<span class="k">def</span> <span class="nf">process_info</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>\n    <span class="n">pw</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">pass_word</span>\n    <span class="n">cc</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">credit_card_number</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea67fa14180a5a75e25bcff8effb2f612"><\\>Python</a></figcaption></figure>\n<p>或者 ，如果想保护函数里的所有变量</p>\n<figure id="code754a32b2f2b8d50bd1654207a1b4b7a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="nd">@sensitive_variables</span><span class="p">()</span>\n<span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code754a32b2f2b8d50bd1654207a1b4b7a2"><\\>Python</a></figcaption></figure>\n<p>PS: 使用多个装饰器的时候， 确保<code>@sensitive_variables()</code>装饰器在第一个位置.</p>\n<h3 id="sensitive_post_parameters">sensitive_post_parameters</h3>\n<p>与前面的例子类似， 但这个处理 post 参数.</p>\n<figure id="code27975ba50f17ef046a496d1b3f7b04c2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.decorators.debug</span> <span class="kn">import</span> <span class="n">sensitive_post_parameters</span>\n\n<span class="nd">@sensitive_post_parameters</span><span class="p">(</span><span class="s1">&#39;pass_word&#39;</span><span class="p">,</span> <span class="s1">&#39;credit_card_number&#39;</span><span class="p">)</span>\n<span class="k">def</span> <span class="nf">record_user_profile</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="n">UserProfile</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>\n        <span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>\n        <span class="n">password</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;pass_word&#39;</span><span class="p">],</span>\n        <span class="n">credit_card</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;credit_card_number&#39;</span><span class="p">],</span>\n        <span class="n">name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>\n    <span class="p">)</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code27975ba50f17ef046a496d1b3f7b04c2"><\\>Python</a></figcaption></figure>\n<p>隐藏 post 所有参数</p>\n<figure id="code51c3ceefad72cc80611d94b6807b7df4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="nd">@sensitive_post_parameters</span><span class="p">()</span>\n<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="o">...</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code51c3ceefad72cc80611d94b6807b7df4"><\\>Python</a></figcaption></figure><blockquote class="blockquote-normal">\n                <p>阅读更多关于过滤敏感信息的文档. <a href="https://docs.djangoproject.com/en/dev/howto/error-reporting/#filtering-sensitive-information">Django Documentation</a></p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-20-multiple-settings-modules', 'title': 'Django小技巧20: 使用多个settings模块', 'date': datetime.datetime(2018, 11, 9, 13, 22, 43), 'cover': '/uploads/images/multiple-settings-modules.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/multiple-settings-modules.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2017/07/03/django-tip-20-working-with-multiple-settings-modules.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>通常来说， 为了保持项目的配置简单，我们会避免使用多个配置文件。但理想很丰满， 现实是随着项目越来越大， <strong>settings.py</strong>可能也会变得相当复杂. 在那种情况下， 你必须使用大量的<code>if</code>语句，类似于: if not DEBUG: # do something... .为了将<strong>development</strong>配置和<strong>production</strong>严格的分离，你可以将<strong>settings</strong>模块分解成多个文件. 这样对我们的配置可能更加清楚.</p>\n<h2 id="默认的基本结构">默认的基本结构</h2>\n<p>一个全新的 Django 项目结构默认情况下如下所示</p>\n<figure id="code05d6da835f01e2946d0d5c5246cdee1f" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings.py\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#code05d6da835f01e2946d0d5c5246cdee1f"><\\>Text</a></figcaption></figure>\n<p>我们在mysite目录中创建一个叫做<strong>settings</strong>的目录, 然后将原有的<strong>settings.py</strong>移动到 settings 目录中， 并更改名字为<strong>base.py</strong>. 如果使用 Python 2.x 增加<code>__init__.py</code>`文件.</p>\n<figure id="code7489c7e8112bf8f35f7929fda9850b83" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings/         &lt;--\n |    |    |-- __init__.py  &lt;--\n |    |    +-- base.py      &lt;--\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#code7489c7e8112bf8f35f7929fda9850b83"><\\>Text</a></figcaption></figure>\n<p>顾名思义, base.py 将提供适用于所有环境(development, production, staging, 等)配置.</p>\n\n<p>然后为每个环境创建一个<strong>settings</strong>模块. 常见的用例有</p>\n\n<ul>\n<li>ci.py</li>\n<li>development.py</li>\n<li>production.py</li>\n<li>staging.py</li>\n</ul>\n\n<p>然后文件结构应该和下面类似:</p>\n<figure id="codea58cd6e90561f3fb378d37613974d2aa" class="code-wrapper"><div class="highlight"><pre><span></span>mysite/\n |-- mysite/\n |    |-- __init__.py\n |    |-- settings/\n |    |    |-- __init__.py\n |    |    |-- base.py\n |    |    |-- ci.py\n |    |    |-- development.py\n |    |    |-- production.py\n |    |    +-- staging.py\n |    |-- urls.py\n |    +-- wsgi.py\n +-- manage.py\n</pre></div>\n<figcaption><a class="lang-label" href="#codea58cd6e90561f3fb378d37613974d2aa"><\\>Text</a></figcaption></figure><h2 id="配置新的settings.py">配置新的settings.py</h2>\n<p>依下面的base.py为例:</p>\n\n<p><strong>settings/base.py</strong></p>\n<figure id="code8ddcbdeeb3ebd19fb94b9824184fb07d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">decouple</span> <span class="kn">import</span> <span class="n">config</span>\n\n<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">)</span>\n\n<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;mysite.core&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;mysite.blog&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;mysite.urls&#39;</span>\n\n<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;mysite.wsgi.application&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8ddcbdeeb3ebd19fb94b9824184fb07d"><\\>Python</a></figcaption></figure>\n<p>为了保证实例简单， 我删除其他无效的代码</p>\n\n<p>然后创建<strong>development.py</strong>配置文件， 我可以直接通过 base 来扩展.</p>\n\n<p><strong>settings/development.py</strong></p>\n<figure id="codedb0d77d2f6025f8cf72854858e5cd410" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>\n\n<span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="p">[</span>\n    <span class="s1">&#39;debug_toolbar&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n\n<span class="n">MIDDLEWARE</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;debug_toolbar.middleware.DebugToolbarMiddleware&#39;</span><span class="p">,</span> <span class="p">]</span>\n\n<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.console.EmailBackend&#39;</span>\n\n<span class="n">DEBUG_TOOLBAR_CONFIG</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;JQUERY_URL&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codedb0d77d2f6025f8cf72854858e5cd410"><\\>Python</a></figcaption></figure>\n<p>然后， 你可以这样定义<strong>production.py</strong>模块</p>\n<figure id="code79b41b1c7330ced34e6ee07192fbc19f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="o">*</span>\n\n<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>\n\n<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mysite.com&#39;</span><span class="p">,</span> <span class="p">]</span>\n\n<span class="n">CACHES</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>\n        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span><span class="p">,</span>\n        <span class="s1">&#39;LOCATION&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1:11211&#39;</span><span class="p">,</span>\n    <span class="p">}</span>\n<span class="p">}</span>\n\n<span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="s1">&#39;django.core.mail.backends.smtp.EmailBackend&#39;</span>\n<span class="n">EMAIL_HOST</span> <span class="o">=</span> <span class="s1">&#39;smtp.mailgun.org&#39;</span>\n<span class="n">EMAIL_PORT</span> <span class="o">=</span> <span class="mi">587</span>\n<span class="n">EMAIL_HOST_USER</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;EMAIL_HOST_USER&#39;</span><span class="p">)</span>\n<span class="n">EMAIL_HOST_PASSWORD</span> <span class="o">=</span> <span class="n">config</span><span class="p">(</span><span class="s1">&#39;EMAIL_HOST_PASSWORD&#39;</span><span class="p">)</span>\n<span class="n">EMAIL_USE_TLS</span> <span class="o">=</span> <span class="bp">True</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code79b41b1c7330ced34e6ee07192fbc19f"><\\>Python</a></figcaption></figure>\n<p><strong>注意:</strong> 应该避免使用<code>import *</code>导入，<code>*</code>导入可能会在命名空间作用域中导入一些不必要的东西. 在某些情况下可能会产生冲突, 造成奇怪的问题. 另外一个问题是即使使用多个配置文件， 你依然要注意敏感数据的问题. 强烈推荐使用**Python-Decouple ** 这样的库来保护配置, 或者通过环境变量的形式使用密码或密钥配置.</p>\n<h2 id="如何使用多个配置文件">如何使用多个配置文件</h2>\n<p>因为我们代码库中已经没有<code>settings.py</code>文件， 所以不能直接使用<code>python manage.py runserver</code>.相反你必须在命令参数中指定settings模块.</p>\n<figure id="code019acd3f289fed2c351c1f923190bc66" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py runserver --settings<span class="o">=</span>mysite.settings.development\n</pre></div>\n<figcaption><a class="lang-label" href="#code019acd3f289fed2c351c1f923190bc66"><\\>Shell</a></figcaption></figure>\n<p>Or</p>\n<figure id="coded35439998717738e08dea07e08535828" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py migrate --settings<span class="o">=</span>mysite.settings.production\n</pre></div>\n<figcaption><a class="lang-label" href="#coded35439998717738e08dea07e08535828"><\\>Shell</a></figcaption></figure>\n<p>由于我们在开发中经常使用 manage.py, 因此你可以在<strong>manage.py</strong>中， 硬编码写死配置模块.</p>\n\n<p><strong>manage.py</strong></p>\n<figure id="code16cd95e6e570a1c255d807f715218ef7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>\n<span class="kn">import</span> <span class="nn">os</span>\n<span class="kn">import</span> <span class="nn">sys</span>\n\n<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>\n    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings.development&quot;</span><span class="p">)</span>  <span class="c1"># &lt;-- Change here!</span>\n    <span class="k">try</span><span class="p">:</span>\n        <span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>\n    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>\n        <span class="c1"># The above import may fail for some other reason. Ensure that the</span>\n        <span class="c1"># issue is really that Django is missing to avoid masking other</span>\n        <span class="c1"># exceptions on Python 2.</span>\n        <span class="k">try</span><span class="p">:</span>\n            <span class="kn">import</span> <span class="nn">django</span>\n        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>\n            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>\n                <span class="s2">&quot;Couldn&#39;t import Django. Are you sure it&#39;s installed and &quot;</span>\n                <span class="s2">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span>\n                <span class="s2">&quot;forget to activate a virtual environment?&quot;</span>\n            <span class="p">)</span>\n        <span class="k">raise</span>\n    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code16cd95e6e570a1c255d807f715218ef7"><\\>Python</a></figcaption></figure>\n<p>所以， 我们只改动了一行</p>\n<figure id="codeb74f15a9d060eb3cacada3a2e7542bc0" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb74f15a9d060eb3cacada3a2e7542bc0"><\\>Python</a></figcaption></figure>\n<p>改为</p>\n<figure id="codebeac03ec6755114da45849580257cb14" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;mysite.settings.development&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codebeac03ec6755114da45849580257cb14"><\\>Python</a></figcaption></figure><h2 id="也许可以更稳妥">也许可以更稳妥</h2>\n<p>现在我们有了多个配置模块， 这样你可以将<strong>AUTH<em>PASSWORD</em>VALIDATORS</strong>配置从<strong>base.py</strong>中移动到<strong>production.py</strong>中. 这样, 你可以在开发环境中使用简单密码(如: <q>123</q>). 但在生产环境中必须要通过密码验证才能使用.</p>\n\n<p>在你测试环境中的配置文件中(settings/ci.py or settings/tests.py), 覆盖以下配置, 以便加快你的测试用例速度:</p>\n<figure id="code78c5878fbb122d1bc74ba943cb0d9e3d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span>\n<span class="p">}</span>\n\n<span class="n">PASSWORD_HASHERS</span> <span class="o">=</span> <span class="p">(</span>\n    <span class="s1">&#39;django.contrib.auth.hashers.MD5PasswordHasher&#39;</span><span class="p">,</span>\n<span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code78c5878fbb122d1bc74ba943cb0d9e3d"><\\>Python</a></figcaption></figure><h2 id="结论">结论</h2>\n<p>多个配置文件虽然提供了便利， 但你还是需要小心使用. 任何情况下都要考虑安全. 如果有疑问， 通过下面评论讨论.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-21-redirects', 'title': 'Django小技巧21: 使用重定向', 'date': datetime.datetime(2018, 11, 9, 15, 14, 28), 'cover': '/uploads/images/redirects.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2017/08/11/django-tip-21-redirects-app.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>Django 附带了一组可以轻松安装的可选模块, 其中一个模块就是重定向的模块, 它在您想要更新某些现有URL而不损害您的网站SEO或在任何情况下避免404错误的情况下特别有用。</p>\n\n<p>比如我现有的 URL 是</p>\n<figure id="code46cf1fbb18978888fa191ed6539b7f9b" class="code-wrapper"><div class="highlight"><pre><span></span>/tips/2017/08/11/django-tip-21.html\n</pre></div>\n<figcaption><a class="lang-label" href="#code46cf1fbb18978888fa191ed6539b7f9b"><\\>Url</a></figcaption></figure>\n<p>在某一次更新之后 URL 有变动变成了:</p>\n<figure id="codec7a547998b0bed9b90653c100ec5a705" class="code-wrapper"><div class="highlight"><pre><span></span>/tips/redirects-app/\n</pre></div>\n<figcaption><a class="lang-label" href="#codec7a547998b0bed9b90653c100ec5a705"><\\>Url</a></figcaption></figure>\n<p>而且我原有 URL， 已经被搜索引擎收录. 我不想在用户通过搜索引擎点过来是404页面。 这时候就需要做重定向到新的地址</p>\n\n<p>redirects 模块是通过在数据库中创建一张表, 包含两个字段(old_path和new_path)来实现的.每当你的项目出现404错误的时候，redirects 组件将会拦截404响应， 并检索特定的 table 进行匹配, 如果在特定的 table 中匹配到old_path ,将会重定向到所绑定的new_path. 不会返回404, 而返回一个301响应(Moved Permanently).</p>\n\n<p>OK, 让我看看redirects在实践中如何执行</p>\n<h2 id="安装">安装</h2>\n<p>Django redirects 组件需要安装<strong>sites</strong>框架. 通过<strong>settings.py</strong>的<strong>INSTALLED_APPS</strong>来添加到项目中。</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code1b5dff6e40aaf2f7920710e1fefa7a73" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.sites&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.redirects&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b5dff6e40aaf2f7920710e1fefa7a73"><\\>Python</a></figcaption></figure>\n<p>设置<code>SITE_ID</code>让<strong>sites</strong>框架能够工作.</p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code712d5bdfab183e580ab067f0e51feec8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code712d5bdfab183e580ab067f0e51feec8"><\\>Python</a></figcaption></figure>\n<p>现在将redirects的中间件添加到<strong>MIDDLEWARE</strong></p>\n\n<p><strong>settings.py</strong></p>\n<figure id="code46e923b4835da1853076562364cd23c5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>\n    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>\n\n    <span class="s1">&#39;django.contrib.redirects.middleware.RedirectFallbackMiddleware&#39;</span><span class="p">,</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code46e923b4835da1853076562364cd23c5"><\\>Python</a></figcaption></figure>\n<p>通过<strong>migrate</strong>创建所需要的表：</p>\n<figure id="codecd3823dcb5cd6a0b316e48cfda8c2d95" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py migrate\n</pre></div>\n<figcaption><a class="lang-label" href="#codecd3823dcb5cd6a0b316e48cfda8c2d95"><\\>Shell</a></figcaption></figure><h2 id="使用">使用</h2>\n<p>最简单的方式通过 Django Admin 来对这个表添加记录. 如果你没有 Django Admin, 并且此操作是一次性的事情, 你可以通过redirects的 Python API 或者创建一个<strong>fixture</strong>. 如果你不使用Django Admin 但这个不是一次性的事情， 需要后面维护更新这个表， 那么你需要创建一个自己的视图管理页面.</p>\n<h3 id="通过DjangoAdmin管理redirects">通过DjangoAdmin管理redirects</h3>\n<p>默认情况下， 安装后会自动加到 Django Admin 界面</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects-admin.png"></div><figcaption class="img-title">#Django Admin 管理 redirects</figcaption></figure></p>\n\n<p>只需添加对应的路径， redirects组件将会自动完成这个重定向工作</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/redirects-admin-create.png"></div><figcaption class="img-title">#redirects table</figcaption></figure></p>\n\n<p>你可以通过浏览器来访问旧的路径， 看看他是否能够正常的重定向. 另一种方法是检测响应的body, 可以通过<code>curl</code>来完成:</p>\n<figure id="code193a726836828e503dbb0c3e410f5816" class="code-wrapper"><div class="highlight"><pre><span></span>curl --head <span class="m">127</span>.0.0.1:8000/tips/2017/08/11/django-tip-21.html\n\nHTTP/1.0 <span class="m">301</span> Moved Permanently\nDate: Fri, <span class="m">11</span> Aug <span class="m">2017</span> <span class="m">15</span>:42:27 GMT\nServer: WSGIServer/0.2 CPython/3.6.1\nContent-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8\nLocation: /tips/redirects-app/\nX-Frame-Options: SAMEORIGIN\nContent-Length: <span class="m">0</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code193a726836828e503dbb0c3e410f5816"><\\>Shell</a></figcaption></figure><h3 id="通过Python API管理redirects">通过Python API管理redirects</h3>\n<p>你可以通过 Django ORM 来对 redirects 的 Model 进行操作管理. 它位于<a href="https://github.com/django/django/blob/master/django/contrib/redirects/models.py">django/contrib/redirects/models.py</a>.</p>\n\n<p>以下是创建redirects 条目的示例代码:</p>\n<figure id="code1b4ce31f86b1f1817e98d3835f4ea18d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.redirects.models</span> <span class="kn">import</span> <span class="n">Redirect</span>\n<span class="kn">from</span> <span class="nn">django.contrib.sites.models</span> <span class="kn">import</span> <span class="n">Site</span>\n<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>\n\n<span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">SITE_ID</span><span class="p">)</span>\n\n<span class="n">Redirect</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">old_path</span><span class="o">=</span><span class="s1">&#39;/index.html&#39;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>\n<span class="n">Redirect</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span> <span class="n">old_path</span><span class="o">=</span><span class="s1">&#39;/tips/2017/08/11/django-tip-21.html&#39;</span><span class="p">,</span> <span class="n">new_path</span><span class="o">=</span><span class="s1">&#39;/tips/redirects-app/&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1b4ce31f86b1f1817e98d3835f4ea18d"><\\>Python</a></figcaption></figure><h3 id="通过Fixtures导入redirects">通过Fixtures导入redirects</h3>\n<p>关于Fixtures, 是 Django 提供的一个功能， 可以到这里<a href="https://code.djangoproject.com/wiki/Fixtures">查看文档了解更多</a>.</p>\n\n<p>首先按照以下示例的模板创建 JSON 文件</p>\n\n<p><strong>redirects-fixture.json</strong></p>\n<figure id="codee752ff4322bd3c92360c50e4cb26fbb4" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">[</span>\n   <span class="p">{</span>\n      <span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;redirects.redirect&quot;</span><span class="p">,</span>\n      <span class="nt">&quot;fields&quot;</span><span class="p">:{</span>\n         <span class="nt">&quot;site&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>\n         <span class="nt">&quot;old_path&quot;</span><span class="p">:</span><span class="s2">&quot;/tips/2017/08/11/django-tip-21.html&quot;</span><span class="p">,</span>\n         <span class="nt">&quot;new_path&quot;</span><span class="p">:</span><span class="s2">&quot;/tips/redirects-app/&quot;</span>\n      <span class="p">}</span>\n   <span class="p">},</span>\n   <span class="p">{</span>\n      <span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;redirects.redirect&quot;</span><span class="p">,</span>\n      <span class="nt">&quot;fields&quot;</span><span class="p">:{</span>\n         <span class="nt">&quot;site&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>\n         <span class="nt">&quot;old_path&quot;</span><span class="p">:</span><span class="s2">&quot;/index.html&quot;</span><span class="p">,</span>\n         <span class="nt">&quot;new_path&quot;</span><span class="p">:</span><span class="s2">&quot;/&quot;</span>\n      <span class="p">}</span>\n   <span class="p">}</span>\n<span class="p">]</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee752ff4322bd3c92360c50e4cb26fbb4"><\\>Json</a></figcaption></figure>\n<p>然后通过命令将其加载到数据库</p>\n<figure id="code9237c41bfbc81e877d03026a7d76bf40" class="code-wrapper"><div class="highlight"><pre><span></span>python manage.py loaddata redirects-fixtures.json\nInstalled <span class="m">2</span> object<span class="o">(</span>s<span class="o">)</span> from <span class="m">1</span> fixture<span class="o">(</span>s<span class="o">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9237c41bfbc81e877d03026a7d76bf40"><\\>Shell</a></figcaption></figure>\n<p>就是这样~</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-tips-22-designing-better-models', 'title': 'Django小技巧22: 设计一个好的模型', 'date': datetime.datetime(2018, 11, 9, 16, 14, 28), 'cover': '/uploads/images/designing-better-models.jpeg', 'set': 'Django小技巧', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/designing-better-models.jpeg"></div></figure></p>\n<blockquote class="blockquote-normal">\n                <p>翻译整理自: <a href="https://simpleisbetterthancomplex.com/tips/2018/02/10/django-tip-22-designing-better-models.html">simpleisbetterthancomplex.com</a></p></blockquote>\n<p>本篇将分享一些技巧，用户改进 Model 的设计。其中有很多与命名约定有关， 这可以大大的提高代码的可读性。</p>\n\n<p><a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a>规范， 广泛用于 Python 领域, 因此我建议你在项目中使用它.</p>\n\n<p>除了 PEP8 ， 我更喜欢<a href="https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/">Django编程风格</a>.</p>\n\n<p>本篇目录:</p>\n\n<ul>\n<li><a href="#naming-your-models">命名你的Model</a></li>\n<li><a href="#model-style-ordering">Model定义顺序</a></li>\n<li><a href="#reverse-relationships">反向关系</a></li>\n<li><a href="#blank-and-null-fields">Blank 和 Null</a></li>\n</ul>\n\n<h2 id="naming-your-models">命名 Model</h2>\n\n<p>模型定义使用<strong>CapWords</strong>约定(没有下划线). 例如: <code>User</code>, <code>Permission</code>, <code>ContentType</code>.</p>\n\n<p>模型的属性使用 <a href="https://en.wikipedia.org/wiki/Snake_case"><strong>snake_case</strong></a>. 例如: <code>first_name</code>, <code>last_name</code>.</p>\n\n<p>如:</p>\n<figure id="code82af3882f60e194c81048eee8607db92" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">vat_identification_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code82af3882f60e194c81048eee8607db92"><\\>Python</a></figcaption></figure>\n<p><strong>始终使用单数明明你的模型</strong>, 用<strong>Company</strong>代替<strong>Companies</strong>. 模型的定义是对单个对象的表示， 而不是公司的集合.</p>\n\n<p>这通常会导致混淆，因为我们倾向于通过数据库思考。模型最终被翻译成table.该表使用其复数形式命名的.</p>\n\n<p>在 DJango 中，我们可以通过<code>Company.objects</code>来访问集合. 我可以通过定义<strong>models.Manager</strong>重命名<strong>objects</strong>属性.</p>\n<figure id="codeb1b6413da0603116cd3d2c9ad80d389d" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="c1"># ...</span>\n    <span class="n">companies</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb1b6413da0603116cd3d2c9ad80d389d"><\\>Python</a></figcaption></figure>\n<p>而后， 可以通过下面语句来使用 Django ORM QuerySet 查询.</p>\n<figure id="codec5a363fa95df8b0368ad9bc12d55371b" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Company</span><span class="o">.</span><span class="n">companies</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec5a363fa95df8b0368ad9bc12d55371b"><\\>Python</a></figcaption></figure>\n<p>这样看起来代码就很有可读性了</p>\n\n<h2 id="model-style-ordering">Model 定义顺序</h2>\n\n<p>Django Coding Style 建议内部类，方法和属性的顺序为：</p>\n\n<ul>\n<li>如果字段有<code>choices</code>参数, 则每个选项定义为元祖中元祖.并使用全大写的名称作为值属性。</li>\n<li>所有数据库fields</li>\n<li>Custom manager attributes</li>\n<li>class Meta</li>\n<li>def __str__()</li>\n<li>def save()</li>\n<li>def get_absolute_url()</li>\n<li>其他自定义方法</li>\n</ul>\n\n<p>如:</p>\n<figure id="code4a09ea34c784bf9d4ab3a91009142347" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>\n<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>\n\n<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="c1"># CHOICES</span>\n    <span class="n">PUBLIC_LIMITED_COMPANY</span> <span class="o">=</span> <span class="s1">&#39;PLC&#39;</span>\n    <span class="n">PRIVATE_COMPANY_LIMITED</span> <span class="o">=</span> <span class="s1">&#39;LTD&#39;</span>\n    <span class="n">LIMITED_LIABILITY_PARTNERSHIP</span> <span class="o">=</span> <span class="s1">&#39;LLP&#39;</span>\n    <span class="n">COMPANY_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>\n        <span class="p">(</span><span class="n">PUBLIC_LIMITED_COMPANY</span><span class="p">,</span> <span class="s1">&#39;Public limited company&#39;</span><span class="p">),</span>\n        <span class="p">(</span><span class="n">PRIVATE_COMPANY_LIMITED</span><span class="p">,</span> <span class="s1">&#39;Private company limited by shares&#39;</span><span class="p">),</span>\n        <span class="p">(</span><span class="n">LIMITED_LIABILITY_PARTNERSHIP</span><span class="p">,</span> <span class="s1">&#39;Limited liability partnership&#39;</span><span class="p">),</span>\n    <span class="p">)</span>\n\n    <span class="c1"># DATABASE FIELDS</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">vat_identification_number</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;VAT&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>\n    <span class="n">company_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">COMPANY_TYPE_CHOICES</span><span class="p">)</span>\n\n    <span class="c1"># MANAGERS</span>\n    <span class="n">objects</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>\n    <span class="n">limited_companies</span> <span class="o">=</span> <span class="n">LimitedCompanyManager</span><span class="p">()</span>\n\n    <span class="c1"># META CLASS</span>\n    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>\n        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>\n        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;companies&#39;</span>\n\n    <span class="c1"># TO STRING METHOD</span>\n    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>\n\n    <span class="c1"># SAVE METHOD</span>\n    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>\n        <span class="n">do_something</span><span class="p">()</span>\n        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Call the &quot;real&quot; save() method.</span>\n        <span class="n">do_something_else</span><span class="p">()</span>\n\n    <span class="c1"># ABSOLUTE URL METHOD</span>\n    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;company_details&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pk&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>\n\n    <span class="c1"># OTHER METHODS</span>\n    <span class="k">def</span> <span class="nf">process_invoices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>\n        <span class="n">do_something</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code4a09ea34c784bf9d4ab3a91009142347"><\\>Python</a></figcaption></figure>\n<h2 id="reverse-relationships">反向关系</h2>\n<h3 id="related_name">related_name</h3>\n<p>ForeignKey 的 related_name 可以为反向关系定义一个有意义的名称</p>\n\n<p>经验法则: 如果你不确定<code>related_name</code>是什么， 请使用包含所定义ForeignKey的模型的复数形式.</p>\n<figure id="code8c340dbb880156ed3bbff4a74e97befe" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">:</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n\n<span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>\n    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">company</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;employees&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8c340dbb880156ed3bbff4a74e97befe"><\\>Python</a></figcaption></figure>\n<p>上面代码意味着， Company 有一个<code>employees</code>特殊属性, 该属性将返回一个 QuerySet，其中包含与此公司相关的所有员工实例</p>\n<figure id="code3a789939eb0a5e524a81923ced225077" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">google</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n<span class="n">google</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3a789939eb0a5e524a81923ced225077"><\\>Python</a></figcaption></figure>\n<p>你也可以通过反向关系， 来更新Company的employees字段.</p>\n<figure id="coded8ac79af0749ec7ff9ae3332b0d1a56a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">vitor</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n<span class="n">google</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Google&#39;</span><span class="p">)</span>\n<span class="n">google</span><span class="o">.</span><span class="n">employees</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vitor</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded8ac79af0749ec7ff9ae3332b0d1a56a"><\\>Python</a></figcaption></figure><h3 id="related_query_name">related_query_name</h3>\n<p>这种关系也是用于查询过滤器， 比如我们要查询雇佣名为「Vitor」的所有公司:</p>\n<figure id="codee6b69be1e82e866e689987d3c6e912e6" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">companies</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">employee__first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee6b69be1e82e866e689987d3c6e912e6"><\\>Python</a></figcaption></figure>\n<p>如果你想自定义此关系的查询名称可以这样</p>\n<figure id="code89c6bd9493f5bc683c7cb8e15c7a9a0e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">:</span>\n    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>\n    <span class="n">company</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>\n        <span class="n">Company</span><span class="p">,</span>\n        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>\n        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;employees&#39;</span><span class="p">,</span>\n        <span class="n">related_query_name</span><span class="o">=</span><span class="s1">&#39;person&#39;</span>\n    <span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code89c6bd9493f5bc683c7cb8e15c7a9a0e"><\\>Python</a></figcaption></figure>\n<p>然后这样查询</p>\n<figure id="code09b030a9819fe4b2e2f822e98a5f2a65" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">companies</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">person__first_name</span><span class="o">=</span><span class="s1">&#39;Vitor&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code09b030a9819fe4b2e2f822e98a5f2a65"><\\>Python</a></figcaption></figure>\n<p>代码要保持一致， <strong>related_name</strong>是复数, <strong>related_query_name</strong>是单数.</p>\n\n<h2 id="blank-and-null-fields">Blank 和 Null</h2>\n\n<p>我在另一篇文章有讲过两者的区别 <a href="/words/django-tips-08-blank-or-null.html">Blank or Null</a>，在这里我会总结一下.</p>\n\n<ul>\n<li><strong>null</strong>: 数据库相关； 定义数据库字段的值是否接受空值。</li>\n<li><strong>blank</strong>: 验证相关， 当调用<code>form.is_valid()</code>时， 将会判断值是否为空.</li>\n</ul>\n\n<p>虽然两者的是有区别的， 但一个拥有<code>null=True</code>和<code>blank=False</code>的字段是完全没有问题的。 在数据库级别上， 该字段可以为 NULL， 但在应用程序级别上， 它是必填字段(前提你通过 Django 标准的 Form 进行判断)。</p>\n\n<p>大多数开发人员都对基于字符串的字段(<code>CharField</code>和<code>TextField</code>)定义<code>null=True</code>, 这其实是没有必要的, 应该避免这样做，因为 Django约定使用空字符串设置空值， 而非<strong>Null</strong>.</p>\n\n<p>所以， 如果你想设置一个基于字符的字段可以为空，那么你应该这样做:</p>\n<figure id="code61eab99acda25e6f31dc2df010946917" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>\n    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>  <span class="c1"># 强制填写</span>\n    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c1"># 可选填写 (不要设置null=True)</span>\n    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># 可选填写 (这里你应该设置null=True)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code61eab99acda25e6f31dc2df010946917"><\\>Python</a></figcaption></figure><h2 id="进阶">进阶</h2>\n<p>模型定义是应用程序重要的一部分， 请务必使用合适的字段类型. 这里是 <a href="https://docs.djangoproject.com/en/dev/ref/models/fields/#field-types">Django 支持的所有字段类型</a>.</p>\n\n<p>如果你对代码风格规范感兴趣， 可以读一读<a href="https://docs.djangoproject.com/en/dev/internals/contributing/writing-code/coding-style/">Django Coding Style</a>. 当然也可以看一看<a href="http://flake8.pycqa.org/en/latest/">Flake8</a>.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#('个人项目', [{'filename': 'jianshuhot', 'title': 'Scrapy抓取简书热门生成电子书发送到Kindle', 'date': datetime.datetime(2016, 1, 14, 16, 31, 14), 'cover': None, 'set': '个人项目', 'content': '<p><a href="http://www.jianshu.com">简书</a>是个学习的好网站， 我大多只关注首页上的人们文章， 但是最近因为忙错过了很多首页上的文章，所以有了想法把每天的热门top生成mobi推送到kindle。这样在地铁上也能快速翻完. </p>\n\n<p>环境准备:</p>\n\n<ul>\n<li>一台主机(需要联网)</li>\n<li>Gitbook</li>\n<li>calibre(Gitbook 依赖calibre的<code>ebook-convert</code>)</li>\n<li>Python2.7.9(calibre 需要<code>python2.7.9</code>)</li>\n<li>项目地址:  <strong><a href="https://github.com/jackeyGao/jianshuHot">jianshuHot</a></strong></li>\n</ul>\n<h2 id="关于calibre安装">关于calibre安装</h2><figure id="code91781e99d515fb35ac3df70b7afac4cd" class="code-wrapper"><div class="highlight"><pre><span></span>sudo -v <span class="o">&amp;&amp;</span> wget -nv -O- https://raw.githubusercontent.com/kovidgoyal/calibre/master/setup/linux-installer.py <span class="p">|</span> sudo python -c <span class="s2">&quot;import sys; main=lambda:sys.stderr.write(&#39;Download failed\\n&#39;); exec(sys.stdin.read()); main()&quot;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code91781e99d515fb35ac3df70b7afac4cd"><\\>Bash</a></figcaption></figure>\n<p>官网文档提供的安装脚本看似简单， 执行之后也可以安装使用了， 但是gitbook调用<code>ebook-convert</code>时候会报错， 这个地方报错应该是QT的错误(至少我遇到的是, 具体错误信息忘记截图了)如果遇到此错误直接安装QT pyQT即可. <a href="http://calibre-ebook.com/download_linux">calibre 安装页面</a>有依赖表</p>\n<h2 id="Gitbook 安装">Gitbook 安装</h2>\n<p>需要安装<code>nodejs</code>和<code>npm</code>然后执行<code>npm install -g gitbook-cli</code></p>\n<h2 id="安装jianshuHot">安装jianshuHot</h2>\n<p>需要强调的是此部分需要解决大量的依赖,</p>\n\n<p><strong><code>scrapy</code></strong>所依赖的python包很多， 而且这些依赖的python大多需要一些系统库， 必要的时候需要<code>apt-get</code>、<code>yum</code>安装一下, 如<code>python-devel</code> <code>libffi-devel</code> <code>libxml-devel</code>等....</p>\n\n<p><strong><code>peewee</code></strong> (数据库ORM)要<code>mysql-devel</code>， 以上举例都是已知的， 这是在我部署之后写的， 部署的过程没有详细记录， 现在只能靠回忆来写本章节.</p>\n<figure id="code45676c2f6c4bcde600165a39e7a576b1" class="code-wrapper"><div class="highlight"><pre><span></span>$ git clone https://github.com/jackeyGao/jianshuHot\n$ <span class="nb">cd</span> jianshuHot\n$ pip install -r requirements.txt\n</pre></div>\n<figcaption><a class="lang-label" href="#code45676c2f6c4bcde600165a39e7a576b1"><\\>Bash</a></figcaption></figure><h2 id="初始化程序">初始化程序</h2><figure id="codeea0fdd4cb793c6733450c3f4d6d3055f" class="code-wrapper"><div class="highlight"><pre><span></span>$ sh init.sh\n</pre></div>\n<figcaption><a class="lang-label" href="#codeea0fdd4cb793c6733450c3f4d6d3055f"><\\>Bash</a></figcaption></figure><h2 id="邮件配置">邮件配置</h2>\n<p>这里发送邮件使用的<a href="http://caspian.dotconf.net/menu/Software/SendEmail/">sendEmail</a>, <a href="http://caspian.dotconf.net/menu/Software/SendEmail/">下载地址</a> . 解压后把解压的<code>sendEmail</code>重命名到<code>/usr/local/bin/sendEmail</code>理论上都能安装成功， 这个是免编译的， 只需要机器上安装了<code>perl</code></p>\n\n<p>然后修改start.sh 邮箱配置， 写成你自己163邮箱， 也可以用其他品牌邮箱， 如果你用其他品牌别忘了改下<code>smtp.163.com</code>, 改成相应的smtp服务器即可.</p>\n\n<p><strong>注意:</strong> 无论你用哪个邮箱都必须把此邮箱账号加入亚马逊<strong><code>已认可的发件人电子邮箱列表</code></strong>， 确保发送的文档能到达亚马逊Cloud</p>\n<figure id="codebe61db7b4ce4c51b62b617b5f80823d8" class="code-wrapper"><div class="highlight"><pre><span></span>$ vim start.sh\n....\n<span class="nv">YOURKINDLE_MAIL_ADDRESS</span><span class="o">=</span><span class="s2">&quot;xxxxx@kindle.cn&quot;</span>\n<span class="nv">YOUR_SEND_MAIL_USERNAME</span><span class="o">=</span><span class="s2">&quot;xxxx@163.com&quot;</span>\n<span class="nv">YOUR_SEND_MAIL_SECRET</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxx&#39;</span>\n<span class="nv">MOBI_BOOK_PATH</span><span class="o">=</span><span class="s1">&#39;./output/book.mobi&#39;</span>\n...\n</pre></div>\n<figcaption><a class="lang-label" href="#codebe61db7b4ce4c51b62b617b5f80823d8"><\\>Bash</a></figcaption></figure><h2 id="开始抓取生成">开始抓取生成</h2><figure id="codea06e1315dee417aa7b6e866e6eb380c1" class="code-wrapper"><div class="highlight"><pre><span></span>$ sh start.sh\n</pre></div>\n<figcaption><a class="lang-label" href="#codea06e1315dee417aa7b6e866e6eb380c1"><\\>Bash</a></figcaption></figure>\n<p>执行后会自动抓取页面生成markdown， 下载每个文章的图片， 然后gitbook通过markdown生成此次文档列表的<code>book.mobi</code> (output/book.mobi), 在start.sh 最后面有个备份的操作， 会把此次的mobi备份到<code>output/books</code>. 然后发送到指定的kindle地址邮箱.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'use-vuejs-and-semantic-ui-todolist', 'title': '使用Vue.js 和 semantic-ui 的一个简单TODO List', 'date': datetime.datetime(2016, 8, 22, 10, 11, 1), 'cover': None, 'set': '个人项目', 'content': '<blockquote class="blockquote-normal">\n                <p>项目地址: <strong><a href="https://github.com/jackeyGao/vue-semantic-todos">jackeyGao/vue-semantic-todos</a></strong></p></blockquote>\n<p>这是一个完全仿照官网案例的项目, 主要为了熟悉vue.js的基本用法, 不得不说这个案例能吸收到基本的vue.js 操作. </p>\n\n<p>根据重写此项目可以学到下面几个知识点:</p>\n\n<ul>\n<li>基本的数据绑定语法</li>\n<li>计算属性</li>\n<li>Class 绑定</li>\n<li>条件渲染</li>\n<li>列表渲染</li>\n<li>方法与事件绑定</li>\n<li>表单空间绑定</li>\n<li>自定义指令</li>\n</ul>\n\n<p>额外还能学习到<code>localStorage</code>的简单用法.可以说通过详细学习此例子可以完成vue.js最基本的入门操作， 完全熟悉不太容易， 主要是感受下vue.js的思想，和正确的使用方式, 后面还需要多写多看.</p>\n\n<iframe width="100%" scrolling="no" height="600" src="/projects/vue-semantic-ui-todo-list/index.html" frameborder="0"></iframe>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'crawl-ci', 'title': '全宋词爬取过程及数据分析', 'date': datetime.datetime(2017, 3, 7, 14, 11, 1), 'cover': '/uploads/images/WX20180516-101305@2x.png', 'set': '个人项目', 'content': '<script src="/static/3rd/tagul.min.js" async defer></script>\n\n<style>\n\n.block {\n    padding-bottom: 0 !important;\n}\n\n</style>\n\n<p><figure class="hassubimage hidden"><div class="image"><img src="/uploads/images/WX20180516-101305@2x.png"></div><figcaption class="img-title">#hidden</figcaption></figure>\n由于某个公众号对我仓库<a href="https://github.com/jackeyGao/chinese-poetry">chinese-poetry</a>的推广， 短时间大量涨粉， 有人想要宋词的数据。 于是最近利用零散时间对全宋词进行爬取分析， 并做了简单的分析， 发现了一些不得了的事情。</p>\n\n<p>分析仅仅对全宋词的内容进行了关键字排名分析、 宋词作者产量分析、 最受欢迎的词牌名排名分析</p>\n<h2 id="关键字排名分析">关键字排名分析</h2>\n<p>宋人喜欢用东风， 东风作为现代也会微妙， 人间、何处从唐诗就开始蝉联前三. 即使到了现代， 这两个词依存古风.</p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/uifp9qxzt4ea" data-tagul-show-attribution></div>\n<h2 id="宋词作者产量分析">宋词作者产量分析</h2>\n<p>辛弃疾果不其然的成为两宋现存词最多的作家, 还有一些虽然产量丰富但未必是我们熟知的。</p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/hs8hgxlpmo29" data-tagul-show-attribution></div>\n<h2 id="最受欢迎的词牌名排名分析">最受欢迎的词牌名排名分析</h2>\n<p>浣溪沙作为婉约 豪放两派所常用的词牌， 在两宋时期作为最受欢迎也是理所应当. </p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/xb019pkh27dn" data-tagul-show-attribution></div>\n\n<p>爬取逻辑没有做相应的系统化处理， 只是简单的脚本， 配置交互式界面做的操作。采用的相关技术: Python + parsel + peewee + requests + jieba</p>\n\n<p>附上爬取解析脚本的逻辑:</p>\n\n<div class="gist">\n<script src="https://gist.github.com/jackeyGao/d73381087b1278177aab60636f635119.js"></script>\n</div>\n\n<div class="gist">\n<script src="https://gist.github.com/jackeyGao/6a68100a0298895c6ef92869669a12c2.js"></script>\n</div>\n<h2 id="运行">运行</h2>\n<p>分别保存上面两个脚本为<strong>parse.py</strong>和<strong>db.py</strong>, 然后执行以下命令</p>\n<figure id="codec19f2fb72fbe7c732bce186cf7cf4105" class="code-wrapper"><div class="highlight"><pre><span></span>$ pip install peewee parsel requests\n$ python db.py <span class="c1"># 初始化数据库</span>\n$ python parse.py\n</pre></div>\n<figcaption><a class="lang-label" href="#codec19f2fb72fbe7c732bce186cf7cf4105"><\\>Bash</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'ngraph', 'title': '数据可视化系统NGraph', 'date': datetime.datetime(2017, 3, 13, 17, 30, 1), 'cover': None, 'set': '个人项目', 'content': '<p>去年重写了报表系统并为之取名为NGraph, 目的是做一套可以通过API提交数据来生成可视化数据的系统。</p>\n\n<p>此系统第一版本只有报表项目， NGraph加入了监控报表的概念， 来区分报表项目， 并且优先级大于报表项目。 同时还有数据导出的工具. 报表目前支持table和pie.</p>\n<h1 id="相关功能截图">相关功能截图</h1>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-dashboard.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-monitor.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-database.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-pie.png"></div></figure></p>\n\n<p>其实很想把此项目完善下并开源， 但是觉得功能有点少， 而且目前有Grafana这样的开源系统， 开源的计划也就停止了.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'hawkeye', 'title': '多监控平台统一 | Hawkeye', 'date': datetime.datetime(2018, 3, 27, 10, 1, 11), 'cover': None, 'set': '个人项目', 'content': '<p>近年来出现越来越多的监控平台， 每一个监控平台都是其擅长的地方， 比方说 zabbix 监控收集， 并监控基础服务。 grafana 监控平台可以很好的展示数据， kibana 又是日志相关的监控， 可以很出色的自定义很多业务监控。 总而言之基本上大多数有一定技术规模的公司， 运维都有很多监控平台。</p>\n\n<p>多监控平台虽然好， 但暴露一个问题, 那就是关注度低， 因为有时候祸绝不单行， 一个问题的爆发， 往往在底层或者高层就已经暴露出来, 而我们需要来回的切换各个平台的监控图表， 这样排查起来非常慢。 如果我们能够更立体的看全部的监控报表， 那么暴露的问题也就一目了然了。</p>\n\n<p>我进入 teambition 刚开始就是在做多监控平台统一的事情， 当时想的是把所有的数据全部写到一个平台， 而后通过结构化数据统一生成图表。 但构思太大， 实现起来艰难。 于是此项目难产了。</p>\n\n<p>现在用的是嵌入的方式，幸运的是 zabbix、grafana、kibana 都支持嵌入， 而且每个图表的嵌入都支持start<em>time和 end</em>time, 这使得一个页面大盘看多个平台的监控就非常直观。</p>\n<h2 id="各个平台的嵌入 URL 组成部分.">各个平台的嵌入 URL 组成部分.</h2><h3 id="Zabbix">Zabbix</h3><figcaption id="code3502914b60dd69bc3d9b8daabf3bc3af" class="code-wrapper">\n<div class="highlight"><pre>http://HOST:PORT/chart2.php?graphid=1911&period=1800&stime=20190309095657&updateProfile=1&profileIdx=web.screens&profileIdx2=1911&width=1302</pre><figcaption><a href="#code3502914b60dd69bc3d9b8daabf3bc3af" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<h3 id="Grafana">Grafana</h3><figcaption id="code79ed0cf364d7c1af4cdd048e8f006099" class="code-wrapper">\n<div class="highlight"><pre>https://grafana.teambition.net/dashboard-solo/db/cpu-overview?orgId=1&panelId=5&from=1520540867986&to=1520562467987</pre><figcaption><a href="#code79ed0cf364d7c1af4cdd048e8f006099" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<h3 id="Kibana">Kibana</h3><figcaption id="codefcd109a1075a91253843570654ac0bc1" class="code-wrapper">\n<div class="highlight"><pre>https://elk.teambition.net/app/kibana#/visualize/edit/API-response-time-(avg)?embed=true&_g=()&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:\'*\')),uiState:(),vis:(aggs:!((enabled:!t,id:\'1\',params:(field:req_time),schema:metric,type:avg),(enabled:!t,id:\'2\',params:(customInterval:\'2h\',extended_bounds:(),field:timestamp,interval:auto,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!t,addTimeMarker:!f,addTooltip:!t,categoryAxes:!((id:CategoryAxis-1,labels:(show:!t,truncate:100),position:bottom,scale:(type:linear),show:!t,style:(),title:(),type:category)),defaultYExtents:!f,grid:(categoryLines:!f,style:(color:%23eee)),interpolate:linear,legendPosition:right,mode:stacked,scale:linear,seriesParams:!((data:(id:\'1\',label:Count),drawLinesBetweenPoints:!t,interpolate:linear,mode:stacked,show:true,showCircles:!t,type:area,valueAxis:ValueAxis-1)),setYExtents:!f,shareYAxis:!t,smoothLines:!f,times:!(),valueAxes:!((id:ValueAxis-1,labels:(filter:!f,rotate:0,show:!t,truncate:100),name:LeftAxis-1,position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:Count),type:value)),yAxis:()),title:\'API+response+time+(avg)\',type:area))</pre><figcaption><a href="#codefcd109a1075a91253843570654ac0bc1" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n\n<p>可以看到三个平台支持开始时间和结束时间， 这方便了我们 hawkeye 平台的时间选择控制。</p>\n<h2 id="核心处理URL代码">核心处理URL代码</h2>\n<p>根据所指定的开始时间和结束时间， 对各个平台的 url 进行处理。 最后生成 url。</p>\n<figure id="coded665a9fd78152633234f53563816d5e3" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reload_url</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>\n    <span class="n">s_cst</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">28800000</span>\n    <span class="n">e_cst</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">28800000</span>\n    <span class="n">zabbix</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;stime&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">s_cst</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span>\n        <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>\n        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;600&quot;</span>\n    <span class="p">}</span>\n\n    <span class="n">grafana</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">e</span> <span class="p">}</span>\n\n    <span class="n">kibana</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%s</span><span class="s2">Z&quot;</span><span class="p">),</span>\n        <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%s</span><span class="s2">Z&quot;</span><span class="p">),</span>\n    <span class="p">}</span>\n\n    <span class="n">kibana</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;_g&quot;</span><span class="p">:</span> <span class="s2">&quot;(refreshInterval:(display:On,pause:!f,value:0),&quot;</span> <span class="o">+</span> \\\n        <span class="s2">&quot;time:(from:&#39;</span><span class="si">%s</span><span class="s2">&#39;,mode:absolute,to:&#39;</span><span class="si">%s</span><span class="s2">&#39;))&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kibana</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="n">kibana</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">])</span>\n    <span class="p">}</span>\n\n    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>\n        <span class="n">r</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>\n        <span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">://</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">r</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span><span class="p">)</span>\n\n        <span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ZB&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">zabbix</span><span class="p">)</span>\n        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;GF&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grafana</span><span class="p">)</span>\n        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kibana</span><span class="p">)</span>\n\n        <span class="n">query_string</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_dict</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">full_url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">query_string</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">full_url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">query_string</span>\n\n        <span class="n">item</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">full_url</span>\n    <span class="k">return</span> <span class="n">items</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded665a9fd78152633234f53563816d5e3"><\\>Python</a></figcaption></figure><h2 id="项目效果图">项目效果图</h2>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/hawkeye-overview.png"></div><figcaption class="img-title">#大盘</figcaption></figure>\n<figure class="hassubimage"><div class="image"><img src="/uploads/images/hawkeye-control.png"></div><figcaption class="img-title">#控制</figcaption></figure></p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'my-vscode-global-settings', 'title': '我的 VSCode 配置', 'date': datetime.datetime(2019, 7, 24, 9, 35, 48), 'cover': '/uploads/images/vscode.png', 'set': '个人项目', 'content': '<p>Python 程序员应该首要使用免费的 <a href="https://code.visualstudio.com/" title="微软开发的开源代码编辑器.">VSCode</a> <sup>[1]</sup> 编辑器.</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/vscode.png"></div><figcaption class="img-title">#VSCode</figcaption></figure></p>\n\n<p>我的开发主要语言 Python， 偶尔写一些页面， 包括 Vue.js 和 jQuery 页面.</p>\n\n<p>以下为通用设置</p>\n<figure id="codec93def1f095cc03a3f78989912c2d2ac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">{</span>\n    <span class="s2">&quot;files.exclude&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;**/.git&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.svn&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.hg&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/*.pyc&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.DS_Store&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/__pycache__&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/node_modules&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="p">},</span>\n    <span class="s2">&quot;window.zoomLevel&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>\n    <span class="s2">&quot;editor.letterSpacing&quot;</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>\n    <span class="s2">&quot;workbench.activityBar.visible&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;workbench.colorTheme&quot;</span><span class="o">:</span> <span class="s2">&quot;Solarized Dark&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>\n    <span class="c1">// Python</span>\n    <span class="s2">&quot;python.venvPath&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.virtualenvs&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.enabled&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.pylintEnabled&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.pep8Enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>\n    <span class="s2">&quot;python.analysis.logLevel&quot;</span><span class="o">:</span> <span class="s2">&quot;Warning&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;python.dataScience.sendSelectionToInteractiveWindow&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="c1">// Python</span>\n    <span class="s2">&quot;[python]&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;editor.rulers&quot;</span><span class="o">:</span> <span class="p">[</span>\n            <span class="mi">72</span><span class="p">,</span>\n            <span class="mi">79</span>\n        <span class="p">],</span>\n        <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>\n        <span class="s2">&quot;editor.insertSpaces&quot;</span><span class="o">:</span> <span class="kc">true</span>\n    <span class="p">},</span>\n    <span class="c1">// JS</span>\n    <span class="s2">&quot;[javascript]&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">2</span>\n    <span class="p">},</span>\n    <span class="s2">&quot;html.format.enable&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec93def1f095cc03a3f78989912c2d2ac"><\\>Js</a></figcaption></figure>\n<p>除了以上的通用设置， 我还会在每个项目中定义虚拟环境位置。 在项目的目录下在 <code>.vscode/settings.json</code></p>\n\n<p>一般通过 <code>Python: Select Interpreter</code> 选择虚拟环境解析器自动创建， 其他的关于此项目的配置也都在这个文件， 但通用环境的配置够用，一般也没有其他的配置.</p>\n<figure id="code0b727d3be7c4c145440a8e9e8237aca5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">{</span>\n    <span class="nt">&quot;python.pythonPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/virtualenv/bin/python&quot;</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code0b727d3be7c4c145440a8e9e8237aca5"><\\>Json</a></figcaption></figure>', 'links': [['VSCode', 'https://code.visualstudio.com/', '微软开发的开源代码编辑器.']], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('个人项目', [{'filename': 'jianshuhot', 'title': 'Scrapy抓取简书热门生成电子书发送到Kindle', 'date': datetime.datetime(2016, 1, 14, 16, 31, 14), 'cover': None, 'set': '个人项目', 'content': '<p><a href="http://www.jianshu.com">简书</a>是个学习的好网站， 我大多只关注首页上的人们文章， 但是最近因为忙错过了很多首页上的文章，所以有了想法把每天的热门top生成mobi推送到kindle。这样在地铁上也能快速翻完. </p>\n\n<p>环境准备:</p>\n\n<ul>\n<li>一台主机(需要联网)</li>\n<li>Gitbook</li>\n<li>calibre(Gitbook 依赖calibre的<code>ebook-convert</code>)</li>\n<li>Python2.7.9(calibre 需要<code>python2.7.9</code>)</li>\n<li>项目地址:  <strong><a href="https://github.com/jackeyGao/jianshuHot">jianshuHot</a></strong></li>\n</ul>\n<h2 id="关于calibre安装">关于calibre安装</h2><figure id="code91781e99d515fb35ac3df70b7afac4cd" class="code-wrapper"><div class="highlight"><pre><span></span>sudo -v <span class="o">&amp;&amp;</span> wget -nv -O- https://raw.githubusercontent.com/kovidgoyal/calibre/master/setup/linux-installer.py <span class="p">|</span> sudo python -c <span class="s2">&quot;import sys; main=lambda:sys.stderr.write(&#39;Download failed\\n&#39;); exec(sys.stdin.read()); main()&quot;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code91781e99d515fb35ac3df70b7afac4cd"><\\>Bash</a></figcaption></figure>\n<p>官网文档提供的安装脚本看似简单， 执行之后也可以安装使用了， 但是gitbook调用<code>ebook-convert</code>时候会报错， 这个地方报错应该是QT的错误(至少我遇到的是, 具体错误信息忘记截图了)如果遇到此错误直接安装QT pyQT即可. <a href="http://calibre-ebook.com/download_linux">calibre 安装页面</a>有依赖表</p>\n<h2 id="Gitbook 安装">Gitbook 安装</h2>\n<p>需要安装<code>nodejs</code>和<code>npm</code>然后执行<code>npm install -g gitbook-cli</code></p>\n<h2 id="安装jianshuHot">安装jianshuHot</h2>\n<p>需要强调的是此部分需要解决大量的依赖,</p>\n\n<p><strong><code>scrapy</code></strong>所依赖的python包很多， 而且这些依赖的python大多需要一些系统库， 必要的时候需要<code>apt-get</code>、<code>yum</code>安装一下, 如<code>python-devel</code> <code>libffi-devel</code> <code>libxml-devel</code>等....</p>\n\n<p><strong><code>peewee</code></strong> (数据库ORM)要<code>mysql-devel</code>， 以上举例都是已知的， 这是在我部署之后写的， 部署的过程没有详细记录， 现在只能靠回忆来写本章节.</p>\n<figure id="code45676c2f6c4bcde600165a39e7a576b1" class="code-wrapper"><div class="highlight"><pre><span></span>$ git clone https://github.com/jackeyGao/jianshuHot\n$ <span class="nb">cd</span> jianshuHot\n$ pip install -r requirements.txt\n</pre></div>\n<figcaption><a class="lang-label" href="#code45676c2f6c4bcde600165a39e7a576b1"><\\>Bash</a></figcaption></figure><h2 id="初始化程序">初始化程序</h2><figure id="codeea0fdd4cb793c6733450c3f4d6d3055f" class="code-wrapper"><div class="highlight"><pre><span></span>$ sh init.sh\n</pre></div>\n<figcaption><a class="lang-label" href="#codeea0fdd4cb793c6733450c3f4d6d3055f"><\\>Bash</a></figcaption></figure><h2 id="邮件配置">邮件配置</h2>\n<p>这里发送邮件使用的<a href="http://caspian.dotconf.net/menu/Software/SendEmail/">sendEmail</a>, <a href="http://caspian.dotconf.net/menu/Software/SendEmail/">下载地址</a> . 解压后把解压的<code>sendEmail</code>重命名到<code>/usr/local/bin/sendEmail</code>理论上都能安装成功， 这个是免编译的， 只需要机器上安装了<code>perl</code></p>\n\n<p>然后修改start.sh 邮箱配置， 写成你自己163邮箱， 也可以用其他品牌邮箱， 如果你用其他品牌别忘了改下<code>smtp.163.com</code>, 改成相应的smtp服务器即可.</p>\n\n<p><strong>注意:</strong> 无论你用哪个邮箱都必须把此邮箱账号加入亚马逊<strong><code>已认可的发件人电子邮箱列表</code></strong>， 确保发送的文档能到达亚马逊Cloud</p>\n<figure id="codebe61db7b4ce4c51b62b617b5f80823d8" class="code-wrapper"><div class="highlight"><pre><span></span>$ vim start.sh\n....\n<span class="nv">YOURKINDLE_MAIL_ADDRESS</span><span class="o">=</span><span class="s2">&quot;xxxxx@kindle.cn&quot;</span>\n<span class="nv">YOUR_SEND_MAIL_USERNAME</span><span class="o">=</span><span class="s2">&quot;xxxx@163.com&quot;</span>\n<span class="nv">YOUR_SEND_MAIL_SECRET</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxx&#39;</span>\n<span class="nv">MOBI_BOOK_PATH</span><span class="o">=</span><span class="s1">&#39;./output/book.mobi&#39;</span>\n...\n</pre></div>\n<figcaption><a class="lang-label" href="#codebe61db7b4ce4c51b62b617b5f80823d8"><\\>Bash</a></figcaption></figure><h2 id="开始抓取生成">开始抓取生成</h2><figure id="codea06e1315dee417aa7b6e866e6eb380c1" class="code-wrapper"><div class="highlight"><pre><span></span>$ sh start.sh\n</pre></div>\n<figcaption><a class="lang-label" href="#codea06e1315dee417aa7b6e866e6eb380c1"><\\>Bash</a></figcaption></figure>\n<p>执行后会自动抓取页面生成markdown， 下载每个文章的图片， 然后gitbook通过markdown生成此次文档列表的<code>book.mobi</code> (output/book.mobi), 在start.sh 最后面有个备份的操作， 会把此次的mobi备份到<code>output/books</code>. 然后发送到指定的kindle地址邮箱.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'use-vuejs-and-semantic-ui-todolist', 'title': '使用Vue.js 和 semantic-ui 的一个简单TODO List', 'date': datetime.datetime(2016, 8, 22, 10, 11, 1), 'cover': None, 'set': '个人项目', 'content': '<blockquote class="blockquote-normal">\n                <p>项目地址: <strong><a href="https://github.com/jackeyGao/vue-semantic-todos">jackeyGao/vue-semantic-todos</a></strong></p></blockquote>\n<p>这是一个完全仿照官网案例的项目, 主要为了熟悉vue.js的基本用法, 不得不说这个案例能吸收到基本的vue.js 操作. </p>\n\n<p>根据重写此项目可以学到下面几个知识点:</p>\n\n<ul>\n<li>基本的数据绑定语法</li>\n<li>计算属性</li>\n<li>Class 绑定</li>\n<li>条件渲染</li>\n<li>列表渲染</li>\n<li>方法与事件绑定</li>\n<li>表单空间绑定</li>\n<li>自定义指令</li>\n</ul>\n\n<p>额外还能学习到<code>localStorage</code>的简单用法.可以说通过详细学习此例子可以完成vue.js最基本的入门操作， 完全熟悉不太容易， 主要是感受下vue.js的思想，和正确的使用方式, 后面还需要多写多看.</p>\n\n<iframe width="100%" scrolling="no" height="600" src="/projects/vue-semantic-ui-todo-list/index.html" frameborder="0"></iframe>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'crawl-ci', 'title': '全宋词爬取过程及数据分析', 'date': datetime.datetime(2017, 3, 7, 14, 11, 1), 'cover': '/uploads/images/WX20180516-101305@2x.png', 'set': '个人项目', 'content': '<script src="/static/3rd/tagul.min.js" async defer></script>\n\n<style>\n\n.block {\n    padding-bottom: 0 !important;\n}\n\n</style>\n\n<p><figure class="hassubimage hidden"><div class="image"><img src="/uploads/images/WX20180516-101305@2x.png"></div><figcaption class="img-title">#hidden</figcaption></figure>\n由于某个公众号对我仓库<a href="https://github.com/jackeyGao/chinese-poetry">chinese-poetry</a>的推广， 短时间大量涨粉， 有人想要宋词的数据。 于是最近利用零散时间对全宋词进行爬取分析， 并做了简单的分析， 发现了一些不得了的事情。</p>\n\n<p>分析仅仅对全宋词的内容进行了关键字排名分析、 宋词作者产量分析、 最受欢迎的词牌名排名分析</p>\n<h2 id="关键字排名分析">关键字排名分析</h2>\n<p>宋人喜欢用东风， 东风作为现代也会微妙， 人间、何处从唐诗就开始蝉联前三. 即使到了现代， 这两个词依存古风.</p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/uifp9qxzt4ea" data-tagul-show-attribution></div>\n<h2 id="宋词作者产量分析">宋词作者产量分析</h2>\n<p>辛弃疾果不其然的成为两宋现存词最多的作家, 还有一些虽然产量丰富但未必是我们熟知的。</p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/hs8hgxlpmo29" data-tagul-show-attribution></div>\n<h2 id="最受欢迎的词牌名排名分析">最受欢迎的词牌名排名分析</h2>\n<p>浣溪沙作为婉约 豪放两派所常用的词牌， 在两宋时期作为最受欢迎也是理所应当. </p>\n\n<div class="block" style="height: 400px;" data-tagul-src="/static/data/xb019pkh27dn" data-tagul-show-attribution></div>\n\n<p>爬取逻辑没有做相应的系统化处理， 只是简单的脚本， 配置交互式界面做的操作。采用的相关技术: Python + parsel + peewee + requests + jieba</p>\n\n<p>附上爬取解析脚本的逻辑:</p>\n\n<div class="gist">\n<script src="https://gist.github.com/jackeyGao/d73381087b1278177aab60636f635119.js"></script>\n</div>\n\n<div class="gist">\n<script src="https://gist.github.com/jackeyGao/6a68100a0298895c6ef92869669a12c2.js"></script>\n</div>\n<h2 id="运行">运行</h2>\n<p>分别保存上面两个脚本为<strong>parse.py</strong>和<strong>db.py</strong>, 然后执行以下命令</p>\n<figure id="codec19f2fb72fbe7c732bce186cf7cf4105" class="code-wrapper"><div class="highlight"><pre><span></span>$ pip install peewee parsel requests\n$ python db.py <span class="c1"># 初始化数据库</span>\n$ python parse.py\n</pre></div>\n<figcaption><a class="lang-label" href="#codec19f2fb72fbe7c732bce186cf7cf4105"><\\>Bash</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'ngraph', 'title': '数据可视化系统NGraph', 'date': datetime.datetime(2017, 3, 13, 17, 30, 1), 'cover': None, 'set': '个人项目', 'content': '<p>去年重写了报表系统并为之取名为NGraph, 目的是做一套可以通过API提交数据来生成可视化数据的系统。</p>\n\n<p>此系统第一版本只有报表项目， NGraph加入了监控报表的概念， 来区分报表项目， 并且优先级大于报表项目。 同时还有数据导出的工具. 报表目前支持table和pie.</p>\n<h1 id="相关功能截图">相关功能截图</h1>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-dashboard.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-monitor.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-database.png"></div></figure></p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/ngraph/ngraph-pie.png"></div></figure></p>\n\n<p>其实很想把此项目完善下并开源， 但是觉得功能有点少， 而且目前有Grafana这样的开源系统， 开源的计划也就停止了.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'hawkeye', 'title': '多监控平台统一 | Hawkeye', 'date': datetime.datetime(2018, 3, 27, 10, 1, 11), 'cover': None, 'set': '个人项目', 'content': '<p>近年来出现越来越多的监控平台， 每一个监控平台都是其擅长的地方， 比方说 zabbix 监控收集， 并监控基础服务。 grafana 监控平台可以很好的展示数据， kibana 又是日志相关的监控， 可以很出色的自定义很多业务监控。 总而言之基本上大多数有一定技术规模的公司， 运维都有很多监控平台。</p>\n\n<p>多监控平台虽然好， 但暴露一个问题, 那就是关注度低， 因为有时候祸绝不单行， 一个问题的爆发， 往往在底层或者高层就已经暴露出来, 而我们需要来回的切换各个平台的监控图表， 这样排查起来非常慢。 如果我们能够更立体的看全部的监控报表， 那么暴露的问题也就一目了然了。</p>\n\n<p>我进入 teambition 刚开始就是在做多监控平台统一的事情， 当时想的是把所有的数据全部写到一个平台， 而后通过结构化数据统一生成图表。 但构思太大， 实现起来艰难。 于是此项目难产了。</p>\n\n<p>现在用的是嵌入的方式，幸运的是 zabbix、grafana、kibana 都支持嵌入， 而且每个图表的嵌入都支持start<em>time和 end</em>time, 这使得一个页面大盘看多个平台的监控就非常直观。</p>\n<h2 id="各个平台的嵌入 URL 组成部分.">各个平台的嵌入 URL 组成部分.</h2><h3 id="Zabbix">Zabbix</h3><figcaption id="code3502914b60dd69bc3d9b8daabf3bc3af" class="code-wrapper">\n<div class="highlight"><pre>http://HOST:PORT/chart2.php?graphid=1911&period=1800&stime=20190309095657&updateProfile=1&profileIdx=web.screens&profileIdx2=1911&width=1302</pre><figcaption><a href="#code3502914b60dd69bc3d9b8daabf3bc3af" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<h3 id="Grafana">Grafana</h3><figcaption id="code79ed0cf364d7c1af4cdd048e8f006099" class="code-wrapper">\n<div class="highlight"><pre>https://grafana.teambition.net/dashboard-solo/db/cpu-overview?orgId=1&panelId=5&from=1520540867986&to=1520562467987</pre><figcaption><a href="#code79ed0cf364d7c1af4cdd048e8f006099" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n<h3 id="Kibana">Kibana</h3><figcaption id="codefcd109a1075a91253843570654ac0bc1" class="code-wrapper">\n<div class="highlight"><pre>https://elk.teambition.net/app/kibana#/visualize/edit/API-response-time-(avg)?embed=true&_g=()&_a=(filters:!(),linked:!f,query:(query_string:(analyze_wildcard:!t,query:\'*\')),uiState:(),vis:(aggs:!((enabled:!t,id:\'1\',params:(field:req_time),schema:metric,type:avg),(enabled:!t,id:\'2\',params:(customInterval:\'2h\',extended_bounds:(),field:timestamp,interval:auto,min_doc_count:1),schema:segment,type:date_histogram)),listeners:(),params:(addLegend:!t,addTimeMarker:!f,addTooltip:!t,categoryAxes:!((id:CategoryAxis-1,labels:(show:!t,truncate:100),position:bottom,scale:(type:linear),show:!t,style:(),title:(),type:category)),defaultYExtents:!f,grid:(categoryLines:!f,style:(color:%23eee)),interpolate:linear,legendPosition:right,mode:stacked,scale:linear,seriesParams:!((data:(id:\'1\',label:Count),drawLinesBetweenPoints:!t,interpolate:linear,mode:stacked,show:true,showCircles:!t,type:area,valueAxis:ValueAxis-1)),setYExtents:!f,shareYAxis:!t,smoothLines:!f,times:!(),valueAxes:!((id:ValueAxis-1,labels:(filter:!f,rotate:0,show:!t,truncate:100),name:LeftAxis-1,position:left,scale:(mode:normal,type:linear),show:!t,style:(),title:(text:Count),type:value)),yAxis:()),title:\'API+response+time+(avg)\',type:area))</pre><figcaption><a href="#codefcd109a1075a91253843570654ac0bc1" class="lang-label"><\\>text</a></figcaption></div></figcaption>\n\n<p>可以看到三个平台支持开始时间和结束时间， 这方便了我们 hawkeye 平台的时间选择控制。</p>\n<h2 id="核心处理URL代码">核心处理URL代码</h2>\n<p>根据所指定的开始时间和结束时间， 对各个平台的 url 进行处理。 最后生成 url。</p>\n<figure id="coded665a9fd78152633234f53563816d5e3" class="code-wrapper"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reload_url</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>\n    <span class="n">s_cst</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">28800000</span>\n    <span class="n">e_cst</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">28800000</span>\n    <span class="n">zabbix</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;stime&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">s_cst</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">),</span>\n        <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>\n        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="s2">&quot;600&quot;</span>\n    <span class="p">}</span>\n\n    <span class="n">grafana</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">e</span> <span class="p">}</span>\n\n    <span class="n">kibana</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%s</span><span class="s2">Z&quot;</span><span class="p">),</span>\n        <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">e</span><span class="o">/</span><span class="mf">1000.0</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S.</span><span class="si">%s</span><span class="s2">Z&quot;</span><span class="p">),</span>\n    <span class="p">}</span>\n\n    <span class="n">kibana</span> <span class="o">=</span> <span class="p">{</span>\n        <span class="s2">&quot;_g&quot;</span><span class="p">:</span> <span class="s2">&quot;(refreshInterval:(display:On,pause:!f,value:0),&quot;</span> <span class="o">+</span> \\\n        <span class="s2">&quot;time:(from:&#39;</span><span class="si">%s</span><span class="s2">&#39;,mode:absolute,to:&#39;</span><span class="si">%s</span><span class="s2">&#39;))&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kibana</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">],</span> <span class="n">kibana</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">])</span>\n    <span class="p">}</span>\n\n    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>\n        <span class="n">r</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>\n        <span class="n">root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">://</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">netloc</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">r</span> <span class="o">=</span> <span class="n">urlsplit</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fragment</span><span class="p">)</span>\n\n        <span class="n">query_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ZB&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">zabbix</span><span class="p">)</span>\n        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;GF&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grafana</span><span class="p">)</span>\n        <span class="k">elif</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">query_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kibana</span><span class="p">)</span>\n\n        <span class="n">query_string</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">query_dict</span><span class="p">)</span>\n\n        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;KB&#39;</span><span class="p">:</span>\n            <span class="n">full_url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">query_string</span>\n        <span class="k">else</span><span class="p">:</span>\n            <span class="n">full_url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="n">query_string</span>\n\n        <span class="n">item</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">full_url</span>\n    <span class="k">return</span> <span class="n">items</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded665a9fd78152633234f53563816d5e3"><\\>Python</a></figcaption></figure><h2 id="项目效果图">项目效果图</h2>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/hawkeye-overview.png"></div><figcaption class="img-title">#大盘</figcaption></figure>\n<figure class="hassubimage"><div class="image"><img src="/uploads/images/hawkeye-control.png"></div><figcaption class="img-title">#控制</figcaption></figure></p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'my-vscode-global-settings', 'title': '我的 VSCode 配置', 'date': datetime.datetime(2019, 7, 24, 9, 35, 48), 'cover': '/uploads/images/vscode.png', 'set': '个人项目', 'content': '<p>Python 程序员应该首要使用免费的 <a href="https://code.visualstudio.com/" title="微软开发的开源代码编辑器.">VSCode</a> <sup>[1]</sup> 编辑器.</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/vscode.png"></div><figcaption class="img-title">#VSCode</figcaption></figure></p>\n\n<p>我的开发主要语言 Python， 偶尔写一些页面， 包括 Vue.js 和 jQuery 页面.</p>\n\n<p>以下为通用设置</p>\n<figure id="codec93def1f095cc03a3f78989912c2d2ac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">{</span>\n    <span class="s2">&quot;files.exclude&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;**/.git&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.svn&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.hg&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/*.pyc&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/.DS_Store&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/__pycache__&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n        <span class="s2">&quot;**/node_modules&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="p">},</span>\n    <span class="s2">&quot;window.zoomLevel&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>\n    <span class="s2">&quot;editor.letterSpacing&quot;</span><span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>\n    <span class="s2">&quot;workbench.activityBar.visible&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;workbench.colorTheme&quot;</span><span class="o">:</span> <span class="s2">&quot;Solarized Dark&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>\n    <span class="c1">// Python</span>\n    <span class="s2">&quot;python.venvPath&quot;</span><span class="o">:</span> <span class="s2">&quot;~/.virtualenvs&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.enabled&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.pylintEnabled&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="s2">&quot;python.linting.pep8Enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>\n    <span class="s2">&quot;python.analysis.logLevel&quot;</span><span class="o">:</span> <span class="s2">&quot;Warning&quot;</span><span class="p">,</span>\n    <span class="s2">&quot;python.dataScience.sendSelectionToInteractiveWindow&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>\n    <span class="c1">// Python</span>\n    <span class="s2">&quot;[python]&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;editor.rulers&quot;</span><span class="o">:</span> <span class="p">[</span>\n            <span class="mi">72</span><span class="p">,</span>\n            <span class="mi">79</span>\n        <span class="p">],</span>\n        <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>\n        <span class="s2">&quot;editor.insertSpaces&quot;</span><span class="o">:</span> <span class="kc">true</span>\n    <span class="p">},</span>\n    <span class="c1">// JS</span>\n    <span class="s2">&quot;[javascript]&quot;</span><span class="o">:</span> <span class="p">{</span>\n        <span class="s2">&quot;editor.tabSize&quot;</span><span class="o">:</span> <span class="mi">2</span>\n    <span class="p">},</span>\n    <span class="s2">&quot;html.format.enable&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec93def1f095cc03a3f78989912c2d2ac"><\\>Js</a></figcaption></figure>\n<p>除了以上的通用设置， 我还会在每个项目中定义虚拟环境位置。 在项目的目录下在 <code>.vscode/settings.json</code></p>\n\n<p>一般通过 <code>Python: Select Interpreter</code> 选择虚拟环境解析器自动创建， 其他的关于此项目的配置也都在这个文件， 但通用环境的配置够用，一般也没有其他的配置.</p>\n<figure id="code0b727d3be7c4c145440a8e9e8237aca5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="p">{</span>\n    <span class="nt">&quot;python.pythonPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/path/to/virtualenv/bin/python&quot;</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code0b727d3be7c4c145440a8e9e8237aca5"><\\>Json</a></figcaption></figure>', 'links': [['VSCode', 'https://code.visualstudio.com/', '微软开发的开源代码编辑器.']], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#('好玩的Django', [{'filename': 'django-a-minimal-application', 'title': '一个超级小的 Django 项目.', 'date': datetime.datetime(2018, 11, 12, 13, 40), 'cover': '/uploads/images/a-minimal-application.jpeg', 'set': '好玩的Django', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/a-minimal-application.jpeg"></div></figure></p>\n\n<p>Django 可以支持类似于Flask 一样的单文件项目.</p>\n\n<p>当用最简单的代码实现 Django 项目为最基本的要素的时候， 项目可以和微框架一样小.</p>\n\n<p>但我建议， 最好不要这样做， 因为在选择使用 Django 的时候， 我比较看重的 Django 封装的一系列模块， 我更建议用 Django 官方提供的架构去开始我的工程。</p>\n<h2 id="Introduction">Introduction</h2>\n<p>首先我们知道， 在我们安装 Django 之后， Django 和其他 Python 包一样， 在<strong>site-packages</strong>里面, 这意味着 Django 和其他的 Python 包一样(<a href="http://www.python-requests.org/en/master/">Requests</a>, <a href="https://python-pillow.org/">Pillow</a>, <a href="http://www.numpy.org/">NumPy</a>).</p>\n\n<p>验证 Django 是否安装最简单的方法是到交互式界面导入它</p>\n<figure id="code2e61531e9dc17cfa45b1dd3891136585" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">django</span>\n<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">get_version</span><span class="p">())</span>\n<span class="mf">1.11</span><span class="o">.</span><span class="mi">4</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2e61531e9dc17cfa45b1dd3891136585"><\\>Python</a></figcaption></figure>\n<p>但是我们使用 Django 和使用其他包不一样， 在官方推荐的例子下， 我们开始一个项目首先执行的是<strong>startproject</strong></p>\n\n<p>我们执行后， 会初始化创建默认的项目目录结构:</p>\n\n<ul>\n<li>manage.py</li>\n<li>settings.py</li>\n<li>urls.py</li>\n<li>wsgi.py</li>\n</ul>\n\n<p>这就是常用的预配置</p>\n\n<p>加入我们要做一个 web 项目， 你可能需要数据库， 处理用户的身份验证， 和会话等功能。 <code>startproject</code>会让我们对这些的处理和配置更加轻松. 而且 Django 默认就提供这些功能， 这让我们能够直接引用.</p>\n\n<p>但这样不是开始项目的唯一方式， 这也是本章的目的。</p>\n<h2 id="最小的 Django 程序">最小的 Django 程序</h2>\n<p><strong>app.py</strong></p>\n<figure id="code2a18b47ff73d5eb4e87f6e926a255e12" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>\n\n<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>\n<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>\n<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>\n\n<span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>\n    <span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>\n    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;A-random-secret-key!&#39;</span><span class="p">,</span>\n    <span class="n">ROOT_URLCONF</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span>\n<span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;A minimal Django response!&lt;/h1&gt;&#39;</span><span class="p">)</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>\n<span class="p">]</span>\n\n<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>\n    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2a18b47ff73d5eb4e87f6e926a255e12"><\\>Python</a></figcaption></figure>\n<p><strong>SECRET_KEY</strong>是我们必须要提供的一个参数, DEBUG默认是 False, 没有开启 DEBUG 的情况需要定义<strong>ALLOWED_HOSTS</strong>配置, 所以我们直接覆盖 DEBUG 为 True.  <strong>ROOT_URLCONF</strong> 是需要包含 URL 列表的特殊模块路径. 其实就是我们项目的urls.py文件.  在这里我们写到一个文件里面了， 所以我们直接定义<code>sys.modules[__name__]</code>表示当前模块, 并在当前文件下面定义<strong>urlpatterns</strong>列表, 定义的方式和urls.py一样和视图view对应起来.</p>\n\n<p>然后通过<code>execute_from_command_line</code>快捷方式启动， 这个保留了 manage.py 命令的功能.</p>\n<h2 id="使用">使用</h2>\n<p>由于没有其他的APP 在 <strong>INSTALLED_APPS</strong>里面, 默认情况下只有 django 项目. 所以只有一些最基本的命令功能.</p>\n<figure id="code3ceaf06901ec121c2545bf1d8ba136f7" class="code-wrapper"><div class="highlight"><pre><span></span>$ python app.py\n\nType <span class="s1">&#39;app.py help &lt;subcommand&gt;&#39;</span> <span class="k">for</span> <span class="nb">help</span> on a specific subcommand.\n\nAvailable subcommands:\n\n<span class="o">[</span>django<span class="o">]</span>\n    check\n    compilemessages\n    createcachetable\n    dbshell\n    diffsettings\n    dumpdata\n    flush\n    inspectdb\n    loaddata\n    makemessages\n    makemigrations\n    migrate\n    runserver\n    sendtestemail\n    shell\n    showmigrations\n    sqlflush\n    sqlmigrate\n    sqlsequencereset\n    squashmigrations\n    startapp\n    startproject\n    <span class="nb">test</span>\n    testserver\n</pre></div>\n<figcaption><a class="lang-label" href="#code3ceaf06901ec121c2545bf1d8ba136f7"><\\>Shell</a></figcaption></figure><h2 id="启动">启动</h2>\n<p>我们使用 runserver 把程序启动</p>\n<figure id="codecfa276ae99a4b792ffbacd1260ef143b" class="code-wrapper"><div class="highlight"><pre><span></span>$ python app.py runserver\n</pre></div>\n<figcaption><a class="lang-label" href="#codecfa276ae99a4b792ffbacd1260ef143b"><\\>Shell</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-exploring-utils', 'title': '探索Django utils', 'date': datetime.datetime(2018, 11, 16, 14, 36, 42), 'cover': '/uploads/images/exploring-utils.jpeg', 'set': '好玩的Django', 'content': '<p>Django utils 提供了很多实用的功能.</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/exploring-utils.jpeg"></div></figure></p>\n<h2 id="Crypto">Crypto</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.crypto</strong></p></blockquote>\n<p><strong>get_random_string</strong></p>\n\n<p>获取随机字符串函数， 默认是返回长度为12的随机字符串。 可以通过参数传递长度.</p>\n<figure id="code363267526067f7a15fb363c3b88b1f31" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.crypto</span> <span class="kn">import</span> <span class="n">get_random_string</span>\n\n<span class="n">get_random_string</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code363267526067f7a15fb363c3b88b1f31"><\\>Python</a></figcaption></figure><figure id="code7ffc0cfd8137d21fcc716f41712d7084" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;5QxAxqyhsyJM&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code7ffc0cfd8137d21fcc716f41712d7084"><\\>Python</a></figcaption></figure>\n<p>你可以传递参数， 获取指定长度的字符串</p>\n<figure id="code659a7e4bd5189018b3ef462e41da4ed9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">get_random_string</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code659a7e4bd5189018b3ef462e41da4ed9"><\\>Python</a></figcaption></figure><figure id="code1980f2dda16df3078cec642c7b377d38" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;lrWYnyxhnXpwmjHDzmdgTFaIi1j73cKD5fPDOPwuVBmmKxITYF&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code1980f2dda16df3078cec642c7b377d38"><\\>Python</a></figcaption></figure>\n<p>也可以指定字符串的选值范围</p>\n<figure id="coded7c908f3ee63d2187f47ec16e0e4e6c8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">get_random_string</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded7c908f3ee63d2187f47ec16e0e4e6c8"><\\>Python</a></figcaption></figure><figure id="code440d950ddd2da3170a9d77469f8ba98e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;805379737758&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code440d950ddd2da3170a9d77469f8ba98e"><\\>Python</a></figcaption></figure><h2 id="Dates">Dates</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dates</strong></p></blockquote>\n<p>常用日期的集合， 日期的人性化显示.</p>\n\n<p><strong>WEEKDAYS</strong></p>\n<figure id="code646d49c6c65eb6bacbc77eae5d727a81" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">WEEKDAYS</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code646d49c6c65eb6bacbc77eae5d727a81"><\\>Python</a></figcaption></figure><figure id="code8cef5aef4a5ad0e59310ea679cf2dded" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">WEEKDAYS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">0</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Monday&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Thursday&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Friday&#39;</span><span class="p">),</span>\n    <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Saturday&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sunday&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8cef5aef4a5ad0e59310ea679cf2dded"><\\>Python</a></figcaption></figure>\n<p><strong>WEEKDAYS_ABBR</strong></p>\n<figure id="code2b4c4fa16c1e922db84eb58036fd0817" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">WEEKDAYS_ABBR</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2b4c4fa16c1e922db84eb58036fd0817"><\\>Python</a></figcaption></figure><figure id="code3efe1e53c6480a96cfa740ead96aa024" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">WEEKDAYS_ABBR</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">0</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Mon&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Tue&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Wed&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Thu&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Fri&#39;</span><span class="p">),</span>\n    <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sat&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sun&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3efe1e53c6480a96cfa740ead96aa024"><\\>Python</a></figcaption></figure>\n<p><strong>MONTHS</strong></p>\n<figure id="codec15f7b587f3ca4de2c82b5f0afcf813f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">MONTHS</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec15f7b587f3ca4de2c82b5f0afcf813f"><\\>Python</a></figcaption></figure><figure id="code522bb51f1be5b50100de8cf6f508acf5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MONTHS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;January&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;February&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;March&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;April&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;May&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;June&#39;</span><span class="p">),</span>\n    <span class="mi">7</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;July&#39;</span><span class="p">),</span> <span class="mi">8</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;August&#39;</span><span class="p">),</span> <span class="mi">9</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;September&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;October&#39;</span><span class="p">),</span> <span class="mi">11</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;November&#39;</span><span class="p">),</span>\n    <span class="mi">12</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;December&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code522bb51f1be5b50100de8cf6f508acf5"><\\>Python</a></figcaption></figure><h2 id="DateFormat">DateFormat</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dateformat</strong></p></blockquote>\n<p>一个很棒的日期格式化模块</p>\n\n<p><strong>format</strong></p>\n<figure id="code021ef3b2923f0173169a24058a876704" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateformat</span> <span class="kn">import</span> <span class="n">format</span>\n<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>\n\n<span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>    <span class="c1"># datetime.datetime(2018, 11, 16, 6, 48, 41, 351928, tzinfo=&lt;UTC&gt;)</span>\n<span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;d M Y&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code021ef3b2923f0173169a24058a876704"><\\>Python</a></figcaption></figure><figure id="codea6d7e97db64d7a6459ca93cfc3d4ff02" class="code-wrapper"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;16 Nov 2018&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codea6d7e97db64d7a6459ca93cfc3d4ff02"><\\>Python</a></figcaption></figure>\n<p><strong>日期和时间一起</strong></p>\n<figure id="codef8814e55d9c3df081ae6694185e9151f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;d/m/Y H:i&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef8814e55d9c3df081ae6694185e9151f"><\\>Python</a></figcaption></figure><figure id="code954a0050d5b0ae7e09195a351d84ae8f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;16/11/2018 06:48&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code954a0050d5b0ae7e09195a351d84ae8f"><\\>Python</a></figcaption></figure><h2 id="DateParse">DateParse</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dateparse</strong></p></blockquote>\n<p>将格式化后的字符串转为 date/time/datetime 对象. 如果字符串格式正确， 但表示无效时间将会返回 <strong>None</strong>.</p>\n\n<p><strong>parse_date</strong></p>\n<figure id="code80f08c25d5a5e11494613b9173731b4e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_date</span>\n\n<span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;2018-11-16&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code80f08c25d5a5e11494613b9173731b4e"><\\>Python</a></figcaption></figure><figure id="codee18e747ac4ad396c4eb388bdb466ea42" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codee18e747ac4ad396c4eb388bdb466ea42"><\\>Python</a></figcaption></figure>\n<p><strong>parse_time</strong></p>\n<figure id="code1e8a4e563d4bdd31caae37da76512e42" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_time</span>\n\n<span class="n">parse_time</span><span class="p">(</span><span class="s1">&#39;14:54:02&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1e8a4e563d4bdd31caae37da76512e42"><\\>Python</a></figcaption></figure><figure id="code8b93bacfa3a74ac3468e2420af5de802" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code8b93bacfa3a74ac3468e2420af5de802"><\\>Python</a></figcaption></figure>\n<p><strong>parse_datetime</strong></p>\n<figure id="codeb985f856dd0e3473344f5b9188b38bbd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_datetime</span>\n\n<span class="n">parse_datetime</span><span class="p">(</span><span class="s1">&#39;2018-11-16 14:54:02&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb985f856dd0e3473344f5b9188b38bbd"><\\>Python</a></figcaption></figure><figure id="codeb366ade05030ddc0fc1d7ddcfad2faac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeb366ade05030ddc0fc1d7ddcfad2faac"><\\>Python</a></figcaption></figure><h2 id="HTML">HTML</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.html</strong></p></blockquote>\n<p><strong>urlize</strong></p>\n\n<p>将文本中的网址转换为&lt;a&gt;标签</p>\n<figure id="codeafcba638395ffd6e26a7f70fdb7484ec" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">urlize</span>\n\n<span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;You guys should visit this website www.google.com&#39;</span><span class="p">)</span>\n<span class="k">print</span> <span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Please visit:  https://jackeygao.io&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeafcba638395ffd6e26a7f70fdb7484ec"><\\>Python</a></figcaption></figure><figure id="code16812188ca1240a9eb5389fa55a0a464" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;You guys should visit this website &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&#39;</span>\n<span class="n">Please</span> <span class="n">visit</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://jackeygao.io&quot;</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jackeygao</span><span class="o">.</span><span class="n">io</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code16812188ca1240a9eb5389fa55a0a464"><\\>Python</a></figcaption></figure>\n<p>他也适用于email地址</p>\n<figure id="codee32cd2eae7bf259c5ea88993e780a957" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Send me a message to gaojunqi@outlook.com&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee32cd2eae7bf259c5ea88993e780a957"><\\>Python</a></figcaption></figure><figure id="codeee9a300a91fb283311bc56489ecc7249" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;Send me a message to &lt;a href=&quot;mailto:gaojunqi@outlook.com&quot;&gt;gaojunqi@outlook.com&lt;/a&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeee9a300a91fb283311bc56489ecc7249"><\\>Python</a></figcaption></figure>\n<p>你也可以修剪链接显示部分长度, 不足处以&#39;...&#39;替代</p>\n<figure id="code7f53704bac8c0662e11515ea96425371" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Please visit https://jackeygao.io/words/django-exploring-utils.html&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7f53704bac8c0662e11515ea96425371"><\\>Python</a></figcaption></figure><figure id="codeafc3b066fc1d6634aa410b4280a613a5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Please</span> <span class="n">visit</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://jackeygao.io/words/django-exploring-utils.html&quot;</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jackeygao</span><span class="o">.</span><span class="n">io</span><span class="o">/...&lt;/</span><span class="n">a</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeafc3b066fc1d6634aa410b4280a613a5"><\\>Python</a></figcaption></figure>\n<p><strong>escape</strong></p>\n\n<p>对html 特殊字符编码</p>\n<figure id="codea1078f3ef34f74538bb07ce29c806f5e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">escape</span>\n\n<span class="n">escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong style=&#39;font-size: 12px&#39;&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea1078f3ef34f74538bb07ce29c806f5e"><\\>Python</a></figcaption></figure><figure id="code6dd6d6e94148da55eddc930e2da72ad2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&amp;lt;strong style=&amp;#39;font-size: 12px&amp;#39;&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code6dd6d6e94148da55eddc930e2da72ad2"><\\>Python</a></figcaption></figure>\n<p>这将导致已转义的字符串再次被转义</p>\n<figure id="codeef88e0cf5de05421adab038822f073a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">escaped_html</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n\n<span class="n">escape</span><span class="p">(</span><span class="n">escaped_html</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;amp;lt;strong&amp;amp;gt;escaped html&amp;amp;lt;/strong&amp;amp;gt;&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeef88e0cf5de05421adab038822f073a2"><\\>Python</a></figcaption></figure>\n<p>如果不想这样, 请改用<strong>conditional_escape()</strong></p>\n\n<p><strong>conditional_escape</strong></p>\n<figure id="code9882849fe025fc33647da7e4746f99be" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">escaped_html</span> <span class="o">=</span> <span class="n">conditional_escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n\n<span class="n">conditional_escape</span><span class="p">(</span><span class="n">escaped_html</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9882849fe025fc33647da7e4746f99be"><\\>Python</a></figcaption></figure>\n<p><strong>format_html</strong></p>\n\n<p>此函数类似格式化字符串(str.format()), 因为安全的原因推荐使用<strong>format_html</strong>.</p>\n<figure id="codeb3465535e541bcc8a05a6dbf9700f9d9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>\n\n<span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;alert {}&quot;&gt;{}&lt;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb3465535e541bcc8a05a6dbf9700f9d9"><\\>Python</a></figcaption></figure><figure id="codee8144759e700a308b6621eb48eb286d8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&lt;div class=&quot;alert warning&quot;&gt;Watch out!&lt;/&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codee8144759e700a308b6621eb48eb286d8"><\\>Python</a></figcaption></figure>\n<p>安全的格式化 HTML 代码.</p>\n<figure id="code3b7223e00e3277d471aa1555a2d8dc0e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;alert {}&quot;&gt;{}&lt;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;script&gt;alert(1);&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3b7223e00e3277d471aa1555a2d8dc0e"><\\>Python</a></figcaption></figure><figure id="codeedc558fae9445a8a63bceca85cb836a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&lt;div class=&quot;alert &amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&quot;&gt;Watch out!&lt;/&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeedc558fae9445a8a63bceca85cb836a2"><\\>Python</a></figcaption></figure>\n<p><strong>format_html_join</strong></p>\n\n<p>适用于快速用相同的方式格式化一组列表</p>\n<figure id="code51c661def0e3b80b0d1bfca07ed342f9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;{}&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code51c661def0e3b80b0d1bfca07ed342f9"><\\>Python</a></figcaption></figure><figure id="codeb76b0ca9baf604844b9f69f627267dc7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">a</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\\<span class="n">n</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">b</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\\<span class="n">n</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">c</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeb76b0ca9baf604844b9f69f627267dc7"><\\>Python</a></figcaption></figure>\n<p>另外一个例子</p>\n<figure id="codefc7df5a365213ee049877c73759e4149" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Success message&#39;</span><span class="p">],</span>\n    <span class="p">[</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">],</span>\n    <span class="p">[</span><span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="s1">&#39;Danger!!&#39;</span><span class="p">],</span>\n<span class="p">]</span>\n\n<span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;div class=&quot;alert {0}&quot;&gt;{1}&lt;/div&gt;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefc7df5a365213ee049877c73759e4149"><\\>Python</a></figcaption></figure><figure id="codef2e42f61dcb1047d4063c4d3166b68ba" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert success&quot;</span><span class="o">&gt;</span><span class="n">Success</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert warning&quot;</span><span class="o">&gt;</span><span class="n">Watch</span> <span class="n">out</span><span class="err">!</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert danger&quot;</span><span class="o">&gt;</span><span class="n">Danger</span><span class="err">!!</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codef2e42f61dcb1047d4063c4d3166b68ba"><\\>Python</a></figcaption></figure>\n<p>和表格一起使用, 当然也可以和ul li一起使用.</p>\n<figure id="codef534f56ead65928198fb774fa17ec59a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;tr&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;td&gt;{1}&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>\n                                                            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef534f56ead65928198fb774fa17ec59a"><\\>Python</a></figcaption></figure><figure id="code8e8be20b6bfd76fb648825d0200d0082" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Vitor</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Freitas</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">John</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Duo</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Peter</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Croke</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Elektra</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Moore</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code8e8be20b6bfd76fb648825d0200d0082"><\\>Python</a></figcaption></figure>\n<p><strong>linebreaks</strong></p>\n\n<p>快速将<strong>\\n</strong>转换为&lt;br /&gt;</p>\n<figure id="code200fd6e3f29a9e860a32e57210579a6a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">linebreaks</span>\n\n<span class="n">linebreaks</span><span class="p">(</span><span class="s1">&#39;convert</span><span class="se">\\n</span><span class="s1">into html paragraphs</span><span class="se">\\n</span><span class="s1">test&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code200fd6e3f29a9e860a32e57210579a6a"><\\>Python</a></figcaption></figure><figure id="code92e71fb55c84d388806607d65566a117" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">convert</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="n">into</span> <span class="n">html</span> <span class="n">paragraphs</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code92e71fb55c84d388806607d65566a117"><\\>Python</a></figcaption></figure>\n<p>就是这样， 我希望你也能找到一些有趣的函数， 欢迎通过留言推荐.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('好玩的Django', [{'filename': 'django-a-minimal-application', 'title': '一个超级小的 Django 项目.', 'date': datetime.datetime(2018, 11, 12, 13, 40), 'cover': '/uploads/images/a-minimal-application.jpeg', 'set': '好玩的Django', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/a-minimal-application.jpeg"></div></figure></p>\n\n<p>Django 可以支持类似于Flask 一样的单文件项目.</p>\n\n<p>当用最简单的代码实现 Django 项目为最基本的要素的时候， 项目可以和微框架一样小.</p>\n\n<p>但我建议， 最好不要这样做， 因为在选择使用 Django 的时候， 我比较看重的 Django 封装的一系列模块， 我更建议用 Django 官方提供的架构去开始我的工程。</p>\n<h2 id="Introduction">Introduction</h2>\n<p>首先我们知道， 在我们安装 Django 之后， Django 和其他 Python 包一样， 在<strong>site-packages</strong>里面, 这意味着 Django 和其他的 Python 包一样(<a href="http://www.python-requests.org/en/master/">Requests</a>, <a href="https://python-pillow.org/">Pillow</a>, <a href="http://www.numpy.org/">NumPy</a>).</p>\n\n<p>验证 Django 是否安装最简单的方法是到交互式界面导入它</p>\n<figure id="code2e61531e9dc17cfa45b1dd3891136585" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">django</span>\n<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">django</span><span class="o">.</span><span class="n">get_version</span><span class="p">())</span>\n<span class="mf">1.11</span><span class="o">.</span><span class="mi">4</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2e61531e9dc17cfa45b1dd3891136585"><\\>Python</a></figcaption></figure>\n<p>但是我们使用 Django 和使用其他包不一样， 在官方推荐的例子下， 我们开始一个项目首先执行的是<strong>startproject</strong></p>\n\n<p>我们执行后， 会初始化创建默认的项目目录结构:</p>\n\n<ul>\n<li>manage.py</li>\n<li>settings.py</li>\n<li>urls.py</li>\n<li>wsgi.py</li>\n</ul>\n\n<p>这就是常用的预配置</p>\n\n<p>加入我们要做一个 web 项目， 你可能需要数据库， 处理用户的身份验证， 和会话等功能。 <code>startproject</code>会让我们对这些的处理和配置更加轻松. 而且 Django 默认就提供这些功能， 这让我们能够直接引用.</p>\n\n<p>但这样不是开始项目的唯一方式， 这也是本章的目的。</p>\n<h2 id="最小的 Django 程序">最小的 Django 程序</h2>\n<p><strong>app.py</strong></p>\n<figure id="code2a18b47ff73d5eb4e87f6e926a255e12" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>\n\n<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>\n<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>\n<span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>\n<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>\n\n<span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>\n    <span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>\n    <span class="n">SECRET_KEY</span><span class="o">=</span><span class="s1">&#39;A-random-secret-key!&#39;</span><span class="p">,</span>\n    <span class="n">ROOT_URLCONF</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span>\n<span class="p">)</span>\n\n\n<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>\n    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;A minimal Django response!&lt;/h1&gt;&#39;</span><span class="p">)</span>\n\n<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>\n<span class="p">]</span>\n\n<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>\n    <span class="n">execute_from_command_line</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2a18b47ff73d5eb4e87f6e926a255e12"><\\>Python</a></figcaption></figure>\n<p><strong>SECRET_KEY</strong>是我们必须要提供的一个参数, DEBUG默认是 False, 没有开启 DEBUG 的情况需要定义<strong>ALLOWED_HOSTS</strong>配置, 所以我们直接覆盖 DEBUG 为 True.  <strong>ROOT_URLCONF</strong> 是需要包含 URL 列表的特殊模块路径. 其实就是我们项目的urls.py文件.  在这里我们写到一个文件里面了， 所以我们直接定义<code>sys.modules[__name__]</code>表示当前模块, 并在当前文件下面定义<strong>urlpatterns</strong>列表, 定义的方式和urls.py一样和视图view对应起来.</p>\n\n<p>然后通过<code>execute_from_command_line</code>快捷方式启动， 这个保留了 manage.py 命令的功能.</p>\n<h2 id="使用">使用</h2>\n<p>由于没有其他的APP 在 <strong>INSTALLED_APPS</strong>里面, 默认情况下只有 django 项目. 所以只有一些最基本的命令功能.</p>\n<figure id="code3ceaf06901ec121c2545bf1d8ba136f7" class="code-wrapper"><div class="highlight"><pre><span></span>$ python app.py\n\nType <span class="s1">&#39;app.py help &lt;subcommand&gt;&#39;</span> <span class="k">for</span> <span class="nb">help</span> on a specific subcommand.\n\nAvailable subcommands:\n\n<span class="o">[</span>django<span class="o">]</span>\n    check\n    compilemessages\n    createcachetable\n    dbshell\n    diffsettings\n    dumpdata\n    flush\n    inspectdb\n    loaddata\n    makemessages\n    makemigrations\n    migrate\n    runserver\n    sendtestemail\n    shell\n    showmigrations\n    sqlflush\n    sqlmigrate\n    sqlsequencereset\n    squashmigrations\n    startapp\n    startproject\n    <span class="nb">test</span>\n    testserver\n</pre></div>\n<figcaption><a class="lang-label" href="#code3ceaf06901ec121c2545bf1d8ba136f7"><\\>Shell</a></figcaption></figure><h2 id="启动">启动</h2>\n<p>我们使用 runserver 把程序启动</p>\n<figure id="codecfa276ae99a4b792ffbacd1260ef143b" class="code-wrapper"><div class="highlight"><pre><span></span>$ python app.py runserver\n</pre></div>\n<figcaption><a class="lang-label" href="#codecfa276ae99a4b792ffbacd1260ef143b"><\\>Shell</a></figcaption></figure>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'django-exploring-utils', 'title': '探索Django utils', 'date': datetime.datetime(2018, 11, 16, 14, 36, 42), 'cover': '/uploads/images/exploring-utils.jpeg', 'set': '好玩的Django', 'content': '<p>Django utils 提供了很多实用的功能.</p>\n\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/exploring-utils.jpeg"></div></figure></p>\n<h2 id="Crypto">Crypto</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.crypto</strong></p></blockquote>\n<p><strong>get_random_string</strong></p>\n\n<p>获取随机字符串函数， 默认是返回长度为12的随机字符串。 可以通过参数传递长度.</p>\n<figure id="code363267526067f7a15fb363c3b88b1f31" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.crypto</span> <span class="kn">import</span> <span class="n">get_random_string</span>\n\n<span class="n">get_random_string</span><span class="p">()</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code363267526067f7a15fb363c3b88b1f31"><\\>Python</a></figcaption></figure><figure id="code7ffc0cfd8137d21fcc716f41712d7084" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;5QxAxqyhsyJM&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code7ffc0cfd8137d21fcc716f41712d7084"><\\>Python</a></figcaption></figure>\n<p>你可以传递参数， 获取指定长度的字符串</p>\n<figure id="code659a7e4bd5189018b3ef462e41da4ed9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">get_random_string</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code659a7e4bd5189018b3ef462e41da4ed9"><\\>Python</a></figcaption></figure><figure id="code1980f2dda16df3078cec642c7b377d38" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;lrWYnyxhnXpwmjHDzmdgTFaIi1j73cKD5fPDOPwuVBmmKxITYF&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code1980f2dda16df3078cec642c7b377d38"><\\>Python</a></figcaption></figure>\n<p>也可以指定字符串的选值范围</p>\n<figure id="coded7c908f3ee63d2187f47ec16e0e4e6c8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">get_random_string</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;0123456789&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#coded7c908f3ee63d2187f47ec16e0e4e6c8"><\\>Python</a></figcaption></figure><figure id="code440d950ddd2da3170a9d77469f8ba98e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;805379737758&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code440d950ddd2da3170a9d77469f8ba98e"><\\>Python</a></figcaption></figure><h2 id="Dates">Dates</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dates</strong></p></blockquote>\n<p>常用日期的集合， 日期的人性化显示.</p>\n\n<p><strong>WEEKDAYS</strong></p>\n<figure id="code646d49c6c65eb6bacbc77eae5d727a81" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">WEEKDAYS</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code646d49c6c65eb6bacbc77eae5d727a81"><\\>Python</a></figcaption></figure><figure id="code8cef5aef4a5ad0e59310ea679cf2dded" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">WEEKDAYS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">0</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Monday&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Thursday&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Friday&#39;</span><span class="p">),</span>\n    <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Saturday&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sunday&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code8cef5aef4a5ad0e59310ea679cf2dded"><\\>Python</a></figcaption></figure>\n<p><strong>WEEKDAYS_ABBR</strong></p>\n<figure id="code2b4c4fa16c1e922db84eb58036fd0817" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">WEEKDAYS_ABBR</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code2b4c4fa16c1e922db84eb58036fd0817"><\\>Python</a></figcaption></figure><figure id="code3efe1e53c6480a96cfa740ead96aa024" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">WEEKDAYS_ABBR</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">0</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Mon&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Tue&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Wed&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Thu&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Fri&#39;</span><span class="p">),</span>\n    <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sat&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Sun&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3efe1e53c6480a96cfa740ead96aa024"><\\>Python</a></figcaption></figure>\n<p><strong>MONTHS</strong></p>\n<figure id="codec15f7b587f3ca4de2c82b5f0afcf813f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dates</span> <span class="kn">import</span> <span class="n">MONTHS</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codec15f7b587f3ca4de2c82b5f0afcf813f"><\\>Python</a></figcaption></figure><figure id="code522bb51f1be5b50100de8cf6f508acf5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">MONTHS</span> <span class="o">=</span> <span class="p">{</span>\n    <span class="mi">1</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;January&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;February&#39;</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;March&#39;</span><span class="p">),</span> <span class="mi">4</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;April&#39;</span><span class="p">),</span> <span class="mi">5</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;May&#39;</span><span class="p">),</span> <span class="mi">6</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;June&#39;</span><span class="p">),</span>\n    <span class="mi">7</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;July&#39;</span><span class="p">),</span> <span class="mi">8</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;August&#39;</span><span class="p">),</span> <span class="mi">9</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;September&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;October&#39;</span><span class="p">),</span> <span class="mi">11</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;November&#39;</span><span class="p">),</span>\n    <span class="mi">12</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;December&#39;</span><span class="p">)</span>\n<span class="p">}</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code522bb51f1be5b50100de8cf6f508acf5"><\\>Python</a></figcaption></figure><h2 id="DateFormat">DateFormat</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dateformat</strong></p></blockquote>\n<p>一个很棒的日期格式化模块</p>\n\n<p><strong>format</strong></p>\n<figure id="code021ef3b2923f0173169a24058a876704" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateformat</span> <span class="kn">import</span> <span class="n">format</span>\n<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>\n\n<span class="n">now</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>    <span class="c1"># datetime.datetime(2018, 11, 16, 6, 48, 41, 351928, tzinfo=&lt;UTC&gt;)</span>\n<span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;d M Y&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code021ef3b2923f0173169a24058a876704"><\\>Python</a></figcaption></figure><figure id="codea6d7e97db64d7a6459ca93cfc3d4ff02" class="code-wrapper"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;16 Nov 2018&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codea6d7e97db64d7a6459ca93cfc3d4ff02"><\\>Python</a></figcaption></figure>\n<p><strong>日期和时间一起</strong></p>\n<figure id="codef8814e55d9c3df081ae6694185e9151f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="s1">&#39;d/m/Y H:i&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef8814e55d9c3df081ae6694185e9151f"><\\>Python</a></figcaption></figure><figure id="code954a0050d5b0ae7e09195a351d84ae8f" class="code-wrapper"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;16/11/2018 06:48&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code954a0050d5b0ae7e09195a351d84ae8f"><\\>Python</a></figcaption></figure><h2 id="DateParse">DateParse</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.dateparse</strong></p></blockquote>\n<p>将格式化后的字符串转为 date/time/datetime 对象. 如果字符串格式正确， 但表示无效时间将会返回 <strong>None</strong>.</p>\n\n<p><strong>parse_date</strong></p>\n<figure id="code80f08c25d5a5e11494613b9173731b4e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_date</span>\n\n<span class="n">parse_date</span><span class="p">(</span><span class="s1">&#39;2018-11-16&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code80f08c25d5a5e11494613b9173731b4e"><\\>Python</a></figcaption></figure><figure id="codee18e747ac4ad396c4eb388bdb466ea42" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codee18e747ac4ad396c4eb388bdb466ea42"><\\>Python</a></figcaption></figure>\n<p><strong>parse_time</strong></p>\n<figure id="code1e8a4e563d4bdd31caae37da76512e42" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_time</span>\n\n<span class="n">parse_time</span><span class="p">(</span><span class="s1">&#39;14:54:02&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code1e8a4e563d4bdd31caae37da76512e42"><\\>Python</a></figcaption></figure><figure id="code8b93bacfa3a74ac3468e2420af5de802" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code8b93bacfa3a74ac3468e2420af5de802"><\\>Python</a></figcaption></figure>\n<p><strong>parse_datetime</strong></p>\n<figure id="codeb985f856dd0e3473344f5b9188b38bbd" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.dateparse</span> <span class="kn">import</span> <span class="n">parse_datetime</span>\n\n<span class="n">parse_datetime</span><span class="p">(</span><span class="s1">&#39;2018-11-16 14:54:02&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb985f856dd0e3473344f5b9188b38bbd"><\\>Python</a></figcaption></figure><figure id="codeb366ade05030ddc0fc1d7ddcfad2faac" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2018</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeb366ade05030ddc0fc1d7ddcfad2faac"><\\>Python</a></figcaption></figure><h2 id="HTML">HTML</h2><blockquote class="blockquote-normal">\n                <p>Module: <strong>django.utils.html</strong></p></blockquote>\n<p><strong>urlize</strong></p>\n\n<p>将文本中的网址转换为&lt;a&gt;标签</p>\n<figure id="codeafcba638395ffd6e26a7f70fdb7484ec" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">urlize</span>\n\n<span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;You guys should visit this website www.google.com&#39;</span><span class="p">)</span>\n<span class="k">print</span> <span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Please visit:  https://jackeygao.io&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeafcba638395ffd6e26a7f70fdb7484ec"><\\>Python</a></figcaption></figure><figure id="code16812188ca1240a9eb5389fa55a0a464" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;You guys should visit this website &lt;a href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&#39;</span>\n<span class="n">Please</span> <span class="n">visit</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://jackeygao.io&quot;</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jackeygao</span><span class="o">.</span><span class="n">io</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code16812188ca1240a9eb5389fa55a0a464"><\\>Python</a></figcaption></figure>\n<p>他也适用于email地址</p>\n<figure id="codee32cd2eae7bf259c5ea88993e780a957" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Send me a message to gaojunqi@outlook.com&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codee32cd2eae7bf259c5ea88993e780a957"><\\>Python</a></figcaption></figure><figure id="codeee9a300a91fb283311bc56489ecc7249" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;Send me a message to &lt;a href=&quot;mailto:gaojunqi@outlook.com&quot;&gt;gaojunqi@outlook.com&lt;/a&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeee9a300a91fb283311bc56489ecc7249"><\\>Python</a></figcaption></figure>\n<p>你也可以修剪链接显示部分长度, 不足处以&#39;...&#39;替代</p>\n<figure id="code7f53704bac8c0662e11515ea96425371" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">urlize</span><span class="p">(</span><span class="s1">&#39;Please visit https://jackeygao.io/words/django-exploring-utils.html&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code7f53704bac8c0662e11515ea96425371"><\\>Python</a></figcaption></figure><figure id="codeafc3b066fc1d6634aa410b4280a613a5" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">Please</span> <span class="n">visit</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://jackeygao.io/words/django-exploring-utils.html&quot;</span><span class="o">&gt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">jackeygao</span><span class="o">.</span><span class="n">io</span><span class="o">/...&lt;/</span><span class="n">a</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeafc3b066fc1d6634aa410b4280a613a5"><\\>Python</a></figcaption></figure>\n<p><strong>escape</strong></p>\n\n<p>对html 特殊字符编码</p>\n<figure id="codea1078f3ef34f74538bb07ce29c806f5e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">escape</span>\n\n<span class="n">escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong style=&#39;font-size: 12px&#39;&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codea1078f3ef34f74538bb07ce29c806f5e"><\\>Python</a></figcaption></figure><figure id="code6dd6d6e94148da55eddc930e2da72ad2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&amp;lt;strong style=&amp;#39;font-size: 12px&amp;#39;&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code6dd6d6e94148da55eddc930e2da72ad2"><\\>Python</a></figcaption></figure>\n<p>这将导致已转义的字符串再次被转义</p>\n<figure id="codeef88e0cf5de05421adab038822f073a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">escaped_html</span> <span class="o">=</span> <span class="n">escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n\n<span class="n">escape</span><span class="p">(</span><span class="n">escaped_html</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;amp;lt;strong&amp;amp;gt;escaped html&amp;amp;lt;/strong&amp;amp;gt;&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeef88e0cf5de05421adab038822f073a2"><\\>Python</a></figcaption></figure>\n<p>如果不想这样, 请改用<strong>conditional_escape()</strong></p>\n\n<p><strong>conditional_escape</strong></p>\n<figure id="code9882849fe025fc33647da7e4746f99be" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">escaped_html</span> <span class="o">=</span> <span class="n">conditional_escape</span><span class="p">(</span><span class="s2">&quot;&lt;strong&gt;escaped html&lt;/strong&gt;&quot;</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n\n<span class="n">conditional_escape</span><span class="p">(</span><span class="n">escaped_html</span><span class="p">)</span>\n<span class="c1"># &#39;&amp;lt;strong&amp;gt;escaped html&amp;lt;/strong&amp;gt;&#39;</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code9882849fe025fc33647da7e4746f99be"><\\>Python</a></figcaption></figure>\n<p><strong>format_html</strong></p>\n\n<p>此函数类似格式化字符串(str.format()), 因为安全的原因推荐使用<strong>format_html</strong>.</p>\n<figure id="codeb3465535e541bcc8a05a6dbf9700f9d9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>\n\n<span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;alert {}&quot;&gt;{}&lt;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codeb3465535e541bcc8a05a6dbf9700f9d9"><\\>Python</a></figcaption></figure><figure id="codee8144759e700a308b6621eb48eb286d8" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&lt;div class=&quot;alert warning&quot;&gt;Watch out!&lt;/&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codee8144759e700a308b6621eb48eb286d8"><\\>Python</a></figcaption></figure>\n<p>安全的格式化 HTML 代码.</p>\n<figure id="code3b7223e00e3277d471aa1555a2d8dc0e" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;alert {}&quot;&gt;{}&lt;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;script&gt;alert(1);&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code3b7223e00e3277d471aa1555a2d8dc0e"><\\>Python</a></figcaption></figure><figure id="codeedc558fae9445a8a63bceca85cb836a2" class="code-wrapper"><div class="highlight"><pre><span></span><span class="s1">&#39;&lt;div class=&quot;alert &amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;&quot;&gt;Watch out!&lt;/&gt;&#39;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeedc558fae9445a8a63bceca85cb836a2"><\\>Python</a></figcaption></figure>\n<p><strong>format_html_join</strong></p>\n\n<p>适用于快速用相同的方式格式化一组列表</p>\n<figure id="code51c661def0e3b80b0d1bfca07ed342f9" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;p&gt;{}&lt;/p&gt;&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code51c661def0e3b80b0d1bfca07ed342f9"><\\>Python</a></figcaption></figure><figure id="codeb76b0ca9baf604844b9f69f627267dc7" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">a</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\\<span class="n">n</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">b</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\\<span class="n">n</span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">c</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codeb76b0ca9baf604844b9f69f627267dc7"><\\>Python</a></figcaption></figure>\n<p>另外一个例子</p>\n<figure id="codefc7df5a365213ee049877c73759e4149" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>\n    <span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;Success message&#39;</span><span class="p">],</span>\n    <span class="p">[</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Watch out!&#39;</span><span class="p">],</span>\n    <span class="p">[</span><span class="s1">&#39;danger&#39;</span><span class="p">,</span> <span class="s1">&#39;Danger!!&#39;</span><span class="p">],</span>\n<span class="p">]</span>\n\n<span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;div class=&quot;alert {0}&quot;&gt;{1}&lt;/div&gt;&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codefc7df5a365213ee049877c73759e4149"><\\>Python</a></figcaption></figure><figure id="codef2e42f61dcb1047d4063c4d3166b68ba" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert success&quot;</span><span class="o">&gt;</span><span class="n">Success</span> <span class="n">message</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert warning&quot;</span><span class="o">&gt;</span><span class="n">Watch</span> <span class="n">out</span><span class="err">!</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert danger&quot;</span><span class="o">&gt;</span><span class="n">Danger</span><span class="err">!!</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#codef2e42f61dcb1047d4063c4d3166b68ba"><\\>Python</a></figcaption></figure>\n<p>和表格一起使用, 当然也可以和ul li一起使用.</p>\n<figure id="codef534f56ead65928198fb774fa17ec59a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="n">format_html_join</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;tr&gt;&lt;td&gt;{0}&lt;/td&gt;&lt;td&gt;{1}&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="p">,</span> <span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>\n                                                            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="p">))</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#codef534f56ead65928198fb774fa17ec59a"><\\>Python</a></figcaption></figure><figure id="code8e8be20b6bfd76fb648825d0200d0082" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Vitor</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Freitas</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">John</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Duo</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Peter</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Croke</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\\<span class="n">n</span>\n<span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Elektra</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Moore</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code8e8be20b6bfd76fb648825d0200d0082"><\\>Python</a></figcaption></figure>\n<p><strong>linebreaks</strong></p>\n\n<p>快速将<strong>\\n</strong>转换为&lt;br /&gt;</p>\n<figure id="code200fd6e3f29a9e860a32e57210579a6a" class="code-wrapper"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">linebreaks</span>\n\n<span class="n">linebreaks</span><span class="p">(</span><span class="s1">&#39;convert</span><span class="se">\\n</span><span class="s1">into html paragraphs</span><span class="se">\\n</span><span class="s1">test&#39;</span><span class="p">)</span>\n</pre></div>\n<figcaption><a class="lang-label" href="#code200fd6e3f29a9e860a32e57210579a6a"><\\>Python</a></figcaption></figure><figure id="code92e71fb55c84d388806607d65566a117" class="code-wrapper"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">convert</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="n">into</span> <span class="n">html</span> <span class="n">paragraphs</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>\n</pre></div>\n<span class="title-label">#output</span><figcaption><a class="lang-label" href="#code92e71fb55c84d388806607d65566a117"><\\>Python</a></figcaption></figure>\n<p>就是这样， 我希望你也能找到一些有趣的函数， 欢迎通过留言推荐.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#('淫诗作对', [{'filename': 'black-night-cat', 'title': '黑夜的猫', 'date': datetime.datetime(2015, 9, 30, 12, 50, 22), 'cover': '/uploads/images/photo-1415931633537-351070d20b81.jpeg', 'set': '淫诗作对', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/photo-1415931633537-351070d20b81.jpeg"></div><figcaption class="img-title">#黎明</figcaption></figure></p>\n<blockquote class="blockquote-center song">\n                <p><tt>黑夜的猫</tt><br/><at>JG</at><br/>夜<br/>厚夜<br/>路灯下的猫<br/>猫眼中的笑<br/>在烦躁<br/>在煎熬<br/>如同， 美好云雾缭绕<br/>还好， 不再不可救药</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('淫诗作对', [{'filename': 'black-night-cat', 'title': '黑夜的猫', 'date': datetime.datetime(2015, 9, 30, 12, 50, 22), 'cover': '/uploads/images/photo-1415931633537-351070d20b81.jpeg', 'set': '淫诗作对', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/photo-1415931633537-351070d20b81.jpeg"></div><figcaption class="img-title">#黎明</figcaption></figure></p>\n<blockquote class="blockquote-center song">\n                <p><tt>黑夜的猫</tt><br/><at>JG</at><br/>夜<br/>厚夜<br/>路灯下的猫<br/>猫眼中的笑<br/>在烦躁<br/>在煎熬<br/>如同， 美好云雾缭绕<br/>还好， 不再不可救药</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#('瞎JB扯淡', [{'filename': 'illusion-and-reality', 'title': '幻想与现实', 'date': datetime.datetime(2015, 10, 4, 20, 48, 51), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/photo-1440964829947-ca3277bd37f8.jpeg"></div></figure></p>\n\n<p>我是个会意淫的人， 从自己的爱情， 到自己的事业， 总是憧憬那么美好的事情。时间可以是将来， 可以是过去， 但总是美好。 当一个人的时候， 特别是晚上睡觉的之前的半个小时， 总能想到很多不可思议的遐想， 这些遐想太美妙了， 让我不可自拔， 每天晚上我都会想象这些美好的事情， 有时候开始一个新的意淫， 有时候则接着之前的剧情发展， 期间我无数次告诉自己这是假的， 马上停止下来继续你的睡眠， 可是越是美好越让我心潮澎湃， 激动处我有时能微笑， 有时候能感动到流泪， 然后再无睡意。</p>\n\n<p>不得不说， 这些想象真的很难实现， 太过于虚幻、美好、 完美。我不知道这个是不是病， 我想这是每个人的共性， 都会一致的幻想自己丰衣足食， 总是很轻松， 不会为未来担忧， 不后悔过去， 因为过去是按照自己的设想过来的。 如果我让这些写出来， 估计也是屌丝逆袭人生的大剧， 会吸引同类病种人群大量观看， 我也就成了一位有病的伟大编剧。每次都不能从 YY 中把我自己唤醒， 感觉是被幻想召唤走了， 我跟着这种心理不断创造出美好， 并被这些美好吸引， 吸引着我持续输出更美的结局， 让我不能理解的是这些创造我也会根据自身和社会因素来克制， 所以在我糊涂的幻想中我认为这些就是现实， 之后我完全不能自拔。</p>\n\n<p>最近越来越严重了， 我到网上查了查这种状况是否正常， 其实我深知这是不正常的表现。 只是想知道为什么会产生这种不健康的生活习惯， 查来查去给出最多是失眠造成的脑袋空想。我并不在乎这种病在并发能给我有多大危害， 但每次早上我都死气沉沉， 觉得好像失恋一样， 甚至产生一种厌世的心态， 我知道可能和我晚上空想有关。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'how-to-destroy-sina-account', 'title': '永久注销新浪微博账户', 'date': datetime.datetime(2016, 8, 28, 18, 31, 40), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>我是微博轻度用户， 轻度到没有微博对我的社交生活一点影响都没有. 所以我微博被盗号好几个月都没有被我发现， 一般登不上微博的时候我一般就不登录了， 所以很久之后才发现微博被盗号了。 因为我的安全措施做的很好， 所以我不禁怀疑微博的账号体系， 加之在盗号期间转发的微博让人不堪入目, 和无脑水军和无脑脑残粉一样的评论风格，让我觉得恶心.</p>\n\n<p>类似于:</p>\n\n<ul>\n<li>在某明星下评论某某是我老公, 某某我要为你生孩子</li>\n<li>转发化妆品微博, 并评论虚假的使用评价</li>\n<li>转发某电影的影评</li>\n<li>....</li>\n</ul>\n\n<p>这和我的价值观严重不符， 甚至我一度怀疑是官方内部人员操纵. 重洗三观, 让我对以前新浪微博的某些评论有一个新的认知, 所以微博平台毫无可信的价值. 不打开, 不登录固然可以. 但我担心微博账号搁置之后又被新浪或某些人盗去当水军号, 所以我想到销毁账号, 众所周知, 国内没有互联网能良心的提供注销账号功能. 然后我想到<strong>封号</strong>, 新浪微博对刷粉0容忍, </p>\n<blockquote class="blockquote-error">\n                <p> <strong>⚠注意: 这个是永久封停, 申诉也没有办法找回了. 注销需谨慎.</strong></p></blockquote>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/sina-web-service-notice.png"></div></figure></p>\n<h2 id="1. 头像">1. 头像</h2><blockquote class="blockquote-normal">\n                <p>头像改为刷粉头像, 去淘宝搜索新浪刷粉找个店家的头像就行.</p></blockquote><h2 id="2. 发布几条刷粉微博">2. 发布几条刷粉微博</h2>\n<p>提供几个文案例子, 有时包含违法内容， 试着加空格或者拼音的方式通过验证.</p>\n<blockquote class="blockquote-normal">\n                <p>新浪微博10000+粉丝狂热追捧(半年间涨关注刷过500万加）欢迎购买 新浪微博/达人涨活粉帐号购买/红人转发推广/僵尸刷点赞关注营销v </p><br/><p>shua粉 1000/10元 2000/100元 3000/100元 永久, 不掉.</p></blockquote><h2 id="3. 终极大招">3. 终极大招</h2>\n<p>私信新浪微博客服, 新浪微博秘书等官方账号. 把上面的内容发送过去. </p>\n<blockquote class="blockquote-warning">\n                <p> 我的微博账号不到两个小时就被封掉了</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-315', 'title': '315食品安全?晚会', 'date': datetime.datetime(2017, 3, 16, 12, 41, 12), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>315晚会的取材绝不是当天就能做完的， 换言之， 315晚会也是有制作周期的， 为制作一些节目效果， 制作期间的保密工作真是天衣无缝。 我记得去年315晚会前夕， 微博上也会卖个关子， 吊人胃口， 以博取关注带来更高的收视率. 诚然， 这是电视媒体一贯的做法， 但与往年不同的是， 今年有关乎每个人的食品安全问题， 食品质量安全问题也是最近几年比较敏感的话题， 和每个人的每一天都息息相关。 </p>\n\n<p>但在发现的时候， 为什么不在官媒上通告？ 如果一味的烘托315晚会的收视率， 那就让人反感了。 如果目的是让更多的人关注， 来责备质监部门的监管不利， 那315不是打假晚会， 而是更多的作风整治。 私以为， 关乎民生都不是小问题， 再则辐射食品严重性， 实则应该及时通告出来。 早点防范为好。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-06-05', 'title': '肆无忌惮', 'date': datetime.datetime(2017, 6, 5, 21, 32, 12), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>昨天， 因为家里的事情。 爸爸让我妈尽快从上海回到老家， 我妈就给我打电话说了这件事情， 还吐槽了爸爸很多话， 并成功的让我觉得是我爸事情太多。 我并没有在他们俩之间站队， 我知道最近几年随着我长大成人， 随着他们慢慢老去， 很多事情他们都会和我商量着来。 而且从以往的每次给我商量最终他们会站在我这边， 从某种意义上来讲， 这种行为的慢慢增多， 我们之间的身份也转换了。 我承认很多时候， 我没有那么多的耐心， 来纠正他们每一个每一个错误的认识。 所以到后来我很少和他们打电话， 慢慢的我的逃避心理就成了常态。我爸妈似乎也发现了我这种心理， 所以他们打过来电话， 就是有事情发生。</p>\n\n<p>角色转换后， 越来越觉得我妈像个孩子。由于我爸提前回家了， 他要到火车站， 但是对坐地铁有恐惧心理。 生怕自己做错， 而且因为省钱还不舍得打出租车。 下午五点半的车， 三点钟给我打电话， 问我怎么到火车站。 我知道她想让我去送她， 但我到她那边要两个小时的路程。 我就天真跟我妈说地铁中转路线。 她似乎没有听进去， 又表述了自己的无能为力。 我这时候不耐烦了， 说话声音都变了， 后来直接大动肝火， 对她发了脾气。 她像个孩子似的， 不敢说话甚至不再央求我去送她。 在一阵沉默后， 她把电话挂了。</p>\n\n<p>我有很多次这种情况了， 挂完电话后心中更加生气了， 但大部分是恨自己内疚， 一阵的五味杂陈。 收拾了一下出了门就赶往火车站方向， 路上并打过去了一个电话， 在试着告知去火车站的交通路线。 但还是无济于事， 我突然想起小时候， 我妈带着我去商丘市看病的情景。 那个时候她也是去一个不熟悉的地方， 到处打听才最终到了医院。 想着想着眼睛不禁湿润了。我还没到火车站， 我妈打过来电话， 说是亲戚会送她去火车站， 让我不要过来了， 我心中惭愧至极， 简单交代到家告诉我一些话后， 因为我妈要坐车也就挂断了。 </p>\n\n<p>回来的路上我一直在想， 为什么我能这么肆无忌惮的对自己最亲的人发脾气， 而对其他的陌生人宽容大度？</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-06-23', 'title': '谦虚为人，终有吉时', 'date': datetime.datetime(2017, 6, 22, 21, 3, 45), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>起因是最近在Segmentfault回答了一个问题， 这个问题三天了依然是零回答，本着好奇心， 我从头搭建环境回答了此问题。 并从中指明了另外的一个问题， 但没想到弄巧成拙， 遭题主讽刺。我回答中全部以平和的语气指出问题所在， 抱着回答问题一定要回答全面的心态来进行， 而且是第一次回答， 以为可以像StackOverflow一样来进行友好的技术交流。也许是我太玻璃心， 事实上相反。 </p>\n<blockquote class="blockquote-normal">\n                <p>《易经》中对谦虚定义了六层境界，即使孔夫子也不能达到最高的境界。我们普通人呢， 也只能努力为之。</p></blockquote>\n<p>下了班我一直思考这个问题， 是国内技术人员都牛气冲天，戾气太重？还是本身平台引导问题。 然而我也并没有看到StackOverflow有关于交流语气的规则定义。由于我本身就是技术出身， 混论坛提issue或者邮件交流都经历了很多讨论， 一直彬彬有礼谦虚谨慎。 我觉得这样才是一个正常的交流氛围， 甚至这才是做人应有的原则。 奈何， 这样的“二大爷”并不少。 想罢， 卸载了Segmentfault。</p>\n\n<p>通过这件事情， 让我又想到之前公司的“首席架构师”， 因为一个实习生的配置问题， 遭大骂一顿。 公司内对他的态度分成两类， 一种是拍马屁跪舔的， 另外一种则是敬而远之的。 我是第二种， 而且这种占大多数。 后来这大多数， 走了大部分。 其中我也是。技术牛逼的人，不理解不能容忍犯错的心态可以理解。 但缺少教养， 那以后的生活就很累了。 </p>\n\n<p>我还是那句话， 技术人能够走的更远， 走的更好。 还是要不能忘本， 来自于最初的教育教给你的“谦虚”。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'takeout-from-world', 'title': 'Takeout from world', 'date': datetime.datetime(2017, 7, 18, 12, 31, 43), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>不知道为什么总感觉这一天会来的, 而且快要临头了。</p>\n\n<p>Google全家数据</p>\n\n<p><a href="https://takeout.google.com/settings/takeout">https://takeout.google.com/settings/takeout</a> 打包后下载.</p>\n\n<p>Gmail 设置转发mail。</p>\n\n<p><a href="https://mail.google.com/mail/u/0/#settings/fwdandpop">https://mail.google.com/mail/u/0/#settings/fwdandpop</a></p>\n\n<p>Twitter</p>\n\n<p><a href="https://twitter.com/settings/your_twitter_data">https://twitter.com/settings/your<em>twitter</em>data</a></p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'acne', 'title': '我的『战痘』史', 'date': datetime.datetime(2018, 6, 7, 12, 23, 11), 'cover': '/uploads/images/orange-cat.jpeg', 'set': '瞎JB扯淡', 'content': '<blockquote class="blockquote-error">\n                <p> <strong><i class="exclamation triangle red icon"></i><span class="red text">警告</span>: 本人对以下见解不负任何责任， 仅仅是自己的一些不正规的经验(偏方)， 请询问医生后酌情使用</strong></p></blockquote>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/orange-cat.jpeg"></div><figcaption class="img-title">#橘猫</figcaption></figure></p>\n\n<p>我觉得痘痘分为以下种， </p>\n\n<ul>\n<li>青春痘</li>\n<li>毛囊炎</li>\n<li>粉刺或其它小颗粒</li>\n</ul>\n\n<p>对于青春痘， 我没有很好的建议。 在我22岁的时候， 突然就不长了。 这种痘痘在皮肤出油区以外的地方也会生长。 一般内分泌调理好， 或者新陈代谢正常后就不会大量生长了。</p>\n\n<p>对于青春痘我并没有很大的在意， 学生时代每个人几乎都顶着一脸的痘痘生活， 好像也没有多少自卑。 但是毕业和工作后， 痘痘依然每天的生长， 这让我很是苦恼， 又随着工作的压力变得不可控制， 反反复复。</p>\n\n<p>起初我把长痘 归于用了不适合的洗面奶导致， 后来无论我换什么洗面奶， 总是没有效果。 遇到前任后， 才得知需要补水控制油水平衡， 于是青春痘不在长， 但是 T 区出油附近还是反复， 特别吃辣椒后更是爆炸。 </p>\n\n<p>我身体母胎以来就不好， 特别容易上火。 头上也及容易长痘痘， 在我2015年的时候， 因为中耳炎吃了三周的阿莫西林，  比较奇怪的是， 那段时间头上的痘痘和脸上 T 区的痘痘一颗都没有冒出。 于是我大概确定， T 区和头上是因为真菌感染，这种真菌和中耳炎的细菌差不多类似。而我在近几年相继得过『带状疱疹』，『疖肿』多少都是因为体质虚弱时真菌感染的原因。而阿莫西林是一种抗细菌药，但是我并不能一直吃抗生素缓解， 这只会让我的身体每况愈下。 </p>\n\n<p>于是在之后的一次， 头上痘痘泛滥， 我在洗发水里面加入了一个胶囊四分之一的阿莫西林粉末， 揉匀后搓洗了头发大概两分钟， 头皮瞬间就清爽了不少， 第二天已有的毛囊炎（痘痘）也结痂了。 这种效果让我出奇的放松。 连续洗了两次， 更换枕套和被子会好一段时间， 但是还是需要注意卫生。由于是油性头皮，总是每隔一段时间这样， 我都是连续用阿莫西林洗两次。这种方式不知道会不会有后遗症， 但确是能很快的杀掉头上的真菌， 能达到立杆见影的效果。</p>\n\n<p>脸上的类似，如果脸上比较容易出油，这都给了真菌滋生的『优良土壤』， 其实都是真菌泛滥的缘故。 同样杀真菌的方式，需要注意的是脸上用更小的剂量， 五分之一或者六分之一， 在我洗了两次后， 同事也发现了我脸色的改善。</p>\n\n<p>脸上出油真的很难去改变， 无论是通过饮食还是通过优良的作息。 可能需要更长的时间， 才能有改善。 但因为出油而导致， 脸上或者头上的痘痘， 可以通过抗生素来解决。 这一点是所有洗发水都不能做到的。 但我还是不建议直接使用阿莫西林， 可以先尝试康王等相比比较柔和的方式来解决， 甚至其他方法治标还治本。 当无能为力的时候， 可以尝试下这个方法， <strong>但这个绝不能是天天护理的方式</strong>。 </p>\n\n<hr>\n\n<p>总而言之， 一定要弄清楚痘痘的成因。 如果是因为熬夜， 吃辣， 生理期导致的长痘， 完全是可以接受的。 放松心情， 不抠不挠， 会慢慢好的。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'tiangou', 'title': '当一个舔狗', 'date': datetime.datetime(2018, 11, 2, 17, 1, 11), 'cover': None, 'set': '瞎JB扯淡', 'content': '<h2 id="产品经理 vs 程序员">产品经理 vs 程序员</h2><blockquote class="blockquote-normal">\n                <p>内部学习资料未经批准不得外传 </p></blockquote>\n<ol>\n<li><p>这个代码写得好, 有个bug一般人还看不出, 只有系统能跑出来 .</p></li>\n<li><p>只有您这样独一无二的程序员, 才能写出无法让别人维护的代码. （代码出了bug) </p></li>\n<li><p>多么简洁的代码! 连我都能看懂! 您才是公司公认的第一工程师.</p></li>\n<li><p>我从业5年, 终于见到像你一样想改变世界的产品经理了。（提出实现不了的傻逼需求） </p></li>\n<li><p>失敬失敬。只有最大胆的产品经理, 才能像你一样提出如此有想象力的功能. </p></li>\n<li><p>像你这样敏锐的产品经理, 才能紧跟国外最新动态, 师夷长技以制夷. （产品经理要秒国外的功能） </p></li>\n<li><p>一般人是无法了解您这个需求的前瞻陛。他们庸人都活在当下, 而您创造未来. </p></li>\n<li><p>您让我了解到上帝造物的神器, 您的一天可能有48个小时。（今天下需求明天就要） </p></li>\n</ol>\n\n<hr>\n\n<p>人家说当舔狗能够长寿.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('瞎JB扯淡', [{'filename': 'illusion-and-reality', 'title': '幻想与现实', 'date': datetime.datetime(2015, 10, 4, 20, 48, 51), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/photo-1440964829947-ca3277bd37f8.jpeg"></div></figure></p>\n\n<p>我是个会意淫的人， 从自己的爱情， 到自己的事业， 总是憧憬那么美好的事情。时间可以是将来， 可以是过去， 但总是美好。 当一个人的时候， 特别是晚上睡觉的之前的半个小时， 总能想到很多不可思议的遐想， 这些遐想太美妙了， 让我不可自拔， 每天晚上我都会想象这些美好的事情， 有时候开始一个新的意淫， 有时候则接着之前的剧情发展， 期间我无数次告诉自己这是假的， 马上停止下来继续你的睡眠， 可是越是美好越让我心潮澎湃， 激动处我有时能微笑， 有时候能感动到流泪， 然后再无睡意。</p>\n\n<p>不得不说， 这些想象真的很难实现， 太过于虚幻、美好、 完美。我不知道这个是不是病， 我想这是每个人的共性， 都会一致的幻想自己丰衣足食， 总是很轻松， 不会为未来担忧， 不后悔过去， 因为过去是按照自己的设想过来的。 如果我让这些写出来， 估计也是屌丝逆袭人生的大剧， 会吸引同类病种人群大量观看， 我也就成了一位有病的伟大编剧。每次都不能从 YY 中把我自己唤醒， 感觉是被幻想召唤走了， 我跟着这种心理不断创造出美好， 并被这些美好吸引， 吸引着我持续输出更美的结局， 让我不能理解的是这些创造我也会根据自身和社会因素来克制， 所以在我糊涂的幻想中我认为这些就是现实， 之后我完全不能自拔。</p>\n\n<p>最近越来越严重了， 我到网上查了查这种状况是否正常， 其实我深知这是不正常的表现。 只是想知道为什么会产生这种不健康的生活习惯， 查来查去给出最多是失眠造成的脑袋空想。我并不在乎这种病在并发能给我有多大危害， 但每次早上我都死气沉沉， 觉得好像失恋一样， 甚至产生一种厌世的心态， 我知道可能和我晚上空想有关。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'how-to-destroy-sina-account', 'title': '永久注销新浪微博账户', 'date': datetime.datetime(2016, 8, 28, 18, 31, 40), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>我是微博轻度用户， 轻度到没有微博对我的社交生活一点影响都没有. 所以我微博被盗号好几个月都没有被我发现， 一般登不上微博的时候我一般就不登录了， 所以很久之后才发现微博被盗号了。 因为我的安全措施做的很好， 所以我不禁怀疑微博的账号体系， 加之在盗号期间转发的微博让人不堪入目, 和无脑水军和无脑脑残粉一样的评论风格，让我觉得恶心.</p>\n\n<p>类似于:</p>\n\n<ul>\n<li>在某明星下评论某某是我老公, 某某我要为你生孩子</li>\n<li>转发化妆品微博, 并评论虚假的使用评价</li>\n<li>转发某电影的影评</li>\n<li>....</li>\n</ul>\n\n<p>这和我的价值观严重不符， 甚至我一度怀疑是官方内部人员操纵. 重洗三观, 让我对以前新浪微博的某些评论有一个新的认知, 所以微博平台毫无可信的价值. 不打开, 不登录固然可以. 但我担心微博账号搁置之后又被新浪或某些人盗去当水军号, 所以我想到销毁账号, 众所周知, 国内没有互联网能良心的提供注销账号功能. 然后我想到<strong>封号</strong>, 新浪微博对刷粉0容忍, </p>\n<blockquote class="blockquote-error">\n                <p> <strong>⚠注意: 这个是永久封停, 申诉也没有办法找回了. 注销需谨慎.</strong></p></blockquote>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/sina-web-service-notice.png"></div></figure></p>\n<h2 id="1. 头像">1. 头像</h2><blockquote class="blockquote-normal">\n                <p>头像改为刷粉头像, 去淘宝搜索新浪刷粉找个店家的头像就行.</p></blockquote><h2 id="2. 发布几条刷粉微博">2. 发布几条刷粉微博</h2>\n<p>提供几个文案例子, 有时包含违法内容， 试着加空格或者拼音的方式通过验证.</p>\n<blockquote class="blockquote-normal">\n                <p>新浪微博10000+粉丝狂热追捧(半年间涨关注刷过500万加）欢迎购买 新浪微博/达人涨活粉帐号购买/红人转发推广/僵尸刷点赞关注营销v </p><br/><p>shua粉 1000/10元 2000/100元 3000/100元 永久, 不掉.</p></blockquote><h2 id="3. 终极大招">3. 终极大招</h2>\n<p>私信新浪微博客服, 新浪微博秘书等官方账号. 把上面的内容发送过去. </p>\n<blockquote class="blockquote-warning">\n                <p> 我的微博账号不到两个小时就被封掉了</p></blockquote>', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-315', 'title': '315食品安全?晚会', 'date': datetime.datetime(2017, 3, 16, 12, 41, 12), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>315晚会的取材绝不是当天就能做完的， 换言之， 315晚会也是有制作周期的， 为制作一些节目效果， 制作期间的保密工作真是天衣无缝。 我记得去年315晚会前夕， 微博上也会卖个关子， 吊人胃口， 以博取关注带来更高的收视率. 诚然， 这是电视媒体一贯的做法， 但与往年不同的是， 今年有关乎每个人的食品安全问题， 食品质量安全问题也是最近几年比较敏感的话题， 和每个人的每一天都息息相关。 </p>\n\n<p>但在发现的时候， 为什么不在官媒上通告？ 如果一味的烘托315晚会的收视率， 那就让人反感了。 如果目的是让更多的人关注， 来责备质监部门的监管不利， 那315不是打假晚会， 而是更多的作风整治。 私以为， 关乎民生都不是小问题， 再则辐射食品严重性， 实则应该及时通告出来。 早点防范为好。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-06-05', 'title': '肆无忌惮', 'date': datetime.datetime(2017, 6, 5, 21, 32, 12), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>昨天， 因为家里的事情。 爸爸让我妈尽快从上海回到老家， 我妈就给我打电话说了这件事情， 还吐槽了爸爸很多话， 并成功的让我觉得是我爸事情太多。 我并没有在他们俩之间站队， 我知道最近几年随着我长大成人， 随着他们慢慢老去， 很多事情他们都会和我商量着来。 而且从以往的每次给我商量最终他们会站在我这边， 从某种意义上来讲， 这种行为的慢慢增多， 我们之间的身份也转换了。 我承认很多时候， 我没有那么多的耐心， 来纠正他们每一个每一个错误的认识。 所以到后来我很少和他们打电话， 慢慢的我的逃避心理就成了常态。我爸妈似乎也发现了我这种心理， 所以他们打过来电话， 就是有事情发生。</p>\n\n<p>角色转换后， 越来越觉得我妈像个孩子。由于我爸提前回家了， 他要到火车站， 但是对坐地铁有恐惧心理。 生怕自己做错， 而且因为省钱还不舍得打出租车。 下午五点半的车， 三点钟给我打电话， 问我怎么到火车站。 我知道她想让我去送她， 但我到她那边要两个小时的路程。 我就天真跟我妈说地铁中转路线。 她似乎没有听进去， 又表述了自己的无能为力。 我这时候不耐烦了， 说话声音都变了， 后来直接大动肝火， 对她发了脾气。 她像个孩子似的， 不敢说话甚至不再央求我去送她。 在一阵沉默后， 她把电话挂了。</p>\n\n<p>我有很多次这种情况了， 挂完电话后心中更加生气了， 但大部分是恨自己内疚， 一阵的五味杂陈。 收拾了一下出了门就赶往火车站方向， 路上并打过去了一个电话， 在试着告知去火车站的交通路线。 但还是无济于事， 我突然想起小时候， 我妈带着我去商丘市看病的情景。 那个时候她也是去一个不熟悉的地方， 到处打听才最终到了医院。 想着想着眼睛不禁湿润了。我还没到火车站， 我妈打过来电话， 说是亲戚会送她去火车站， 让我不要过来了， 我心中惭愧至极， 简单交代到家告诉我一些话后， 因为我妈要坐车也就挂断了。 </p>\n\n<p>回来的路上我一直在想， 为什么我能这么肆无忌惮的对自己最亲的人发脾气， 而对其他的陌生人宽容大度？</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': '2017-06-23', 'title': '谦虚为人，终有吉时', 'date': datetime.datetime(2017, 6, 22, 21, 3, 45), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>起因是最近在Segmentfault回答了一个问题， 这个问题三天了依然是零回答，本着好奇心， 我从头搭建环境回答了此问题。 并从中指明了另外的一个问题， 但没想到弄巧成拙， 遭题主讽刺。我回答中全部以平和的语气指出问题所在， 抱着回答问题一定要回答全面的心态来进行， 而且是第一次回答， 以为可以像StackOverflow一样来进行友好的技术交流。也许是我太玻璃心， 事实上相反。 </p>\n<blockquote class="blockquote-normal">\n                <p>《易经》中对谦虚定义了六层境界，即使孔夫子也不能达到最高的境界。我们普通人呢， 也只能努力为之。</p></blockquote>\n<p>下了班我一直思考这个问题， 是国内技术人员都牛气冲天，戾气太重？还是本身平台引导问题。 然而我也并没有看到StackOverflow有关于交流语气的规则定义。由于我本身就是技术出身， 混论坛提issue或者邮件交流都经历了很多讨论， 一直彬彬有礼谦虚谨慎。 我觉得这样才是一个正常的交流氛围， 甚至这才是做人应有的原则。 奈何， 这样的“二大爷”并不少。 想罢， 卸载了Segmentfault。</p>\n\n<p>通过这件事情， 让我又想到之前公司的“首席架构师”， 因为一个实习生的配置问题， 遭大骂一顿。 公司内对他的态度分成两类， 一种是拍马屁跪舔的， 另外一种则是敬而远之的。 我是第二种， 而且这种占大多数。 后来这大多数， 走了大部分。 其中我也是。技术牛逼的人，不理解不能容忍犯错的心态可以理解。 但缺少教养， 那以后的生活就很累了。 </p>\n\n<p>我还是那句话， 技术人能够走的更远， 走的更好。 还是要不能忘本， 来自于最初的教育教给你的“谦虚”。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'takeout-from-world', 'title': 'Takeout from world', 'date': datetime.datetime(2017, 7, 18, 12, 31, 43), 'cover': None, 'set': '瞎JB扯淡', 'content': '<p>不知道为什么总感觉这一天会来的, 而且快要临头了。</p>\n\n<p>Google全家数据</p>\n\n<p><a href="https://takeout.google.com/settings/takeout">https://takeout.google.com/settings/takeout</a> 打包后下载.</p>\n\n<p>Gmail 设置转发mail。</p>\n\n<p><a href="https://mail.google.com/mail/u/0/#settings/fwdandpop">https://mail.google.com/mail/u/0/#settings/fwdandpop</a></p>\n\n<p>Twitter</p>\n\n<p><a href="https://twitter.com/settings/your_twitter_data">https://twitter.com/settings/your<em>twitter</em>data</a></p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'acne', 'title': '我的『战痘』史', 'date': datetime.datetime(2018, 6, 7, 12, 23, 11), 'cover': '/uploads/images/orange-cat.jpeg', 'set': '瞎JB扯淡', 'content': '<blockquote class="blockquote-error">\n                <p> <strong><i class="exclamation triangle red icon"></i><span class="red text">警告</span>: 本人对以下见解不负任何责任， 仅仅是自己的一些不正规的经验(偏方)， 请询问医生后酌情使用</strong></p></blockquote>\n<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/orange-cat.jpeg"></div><figcaption class="img-title">#橘猫</figcaption></figure></p>\n\n<p>我觉得痘痘分为以下种， </p>\n\n<ul>\n<li>青春痘</li>\n<li>毛囊炎</li>\n<li>粉刺或其它小颗粒</li>\n</ul>\n\n<p>对于青春痘， 我没有很好的建议。 在我22岁的时候， 突然就不长了。 这种痘痘在皮肤出油区以外的地方也会生长。 一般内分泌调理好， 或者新陈代谢正常后就不会大量生长了。</p>\n\n<p>对于青春痘我并没有很大的在意， 学生时代每个人几乎都顶着一脸的痘痘生活， 好像也没有多少自卑。 但是毕业和工作后， 痘痘依然每天的生长， 这让我很是苦恼， 又随着工作的压力变得不可控制， 反反复复。</p>\n\n<p>起初我把长痘 归于用了不适合的洗面奶导致， 后来无论我换什么洗面奶， 总是没有效果。 遇到前任后， 才得知需要补水控制油水平衡， 于是青春痘不在长， 但是 T 区出油附近还是反复， 特别吃辣椒后更是爆炸。 </p>\n\n<p>我身体母胎以来就不好， 特别容易上火。 头上也及容易长痘痘， 在我2015年的时候， 因为中耳炎吃了三周的阿莫西林，  比较奇怪的是， 那段时间头上的痘痘和脸上 T 区的痘痘一颗都没有冒出。 于是我大概确定， T 区和头上是因为真菌感染，这种真菌和中耳炎的细菌差不多类似。而我在近几年相继得过『带状疱疹』，『疖肿』多少都是因为体质虚弱时真菌感染的原因。而阿莫西林是一种抗细菌药，但是我并不能一直吃抗生素缓解， 这只会让我的身体每况愈下。 </p>\n\n<p>于是在之后的一次， 头上痘痘泛滥， 我在洗发水里面加入了一个胶囊四分之一的阿莫西林粉末， 揉匀后搓洗了头发大概两分钟， 头皮瞬间就清爽了不少， 第二天已有的毛囊炎（痘痘）也结痂了。 这种效果让我出奇的放松。 连续洗了两次， 更换枕套和被子会好一段时间， 但是还是需要注意卫生。由于是油性头皮，总是每隔一段时间这样， 我都是连续用阿莫西林洗两次。这种方式不知道会不会有后遗症， 但确是能很快的杀掉头上的真菌， 能达到立杆见影的效果。</p>\n\n<p>脸上的类似，如果脸上比较容易出油，这都给了真菌滋生的『优良土壤』， 其实都是真菌泛滥的缘故。 同样杀真菌的方式，需要注意的是脸上用更小的剂量， 五分之一或者六分之一， 在我洗了两次后， 同事也发现了我脸色的改善。</p>\n\n<p>脸上出油真的很难去改变， 无论是通过饮食还是通过优良的作息。 可能需要更长的时间， 才能有改善。 但因为出油而导致， 脸上或者头上的痘痘， 可以通过抗生素来解决。 这一点是所有洗发水都不能做到的。 但我还是不建议直接使用阿莫西林， 可以先尝试康王等相比比较柔和的方式来解决， 甚至其他方法治标还治本。 当无能为力的时候， 可以尝试下这个方法， <strong>但这个绝不能是天天护理的方式</strong>。 </p>\n\n<hr>\n\n<p>总而言之， 一定要弄清楚痘痘的成因。 如果是因为熬夜， 吃辣， 生理期导致的长痘， 完全是可以接受的。 放松心情， 不抠不挠， 会慢慢好的。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}, {'filename': 'tiangou', 'title': '当一个舔狗', 'date': datetime.datetime(2018, 11, 2, 17, 1, 11), 'cover': None, 'set': '瞎JB扯淡', 'content': '<h2 id="产品经理 vs 程序员">产品经理 vs 程序员</h2><blockquote class="blockquote-normal">\n                <p>内部学习资料未经批准不得外传 </p></blockquote>\n<ol>\n<li><p>这个代码写得好, 有个bug一般人还看不出, 只有系统能跑出来 .</p></li>\n<li><p>只有您这样独一无二的程序员, 才能写出无法让别人维护的代码. （代码出了bug) </p></li>\n<li><p>多么简洁的代码! 连我都能看懂! 您才是公司公认的第一工程师.</p></li>\n<li><p>我从业5年, 终于见到像你一样想改变世界的产品经理了。（提出实现不了的傻逼需求） </p></li>\n<li><p>失敬失敬。只有最大胆的产品经理, 才能像你一样提出如此有想象力的功能. </p></li>\n<li><p>像你这样敏锐的产品经理, 才能紧跟国外最新动态, 师夷长技以制夷. （产品经理要秒国外的功能） </p></li>\n<li><p>一般人是无法了解您这个需求的前瞻陛。他们庸人都活在当下, 而您创造未来. </p></li>\n<li><p>您让我了解到上帝造物的神器, 您的一天可能有48个小时。（今天下需求明天就要） </p></li>\n</ol>\n\n<hr>\n\n<p>人家说当舔狗能够长寿.</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                      <li>
                        <a href="/r/sets.html#('随笔', [{'filename': '2019-07-04', 'title': '2019年中杂谈', 'date': datetime.datetime(2019, 7, 4, 9, 26, 43), 'cover': '/uploads/images/2019-07-04.jpeg', 'set': '随笔', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/2019-07-04.jpeg"></div><figcaption class="img-title">#ben_neale@unsplash</figcaption></figure></p>\n\n<p>我一直研究如何让自己的生活和压力做到平衡。 但不管我怎么努力好像都没有活成应该的样子。</p>\n\n<p>自术后已有三个月，黄梅天，已过大半。 大多时间的焦虑都是为术后的恢复和工作占有， 虽然偶尔还能感觉到一点快乐， 但总很快就消失了。 比你焦虑的时效性， 快乐总是短暂的。 </p>\n\n<p>这种情况以前也经常的事情， 但现在是两个人生活和以前却不同， 两个人生活一个人的不开心， 另外一个人就没有不开心的理由。 我懂这个道理，所以别人的焦虑在我面前我都强制自己少管， 简单的安慰就不会再想了。 但自己的又怕影响到别人， 不愿意说出来， 只能靠自己去排解。 但排解能力很差， 越是不了解越要了解， 越要了解真相越是残酷， 如此恶性循环。 </p>\n\n<p>当焦虑走不出来， 为什么不让开心慢点走？ 一天二十四小时， 除去睡觉的半天， 愿意焦虑可以占满时间， 不愿意的话就傻乎乎的开心吧。</p>\n\n<p>为此我总结了焦虑的几件事</p>\n\n<ul>\n<li>健康</li>\n<li>工作 (工作没有实质的产出， 大多修修补补)</li>\n<li>身边人的状态</li>\n<li>管理不善的体型</li>\n<li>穷困潦倒</li>\n</ul>\n\n<p>希望接下来一段时间我能做到下列几件事， 并坚持下去.</p>\n\n<ul>\n<li>多喝水， 身体总在不自觉的缺水， 一天保证2升水. 早起一杯水.</li>\n<li>八点以后不在近食.</li>\n<li>规律有氧的锻炼 </li>\n<li>保持平和</li>\n<li>无论有无睡意， 晚上十一点不再玩手机，躺着待睡. 晚十一点之前不在床上躺着.</li>\n<li>培养阅读习惯</li>\n<li>释放爱和关心</li>\n<li>忘记自己很穷</li>\n<li>对自己宽容</li>\n<li>工作饱和并享受产出结果</li>\n</ul>\n\n<p>上述列表不分先后顺序。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])">('随笔', [{'filename': '2019-07-04', 'title': '2019年中杂谈', 'date': datetime.datetime(2019, 7, 4, 9, 26, 43), 'cover': '/uploads/images/2019-07-04.jpeg', 'set': '随笔', 'content': '<p><figure class="hassubimage"><div class="image"><img src="/uploads/images/2019-07-04.jpeg"></div><figcaption class="img-title">#ben_neale@unsplash</figcaption></figure></p>\n\n<p>我一直研究如何让自己的生活和压力做到平衡。 但不管我怎么努力好像都没有活成应该的样子。</p>\n\n<p>自术后已有三个月，黄梅天，已过大半。 大多时间的焦虑都是为术后的恢复和工作占有， 虽然偶尔还能感觉到一点快乐， 但总很快就消失了。 比你焦虑的时效性， 快乐总是短暂的。 </p>\n\n<p>这种情况以前也经常的事情， 但现在是两个人生活和以前却不同， 两个人生活一个人的不开心， 另外一个人就没有不开心的理由。 我懂这个道理，所以别人的焦虑在我面前我都强制自己少管， 简单的安慰就不会再想了。 但自己的又怕影响到别人， 不愿意说出来， 只能靠自己去排解。 但排解能力很差， 越是不了解越要了解， 越要了解真相越是残酷， 如此恶性循环。 </p>\n\n<p>当焦虑走不出来， 为什么不让开心慢点走？ 一天二十四小时， 除去睡觉的半天， 愿意焦虑可以占满时间， 不愿意的话就傻乎乎的开心吧。</p>\n\n<p>为此我总结了焦虑的几件事</p>\n\n<ul>\n<li>健康</li>\n<li>工作 (工作没有实质的产出， 大多修修补补)</li>\n<li>身边人的状态</li>\n<li>管理不善的体型</li>\n<li>穷困潦倒</li>\n</ul>\n\n<p>希望接下来一段时间我能做到下列几件事， 并坚持下去.</p>\n\n<ul>\n<li>多喝水， 身体总在不自觉的缺水， 一天保证2升水. 早起一杯水.</li>\n<li>八点以后不在近食.</li>\n<li>规律有氧的锻炼 </li>\n<li>保持平和</li>\n<li>无论有无睡意， 晚上十一点不再玩手机，躺着待睡. 晚十一点之前不在床上躺着.</li>\n<li>培养阅读习惯</li>\n<li>释放爱和关心</li>\n<li>忘记自己很穷</li>\n<li>对自己宽容</li>\n<li>工作饱和并享受产出结果</li>\n</ul>\n\n<p>上述列表不分先后顺序。</p>\n', 'links': [], 'is_page': '', 'friends': [{'image': '/static/images/avatar.png', 'name': 'JackeyGao笔记本', 'owner': 'JackeyGao', 'link': 'https://ijg.io'}, {'image': '/uploads/images/friends/yangshiwei.jpg', 'name': '杨世威个人站', 'owner': 'Yangshiwei', 'link': 'https://www.yangshiwei.top'}, {'image': '/uploads/images/friends/weijunzi.jpeg', 'name': '伪君子的梦呓', 'owner': '伪君子', 'link': 'https://weijunzii.github.io'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': 'Will Dx的博客', 'owner': 'willdx', 'link': 'https://blog.willdx.me'}, {'image': '/uploads/images/friends/willdx.jpg', 'name': '读·写', 'owner': 'willdx', 'link': 'http://rw.imdancer.com/'}, {'image': '/uploads/images/friends/lovefc.jpg', 'name': '封尘博客', 'owner': 'lovefc', 'link': 'http://lovefc.cn'}, {'image': '/uploads/images/friends/firstphp.jpeg', 'name': '狂奔的蚂蚁的博客', 'owner': '狂奔的蚂蚁', 'link': 'http://www.firstphp.com'}, {'image': '/uploads/images/friends/vincent.jpeg', 'name': 'Vincent Studio', 'owner': 'Vincent', 'link': 'https://vincentstudio.info/'}]}])</a>
                      </li>
                      
                    </ul>
                  </nav>
                </div>

                <div id="avatarWrapper">
                  <img class="avatar" src="/static/images/avatar.png">
                </div>
            </header>
          </div>
        <div id="pageWrapper">
          
  
  <div id="airticleItem">
    
    <a href="/r/words/hawkeye.html" class="title">多监控平台统一 | Hawkeye</a>
    <div class="meta">March 27, 2018</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/zabbix-widget.html" class="title">获取 zabbix 挂件数据(widget)</a>
    <div class="meta">January 03, 2018</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/1000000000000-in-range-1000000000001.html" class="title">一个Python3和Python2的range差异</a>
    <div class="meta">December 20, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/celery-with-docker-compose.html" class="title">使用非root用户在容器中运行celery</a>
    <div class="meta">December 17, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/ansible-shell-vs-command.html" class="title">ANSIBLE模块 - shell和command区别</a>
    <div class="meta">November 13, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/django-oauth2-jwt-auth.html" class="title">Django OAuth2 和 JWT 案例</a>
    <div class="meta">August 08, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/takeout-from-world.html" class="title">Takeout from world</a>
    <div class="meta">July 18, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/kwargs-safe.html" class="title">Python 可变参数的坑</a>
    <div class="meta">July 04, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/python-or-golang.html" class="title">Python 和 Golang 一点愚见</a>
    <div class="meta">July 01, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/golang-bongo-example.html" class="title">Golang bongo 简单示例</a>
    <div class="meta">June 28, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/golang-flag-get-slice-value.html" class="title">Golang flag 获取多个值</a>
    <div class="meta">June 26, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/2017-06-23.html" class="title">谦虚为人，终有吉时</a>
    <div class="meta">June 22, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/python-eval-safe.html" class="title">Python eval安全案例</a>
    <div class="meta">June 13, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/2017-06-05.html" class="title">肆无忌惮</a>
    <div class="meta">June 05, 2017</div>
  </div>
  
  <div id="airticleItem">
    
    <a href="/r/words/flask-admin-add-custom-row-action.html" class="title">Flask-Admin 增加自定义Action</a>
    <div class="meta">May 12, 2017</div>
  </div>
  

  <div id="pagination">
    
      
          <a href="/r/page/4/">上一页</a>
      
    
    <b style="font-weight: 700;"> / </b>
    
        <a href="/r/page/6/">下一页</a>
    
  </div>

        </div>
        <div id="footerWrapper">
        </div>
      </div>
    </div>
  </body>
  <script>
  window.menu = '☰'
  function ToggleMenu () {
    var mobile = document.getElementById('mobileNav');
    var menu = document.getElementById('menuNav');
    var t = document.getElementById('mobileMenuLink');
    var topNav = document.getElementById('topNav');
  
    if (mobile.className === "visible") {
      mobile.className = 'hidden'
      t.innerHTML = '☰'
      window.menu = '☰'
    } else {
      mobile.className = 'visible'
      menu.innerHTML = topNav.innerHTML;
      t.innerHTML = '⌫'
      window.menu = '⌫'
    }
  }

  window.onscroll = function() {scrollFunction()};

  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }

  function scrollFunction() {
    var t = document.getElementById('mobileMenuLink');
    var toTop = document.getElementById('toTop');
    var m = document.getElementById('mobileNav');
    var scrollTop = m.offsetHeight > 100 ? m.offsetHeight : 800;
    if (document.body.scrollTop > scrollTop || document.documentElement.scrollTop > scrollTop) {
      t.innerHTML = '⇪'
      t.onclick = function() {topFunction()};
      toTop.className = 'visible'
    } else {
      t.innerHTML = window.menu
      t.onclick = function() {ToggleMenu()};
      toTop.className = ''
    }
  }

  </script>

  
  
</html>